{
  "version": "https://jsonfeed.org/version/1.1",
  "title": "Tony Spegel",
  "language": "de",
  "home_page_url": "https://tony-spegel.com",
  "feed_url": "https://tony-spegel.com/feed/feed.json",
  "description": "Homepage &amp; Blog zu moderner Web-Entwicklung: Web-Apps, Angular, TypeScript, Web Components, Shopify &amp; Barrierefreiheit",
  "author": {
    "name": "Tony Spegel",
    "url": "https://tony-spegel.com/"
  },
  "items": [{
      "id": "https://tony-spegel.com/blog/event-emitter-decorator/",
      "url": "https://tony-spegel.com/blog/event-emitter-decorator/",
      "title": "Custom Events mit @eventEmitter",
      "content_html": "<p>Events sind eine super M√∂glichkeit um zwischen verschiedenen (Web) Components<br />\nzu kommunizieren und besonders geeignet, wenn man nicht so sehr an das DOM gebunden sein m√∂chte oder keine Annahmen √ºber dessen Aufbau treffen kann. Deswegen habe ich mir die Frage gestellt, wie man das Ausl√∂sen von Custom Events mit Hilfe von Standard Decorators etwas &quot;bequemer&quot; l√∂sen kann und f√ºhre hier durch meinen Denkprozess. Kleiner Spoiler: man k√∂nnte das so machen, wie ich es umgesetzt habe, aber es geht auch noch besser. √úbrigens unterst√ºtzen auch die meisten Frontend-Frameworks native DOM-Events.</p>\n<details>\n   <summary>Gut zu wissen: Decorators</summary>\n   <div class=\"details-content\">\n    <p>\n      Decorators erm√∂glichen es, das Verhalten von Classes und deren Member zu √§ndern. Dazu z√§hlen beispielsweise das Hinzuf√ºgen von Metadaten, die Erweiterung von Funktionalit√§t oder die Validierung von Daten.\n    </p>\n    <p>\n      Es ist wichtig zu beachten, dass hier Standard Decorators gemeint sind, die derzeit als <a href=\"https://github.com/tc39/proposal-decorators\">Stage 3 Proposal</a> existieren. (Legacy) Decorators k√∂nnen bereits seit l√§ngerem genutzt werden und entsprechen einem vorherigen Entwurf. Obwohl Standard Decorators derzeit von keinem Browser unterst√ºtzt werden, k√∂nnen sie bereits mit Compilern wie TypeScript (>= 5.x.x) oder Babel genutzt werden.\n    </p>\n   </div>\n</details>\n<section>\n<h2 id=\"motivation\"><a class=\"header-anchor\" href=\"https://tony-spegel.com/blog/event-emitter-decorator/#motivation\">Motivation</a></h2>\n<p>In meiner <a href=\"https://tony-spegel.com/blog/image-comparison-component/#custom-events\">Image Comparison Component</a> nutze ich Custom Events, um zu kommunizieren, dass der Slider abschlie√üend bewegt wurde oder das auf andere Weise mit der Component interagiert wird. Das kann man unter anderem so umsetzen:</p>\n<pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">DragEvent</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">Event</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">static</span> <span class=\"token keyword\">readonly</span> eventName <span class=\"token operator\">=</span> <span class=\"token string\">'drag-event'</span> <span class=\"token keyword\">as</span> <span class=\"token keyword\">const</span><span class=\"token punctuation\">;</span>\n\n  targetElement<span class=\"token operator\">:</span> HTMLElement<span class=\"token punctuation\">;</span>\n\n  <span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span>targetElement<span class=\"token operator\">:</span> HTMLElement<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">super</span><span class=\"token punctuation\">(</span>DragEvent<span class=\"token punctuation\">.</span>eventName<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n      bubbles<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n      cancelable<span class=\"token operator\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span>\n      composed<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>targetElement <span class=\"token operator\">=</span> targetElement<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<p>Die Optionen sollte man dann nat√ºrlich anpassen. Nutzen l√§sst es sich das Custom Event dann, in dem man <code>dispatchEvent</code> auf einem <a href=\"https://developer.mozilla.org/en-US/docs/Web/API/EventTarget/dispatchEvent\">Element</a> ausf√ºhrt, welches Events empfangen kann:</p>\n<pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">ImageComparison</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">LitElement</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// (...)</span>\n  <span class=\"token keyword\">private</span> slideEndHandler <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token keyword\">void</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// (...)</span>\n    window<span class=\"token punctuation\">.</span><span class=\"token function\">dispatchEvent</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">DragEvent</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<p>Die Stelle des Ausl√∂sen ist sp√§ter nochmal wichtig <span aria-hidden=\"true\">üëÄ</span>.</p>\n</section>\n<section>\n<h2 id=\"anwendungsbeispiel\"><a class=\"header-anchor\" href=\"https://tony-spegel.com/blog/event-emitter-decorator/#anwendungsbeispiel\">Anwendungsbeispiel</a></h2>\n<p>Weil ich mich noch mehr mit Standard Decorators befassen wollte, habe mich dann dazu entschieden einen <code>ClassMethod</code>-Decorator als Basis meiner Entwicklung umzusetzen was am Ende angewandt so aussehen kann:</p>\n<pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> eventEmitter <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'./event-emitter.js'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">EmitterElement</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">HTMLElement</span> <span class=\"token punctuation\">{</span>\n  #counter<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span> <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">eventEmitter</span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> name<span class=\"token operator\">:</span> <span class=\"token string\">'counter-event'</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token function\">increase</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token builtin\">number</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>#counter <span class=\"token operator\">+=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span></code></pre>\n<p>Dieser Decorator wird dann jeweils direkt an der Class Method angef√ºgt und l√∂st gleichzeitig mit der Ausf√ºhrung der Method ein Event aus. √úber verschiedene Optionen l√§sst sich <code>@eventEmitter</code> dann weiter konfigurieren. Mir ging es in diesem Projekt vor allem darum, noch mehr zu Standard Decorators zu lernen. Da bietet es sich nat√ºrlich an, etwas zu versuchen zu l√∂sen, was man √∂fter ben√∂tigt. Bis auf die Types ist das √ºbrigens, so bald Decorators im Browser unterst√ºtzt werden, standardkonformes JavaScript.</p>\n</section>\n<section>\n<h2 id=\"implementation\"><a class=\"header-anchor\" href=\"https://tony-spegel.com/blog/event-emitter-decorator/#implementation\">Implementation</a></h2>\n<p>Meine Implementation teile ich in <a href=\"https://tony-spegel.com/blog/event-emitter-decorator/#optionen\">Optionen</a> und die <a href=\"https://tony-spegel.com/blog/event-emitter-decorator/#decorator\">Kernfunktionalit√§t</a> des Decorators ein. Am Ende zeige ich noch auf, wie man den Decorator nutzen kann und im anschlie√üenden Abschnitt worauf noch zu achten ist und welche alternativen Implementationen es gibt.</p>\n<section>\n<h3 id=\"optionen\"><a class=\"header-anchor\" href=\"https://tony-spegel.com/blog/event-emitter-decorator/#optionen\">Optionen</a></h3>\n<p>Um f√ºr die Optionen etwas flexibler als im <code>DragEvent</code>-Beispiel gezeigt zu bleiben, erweitere ich das<br />\n<code>CustomEventInit</code> Interface mit zwei weiteren Properties: <code>name</code> und <code>emitter</code>:</p>\n<pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token comment\">/**\n * EmitterConfig includes not only a name for your custom event\n * but also all other properties one would like to set such as:\n * detail, bubbles and so on.\n */</span>\n<span class=\"token keyword\">interface</span> <span class=\"token class-name\">EmitterConfig</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">CustomEventInit</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">/**\n   * The event name you can listen to\n   */</span>\n  name<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">;</span>\n  <span class=\"token comment\">/**\n   * The emitter for your events,\n   * by default the class instance (this)\n   */</span>\n  emitter<span class=\"token operator\">?</span><span class=\"token operator\">:</span> Window <span class=\"token operator\">|</span> Document<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<p>Alle bisherigen Properties aus dem <code>CustomEventInit</code> Interface (zum Beispiel <code>bubbles</code>) lassen sich so weiter wie gewohnt nutzen. <code>name</code> ist dabei in jedem Fall anzugeben. Der Grund daf√ºr ist, dass ich zuerst den Namen des Custom Events von der Class Method ableiten wollte und das aber zu folgendem Problem f√ºhrt. N√§mlich dann, wenn ein Minifier den Namen der Class Method ver√§ndert, also aus <code>increase()</code> ein <code>i()</code> k√ºrzt. Niemand k√∂nnte dann wissen, auf welches Event zu h√∂ren ist und mit einer Pflicht-Property wie dieser ist es dann deutlich impliziter. <code>emitter</code> ist optional aber f√§llt standardm√§√üig auf die Instanz der Klasse zur√ºck.</p>\n</section>\n<section>\n<h3 id=\"decorator\"><a class=\"header-anchor\" href=\"https://tony-spegel.com/blog/event-emitter-decorator/#decorator\">Decorator</a></h3>\n<p>Der Decorator sieht auf dem ersten, und auch auf den zweiten und dritten, Blick erst mal kompliziert aus:</p>\n<pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token comment\">// A: Signature</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">function</span> <span class=\"token function\">eventEmitter</span><span class=\"token punctuation\">(</span>config<span class=\"token operator\">:</span> EmitterConfig<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// B: Returning a wrapped method</span>\n  <span class=\"token keyword\">return</span> <span class=\"token keyword\">function</span> <span class=\"token operator\">&lt;</span>This <span class=\"token keyword\">extends</span> <span class=\"token class-name\">EventTarget</span><span class=\"token punctuation\">,</span> Args <span class=\"token keyword\">extends</span> <span class=\"token class-name\"><span class=\"token builtin\">any</span></span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> Return<span class=\"token operator\">></span><span class=\"token punctuation\">(</span>\n    <span class=\"token function-variable function\">target</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token operator\">:</span> This<span class=\"token punctuation\">,</span> <span class=\"token operator\">...</span>args<span class=\"token operator\">:</span> Args<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> Return<span class=\"token punctuation\">,</span>\n    _context<span class=\"token operator\">:</span> ClassMethodDecoratorContext<span class=\"token operator\">&lt;</span>\n      This<span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token operator\">:</span> This<span class=\"token punctuation\">,</span> <span class=\"token operator\">...</span>args<span class=\"token operator\">:</span> Args<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> Return\n    <span class=\"token operator\">></span>\n  <span class=\"token punctuation\">)</span>\n  <span class=\"token comment\">// C: Extracting options (...)</span>\n\n  <span class=\"token comment\">// D: Wrapping the initial method</span>\n  <span class=\"token keyword\">return</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token operator\">:</span> This<span class=\"token punctuation\">,</span> <span class=\"token operator\">...</span>args<span class=\"token operator\">:</span> Args<span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> Return <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<p>In den Abschnitten <code>A</code> und <code>B</code> wird eine bestehende Class Method genommen, vom Decorator umschlossen, mit zus√§tzlicher Logik erg√§nzt und schlie√ülich mit diesem ersetzt. Das Typing in der Form ist notwendig, wobei ich <code>_context</code> nicht weiter nutze. Dadurch dass ich <code>EventTarget</code> erweitere, kann ich sp√§ter im <code>emitter</code> einfacher auf einen Default zur√ºckfallen.</p>\n<p>Das extrahieren der Optionen im Abschnitt <code>C</code> ist nicht weiter spannend, aber ich habe einen Laufzeit Check hinzugef√ºgt damit man auch in einem JavaScript Kontext Fehler angezeigt bekommt, wenn man sein Custom Event nicht benennt:</p>\n<pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token comment\">/**\n * Throw an error if no config or no name has been set.\n */</span>\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>config<span class=\"token operator\">?.</span>name<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Error</span><span class=\"token punctuation\">(</span>\n    <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">The \"name\"-property in the config is mandatory. It is used to name your custom event.</span><span class=\"token template-punctuation string\">`</span></span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token comment\">/**\n * Extracts the event name from the provided config.\n */</span>\n<span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> name <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> config<span class=\"token punctuation\">;</span></code></pre>\n<p>Abschnitt D bringt dann den Rest zusammen und √ºbernimmt die eigentliche Logik:</p>\n<pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token keyword\">return</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token operator\">:</span> This<span class=\"token punctuation\">,</span> <span class=\"token operator\">...</span>args<span class=\"token operator\">:</span> Args<span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> Return <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">/**\n   * The method's return value\n   */</span>\n  <span class=\"token keyword\">const</span> result <span class=\"token operator\">=</span> <span class=\"token function\">target</span><span class=\"token punctuation\">.</span><span class=\"token function\">call</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">...</span>args<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token comment\">/**\n   * 'detail' is by default what is set with the config and if not\n   * the method's return value\n   */</span>\n  <span class=\"token keyword\">const</span> detail <span class=\"token operator\">=</span> config<span class=\"token punctuation\">.</span>detail <span class=\"token operator\">??</span> result<span class=\"token punctuation\">;</span>\n  <span class=\"token comment\">/**\n   * The emitter which dispatches the event\n   */</span>\n  <span class=\"token keyword\">const</span> emitter <span class=\"token operator\">=</span> config<span class=\"token punctuation\">.</span>emitter <span class=\"token operator\">??</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">;</span>\n\n  emitter<span class=\"token punctuation\">.</span><span class=\"token function\">dispatchEvent</span><span class=\"token punctuation\">(</span>\n    <span class=\"token keyword\">new</span> <span class=\"token class-name\">CustomEvent</span><span class=\"token punctuation\">(</span>name<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> detail<span class=\"token punctuation\">,</span> <span class=\"token operator\">...</span>config <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">return</span> result<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre>\n<p>Interessant finde ich hier vor allem die Zuweisung von <code>detail</code> und <code>emitter</code>. Das macht es schon flexibler als in meiner urspr√ºnglichen L√∂sung. Das ganze Typing und die Zeilen bis zu diesem Punkt sind so gesehen nur Setup f√ºr diese paar Zeilen:</p>\n<pre class=\"language-ts\"><code class=\"language-ts\">emitter<span class=\"token punctuation\">.</span><span class=\"token function\">dispatchEvent</span><span class=\"token punctuation\">(</span>\n  <span class=\"token keyword\">new</span> <span class=\"token class-name\">CustomEvent</span><span class=\"token punctuation\">(</span>name<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> detail<span class=\"token punctuation\">,</span> <span class=\"token operator\">...</span>config <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre>\n<p>Auf das Event im Counter Beispiel l√§sst sich dann beispielsweise so h√∂ren:</p>\n<pre class=\"language-ts\"><code class=\"language-ts\">window<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'counter-event'</span><span class=\"token punctuation\">,</span> e <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> detail <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> e <span class=\"token keyword\">as</span> CustomEvent<span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>#counter <span class=\"token operator\">=</span> detail<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre>\n</section>\n</section>\n<section>\n<h2 id=\"limitationen-und-andere-implementationen\"><a class=\"header-anchor\" href=\"https://tony-spegel.com/blog/event-emitter-decorator/#limitationen-und-andere-implementationen\">Limitationen und andere Implementationen</a></h2>\n<p>Soweit so gut k√∂nnte man meinen, aber sp√§ter ist mir dann ein entscheidender Nachteil aufgefallen: mein Decorator l√∂st immer dann ein Event aus, wenn eine Methode mit diesem Decorator ausgef√ºhrt wird.</p>\n<p>Dieser Decorator diente f√ºr mich vor allem dazu, noch mehr √ºber Standard Decorators zu lernen und das wollte ich so unvoreingenommen wie m√∂glich machen. Als ich dann an einem ersten brauchbaren Stand angekommen bin, habe ich nach weiteren Implementationen gesucht und bin auf die der <a href=\"https://stenciljs.com/docs/events\">Stencil-Bibliothek</a> gesto√üen. <a href=\"https://stenciljs.com/\">Stencil</a> erm√∂glicht es, √§hnlich wie mit <a href=\"https://lit.dev/\">Lit</a> Web Components erstellen zu k√∂nnen. Genutzt wird es beispielsweise vom Cross-Plattform Framework <a href=\"https://ionicframework.com/\">Ionic</a> oder dem Design System der <a href=\"https://github.com/db-ui/elements\">Deutschen Bahn</a>. Die Implementation von Stencil sieht grob so aus:</p>\n<pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> Event<span class=\"token punctuation\">,</span> EventEmitter <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@stencil/core'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">TodoList</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">/**\n   * Event called 'todoCompleted' that is \"composed\",\n   * \"cancellable\" and it will bubble up!\n   */</span>\n  <span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">Event</span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    eventName<span class=\"token operator\">:</span> <span class=\"token string\">'todoCompleted'</span><span class=\"token punctuation\">,</span>\n    composed<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n    cancelable<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n    bubbles<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span> todoCompleted<span class=\"token operator\">:</span> EventEmitter<span class=\"token operator\">&lt;</span>Todo<span class=\"token operator\">></span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token function\">todoCompletedHandler</span><span class=\"token punctuation\">(</span>todo<span class=\"token operator\">:</span> Todo<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> event <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>todoCompleted<span class=\"token punctuation\">.</span><span class=\"token function\">emit</span><span class=\"token punctuation\">(</span>todo<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>event<span class=\"token punctuation\">.</span>defaultPrevented<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token comment\">// if not prevented, do some default handling code</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<p>Zu den (groben) Unterschieden: zum einen wird hier keine Methode sondern ein Class field dekoriert und zum anderen kann der Type des Emitters mit einem Generic noch genauer gesetzt werden: <code>EventEmitter&lt;Todo&gt;</code>. Letztlich l√§sst sich dann, an einem beliebigen Punkt in der der eigenen Methode, die <code>emit</code>-Methode des Decorators aufrufen:<br />\n<code>this.todoCompleted.emit(todo)</code>. Das hat, finde ich, den entscheidenden Vorteil, dass man noch mehr Logik oder Bedingungen einf√ºhren kann bevor das Event ausgel√∂st wird. Sch√∂n zu sehen ist aber auch, dass man auf √§hnliche L√∂sungen wie etablierte Bibliotheken kommt <span aria-hidden=\"true\">üòÖ</span>. Neben dem <code>Event</code>-Decorator bietet Stencil au√üerdem noch einen <code>Listen</code>-Decorator um Events verarbeiten zu k√∂nnen. Ein n√§chster Schritt f√ºr mein Projekt k√∂nnte sein, es alternativ mit einem <code>ClassField</code>-Decorator zu versuchen und dann noch mehr M√∂glichkeiten zur Typisierung zu bieten. Einen Link zum GitHub Repository gibt es <a href=\"https://github.com/TonySpegel/event-emitter\">hier</a> - √ºber Feedback freue ich mich nat√ºrlich auch.</p>\n</section>\n",
      "date_published": "2023-12-08T00:00:00Z"
    },{
      "id": "https://tony-spegel.com/blog/query-assigned-element-content/",
      "url": "https://tony-spegel.com/blog/query-assigned-element-content/",
      "title": "Einen Decorator f√ºr Inhalte eines Slots entwickeln",
      "content_html": "<section>\n<h2 id=\"motivation\"><a class=\"header-anchor\" href=\"https://tony-spegel.com/blog/query-assigned-element-content/#motivation\">Motivation</a></h2>\n<p>Vor einer Weile habe ich eine Web Component <a href=\"https://tony-spegel.com/blog/toc-observer\">entwickelt</a>, welche CSS-Klassen zu Links in einem Inhaltsverzeichnis je nach Sichtbarkeit der zugeh√∂rigen Elemente im Viewport hinzuf√ºgen/entfernen kann.</p>\n<pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>toc-observer</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>ul</span> <span class=\"token attr-name\">slot</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>toc<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>li</span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>a</span> <span class=\"token attr-name\">href</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>#tethys<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>Tethys<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>a</span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>li</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>li</span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>a</span> <span class=\"token attr-name\">href</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>#mimas<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>Mimas<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>a</span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>li</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>ul</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>toc-observer</span><span class=\"token punctuation\">></span></span>\n\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>section</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>tethys<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>section</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>section</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>mimas<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>section</span><span class=\"token punctuation\">></span></span></code></pre>\n<p>Web Components bieten den Vorteil, dass diese so konfiguriert werden k√∂nnen, dass sie in sich geschlossen sind und von au√üen nur √ºber klar definierte Schnittstellen beeinflusst werden k√∂nnen.</p>\n<p>Zu diesen Schnittstellen geh√∂rt das <code>&lt;slot&gt;</code>-Element bzw. Attribut. Es verh√§lt sich als ein Platzhalter, welcher eigenes Markup, in dem Fall das Inhaltsverzeichnis meiner Posts, in die Component aufnehmen kann. Um nun den &quot;Inhalt&quot; (die Links) des zum Slot zugewiesenen Element ( das <code>&lt;ul&gt;</code>) verarbeiten zu k√∂nnen, benutze ich in einem ersten Schritt den zu Lit geh√∂renden <code>@queryAssignedElements</code>-<a href=\"https://lit.dev/docs/api/decorators/#queryAssignedElements\">Decorator</a>:</p>\n<pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">customElement</span></span><span class=\"token punctuation\">(</span><span class=\"token string\">'toc-observer'</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">TocObserver</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">LitElement</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">queryAssignedElements</span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>slot<span class=\"token operator\">:</span> <span class=\"token string\">'toc'</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">private</span> _tocList<span class=\"token operator\">?</span><span class=\"token operator\">:</span> <span class=\"token builtin\">Array</span><span class=\"token operator\">&lt;</span>HTMLUListElement<span class=\"token operator\">></span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">private</span> <span class=\"token keyword\">get</span> <span class=\"token function\">_tocListItems</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> HTMLAnchorElement<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">|</span> <span class=\"token keyword\">null</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>_tocList<span class=\"token operator\">?.</span>length\n      <span class=\"token operator\">?</span> <span class=\"token punctuation\">[</span><span class=\"token operator\">...</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>_tocList<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token generic-function\"><span class=\"token function\">querySelectorAll</span><span class=\"token generic class-name\"><span class=\"token operator\">&lt;</span>HTMLAnchorElement<span class=\"token operator\">></span></span></span><span class=\"token punctuation\">(</span><span class=\"token string\">'[href^=\"#\"]'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span>\n      <span class=\"token operator\">:</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<p>Bei der Nutzung dieses Decorators bin ich zun√§chst dar√ºber gestolpert, dass ausschlie√ülich die zum Slot zugewiesenen Elemente zur√ºckgegeben werden - was so aber auch Sinn ergibt. Deswegen nutze ich in einem weiteren Schritt auch einen Getter, welcher mit einem <code>querySelectorAll</code> die enthaltenen Links zur√ºckgibt. Das ist nicht gro√üartig kompliziert, aber hat mich dann motiviert meinen eigenen Decorator zu schreiben, der am Ende beide Schritte in einem vereint:</p>\n<pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">DecoElement</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">HTMLElement</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">queryAssignedElementContent</span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> selector<span class=\"token operator\">:</span> <span class=\"token string\">'li'</span><span class=\"token punctuation\">,</span> slot<span class=\"token operator\">:</span> <span class=\"token string\">'list'</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  accessor #tocLinks<span class=\"token operator\">!</span><span class=\"token operator\">:</span> <span class=\"token builtin\">Array</span><span class=\"token operator\">&lt;</span>HTMLAnchorElement<span class=\"token operator\">></span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre>\n</section>\n<section>\n<h2 id=\"implementation\"><a class=\"header-anchor\" href=\"https://tony-spegel.com/blog/query-assigned-element-content/#implementation\">Implementation</a></h2>\n<details>\n   <summary>Gut zu wissen: Decorators</summary>\n   <div class=\"details-content\">\n    <p>\n      Decorators erm√∂glichen es, das Verhalten von Classes und deren Member zu √§ndern. Dazu z√§hlen beispielsweise das Hinzuf√ºgen von Metadaten, die Erweiterung von Funktionalit√§t oder die Validierung von Daten.\n    </p>\n    <p>\n      Es ist wichtig zu beachten, dass hier Standard Decorators gemeint sind, die derzeit als <a href=\"https://github.com/tc39/proposal-decorators\">Stage 3 Proposal</a> existieren. (Legacy) Decorators k√∂nnen bereits seit l√§ngerem genutzt werden und entsprechen einem vorherigen Entwurf. Obwohl Standard Decorators derzeit von keinem Browser unterst√ºtzt werden, k√∂nnen sie bereits mit Compilern wie TypeScript (>= 5.x.x) oder Babel genutzt werden.\n    </p>\n   </div>\n</details>\n<p>Meine Implementation basiert auf dem derzeit aktuellen Stage 3 Proposal und unterscheidet sich somit von den bisher bereits verf√ºgbaren Legacy Decorators (siehe <em>Gut zu wissen</em>). Den aktuellen Status des Proposals verfolge ich schon eine Weile und habe dann schlie√ülich im Mai mit der Umsetzung begonnen. Eine kleine Einschr√§nkung direkt vorab: zum jetzigen Zeitpunkt ist es noch nicht m√∂glich, beide Arten von Decorators parallel in Lit zu nutzen - das ist aber bereits in Arbeit.</p>\n<p>Die eigentliche Logik im Code ist, wie in der <a href=\"https://tony-spegel.com/blog/query-assigned-element-content/#motivation\">Motivation</a> zu sehen, √ºberschaubar. Die Herausforderung f√ºr mich lag eher darin, ein so umfassendes, technisches Dokument wie das Proposal komplett zu lesen und so weit zu verstehen, dass ich damit arbeiten konnte. Viel gelernt habe ich im Austausch mit <a href=\"https://github.com/vdegenne\">Valentin Degenne</a>, welchen ich √ºber den <a href=\"https://discord.gg/eMaSX7G5\">Lit Discord</a> kennenlernen durfte und mich bei Fragen immer wieder unterst√ºtzt hat.</p>\n<p>Nach einer Weile habe ich dann verstanden, dass ich einen <code>Class Auto-Accessor</code> ben√∂tige. Diese werden mit dem neuen <code>accessor</code> Keyword ausgezeichnet.</p>\n<p>Eine Auto-accessor definiert automatisch ein Getter/Setter-Paar so dass:</p>\n<pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">C</span> <span class=\"token punctuation\">{</span>\n  accessor x <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<p>grob zu folgendem √ºbersetzt wird:</p>\n<pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">C</span> <span class=\"token punctuation\">{</span>\n  #x <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// '#' marks private fields in JS</span>\n\n  <span class=\"token keyword\">get</span> <span class=\"token function\">x</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>#x<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">set</span> <span class=\"token function\">x</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">val</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>#x <span class=\"token operator\">=</span> val<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<p>Auf diese Art funktioniert das nur f√ºr einfache Felder. Das stellt aber kein Problem dar, weil diese sich weiter anpassen lassen. Grob ausgedr√ºckt soll der Decorator dieses so dekorierte Feld nehmen und mit einem angepassten Getter ersetzen, in dem es mit zus√§tzlicher Logik angereichert wird.</p>\n<p>Meine Implementation basiert auf Grund der N√§he auch stark auf dem <code>queryAssignedElements</code>-<a href=\"https://github.com/lit/lit/blob/main/packages/reactive-element/src/decorators/query-assigned-elements.ts#L79\">Decorator</a>:</p>\n<pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token comment\">// A: Signature</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">function</span> <span class=\"token generic-function\"><span class=\"token function\">queryAssignedElementContent</span><span class=\"token generic class-name\"><span class=\"token operator\">&lt;</span>\n  <span class=\"token constant\">T</span> <span class=\"token keyword\">extends</span> Element<span class=\"token punctuation\">,</span> <span class=\"token comment\">// The `this` type to which the target applies</span>\n  <span class=\"token constant\">E</span> <span class=\"token keyword\">extends</span> Element <span class=\"token comment\">// The property type for the class `accessor` field.</span>\n<span class=\"token operator\">></span></span></span><span class=\"token punctuation\">(</span>options<span class=\"token operator\">:</span> QueryAssignedElementContentOptions<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span>\n    _target<span class=\"token operator\">:</span> ClassAccessorDecoratorTarget<span class=\"token operator\">&lt;</span><span class=\"token constant\">T</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">E</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n    <span class=\"token comment\">// Context object containing information about the value being decorated</span>\n    context<span class=\"token operator\">:</span> ClassAccessorDecoratorContext<span class=\"token operator\">&lt;</span><span class=\"token constant\">T</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">E</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token operator\">></span>\n  <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// B: Runtime check for better DX</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>context<span class=\"token punctuation\">.</span>kind <span class=\"token operator\">!==</span> <span class=\"token string\">'accessor'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">TypeError</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Only supported on class accessors'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\">// C: Building a new getter</span>\n    <span class=\"token keyword\">const</span> result<span class=\"token operator\">:</span> ClassAccessorDecoratorResult<span class=\"token operator\">&lt;</span><span class=\"token constant\">T</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">E</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token operator\">></span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token operator\">:</span> <span class=\"token constant\">T</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> shadowRoot <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// Root node within a shadow dom</span>\n        <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> selector<span class=\"token punctuation\">,</span> slot <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> options<span class=\"token punctuation\">;</span> <span class=\"token comment\">// Extract options</span>\n\n        <span class=\"token comment\">// C1: Construct a slot element selector</span>\n        <span class=\"token keyword\">const</span> slotSelector <span class=\"token operator\">=</span> slot <span class=\"token operator\">?</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">slot[name=</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>slot<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">]</span><span class=\"token template-punctuation string\">`</span></span> <span class=\"token operator\">:</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">slot:not([name])</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">;</span>\n        <span class=\"token comment\">// C2: Select a slot element</span>\n        <span class=\"token keyword\">const</span> slotElement <span class=\"token operator\">=</span>\n          shadowRoot<span class=\"token operator\">?.</span><span class=\"token generic-function\"><span class=\"token function\">querySelector</span><span class=\"token generic class-name\"><span class=\"token operator\">&lt;</span>HTMLSlotElement<span class=\"token operator\">></span></span></span><span class=\"token punctuation\">(</span>slotSelector<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token comment\">// C3: Get slot assigned elements</span>\n        <span class=\"token keyword\">const</span> assignedElements <span class=\"token operator\">=</span> slotElement<span class=\"token operator\">?.</span><span class=\"token function\">assignedElements</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n          <span class=\"token operator\">...</span>options<span class=\"token punctuation\">,</span>\n          flatten<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token comment\">// C4: Query slot for its content</span>\n        <span class=\"token keyword\">const</span> slotContent <span class=\"token operator\">=</span> assignedElements<span class=\"token operator\">?.</span>length\n          <span class=\"token operator\">?</span> <span class=\"token punctuation\">[</span><span class=\"token operator\">...</span>assignedElements<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token generic-function\"><span class=\"token function\">querySelectorAll</span><span class=\"token generic class-name\"><span class=\"token operator\">&lt;</span><span class=\"token constant\">E</span><span class=\"token operator\">></span></span></span><span class=\"token punctuation\">(</span>selector<span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span>\n          <span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">return</span> slotContent<span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> result<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<section>\n<h3 id=\"a-signature\"><a class=\"header-anchor\" href=\"https://tony-spegel.com/blog/query-assigned-element-content/#a-signature\">A: Signature</a></h3>\n<p>Ein <code>ClassAccessorDecorator</code> gibt ein <code>ClassAccessorDecoratorResult</code> zur√ºck, welches als Parameter ein <code>target</code> (hier ungenutzt) sowie <code>context</code> erwartet. Um dieselben Konfigurationsm√∂glichkeiten wie der <code>queryAssignedElements</code> zu bieten, definiere dieses Interface:</p>\n<pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token keyword\">interface</span> <span class=\"token class-name\">QueryAssignedElementContentOptions</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">/**\n   * The selector used to query the content of the slot's assigned elements.\n   * Must be a valid CSS selector string.\n   * ```html\n   * &lt;ul slot=\"list\">\n   *   &lt;li>Tethys&lt;/li> // ‚Üê use a selector to query these elements\n   * &lt;/ul>\n   * ```\n   */</span>\n  selector<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">;</span>\n  <span class=\"token comment\">/**\n   * The name of the slot to query elements from.\n   * ```html\n   * &lt;ul slot=\"list\">&lt;/ul>\n   *           ^\n   * ```\n   * @optional\n   */</span>\n  slot<span class=\"token operator\">?</span><span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<p>Lediglich <code>slot</code> definiere ich als optional, da ich sp√§ter ohne Angabe eines Namens auf den Default Slot zur√ºckgreife.</p>\n</section>\n<section>\n<h3 id=\"b-runtime-check\"><a class=\"header-anchor\" href=\"https://tony-spegel.com/blog/query-assigned-element-content/#b-runtime-check\">B: Runtime check</a></h3>\n<p>Um nicht nur in TypeScript, sondern auch in JavaScript etwas mehr Sicherheit zu bieten, habe ich noch einen Check integriert, um sicherzustellen, dass der Decorator nur an der richtigen Stelle, n√§mlich an einer Class Property, verwendet werden kann. W√§re es nicht f√ºr diesen Check, w√§re auch das <code>context</code>-Objekt unbenutzt.</p>\n</section>\n<section>\n<h3 id=\"c-building-a-new-getter\"><a class=\"header-anchor\" href=\"https://tony-spegel.com/blog/query-assigned-element-content/#c-building-a-new-getter\">C: Building a new getter</a></h3>\n<p>Der Kern dieses Decorators ist der neue Getter. Im ersten Schritt (<strong>C1</strong>) konstruiere ich den Slot-Selektor f√ºr <strong>C2</strong> und greife auf den Standard-Slot zur√ºck, sollte kein <code>name</code> √ºbergeben werden. Eine Web Component kann aber muss n√§mlich nicht nur aus einem Slot-Element bestehen. Inklusive <strong>C3</strong> ist die Implementierung noch nah am Vorbild, denn erst in <strong>C4</strong> extrahiere ich den f√ºr mich eigentlich interessanten Inhalt.</p>\n</section>\n</section>\n<section>\n<h2 id=\"fazit-and-ausblick\"><a class=\"header-anchor\" href=\"https://tony-spegel.com/blog/query-assigned-element-content/#fazit-and-ausblick\">Fazit &amp; Ausblick</a></h2>\n<p>Auch wenn ich zum jetzigen Stand meinen Decorator noch nicht in meinen Projekten nutzen kann, habe ich hier eine Menge gelernt und wertvolles Feedback einholen k√∂nnen sowohl was die Implementierung aber auch insbesondere das Arbeiten mit anspruchsvolleren Spezifikationen betrifft.<br />\nVor allem das Ganze typsicher umzusetzen und Generics √ºber mehrere Ebenen hinweg zu nutzen, war nicht ganz ohne. Auch spannend w√ºrde ich es bezeichnen, dass zur Zeit der Umsetzung wenig bis eher keine anderen Posts existierten, die genau diese Art an Decorators behandelt haben.</p>\n<p>Das Ganze sehe ich im Moment noch als experimentell aber als guten ersten Schritt f√ºr weitere Entwicklungen an. Logik hinter einem Decorator zu verstecken ist nat√ºrlich auch immer etwas <span aria-hidden=\"true\">‚ú®</span>Magie<span aria-hidden=\"true\">‚ú®</span>, da es auf den ersten Blick nicht ersichtlich ist, was konkret passiert. Da hier aber der Anwendungsfall relativ kompakt ist, sehe ich das als kein gro√ües Problem an.</p>\n<p>Jetzt bleibt meinerseits lediglich zu warten, bis seitens Lit die Unterst√ºtzung f√ºr &quot;Hybrid&quot;-Decorators kommt und Browser anfangen Standard-Decorators zu implementieren. In meinem n√§chsten Post wird es um einen weiteren Decorator und dazu passenden Anwendungsfall gehen.</p>\n</section>\n",
      "date_published": "2023-09-20T00:00:00Z"
    },{
      "id": "https://tony-spegel.com/blog/toc-observer/",
      "url": "https://tony-spegel.com/blog/toc-observer/",
      "title": "Table of Contents Component",
      "content_html": "<p>Eine Table of Contents (TOC) stellt ein Inhaltsverzeichnis dar und findet sich h√§ufig in Blogs oder Artikeln wieder. F√ºr meinen Blog (und alle die es nutzen m√∂chten), habe ich eine Component entwickelt, welche Links in einem TOC dynamisch hervorheben kann, sobald die dazugeh√∂rigen √úberschriften oder Abschnitte sichtbar werden. Eine Demo k√∂nnt ihr mobil im Header unter &quot;Inhalt&quot; oder neben dem Post an der Seite sehen.</p>\n<p>Links zum Download gibt es hier: <a href=\"https://github.com/TonySpegel/toc-observer\">GitHub</a>, <a href=\"https://www.npmjs.com/package/toc-observer-component\">NPM</a>.</p>\n<div class=\"disclaimer\">\n  <span>Hinweis</span>\n  <p>\n    Dieser Post geht davon aus, dass ihr euch schon ein wenig mit Web Components besch√§ftigt habt - wenn nicht, ist das aber auch in Ordnung.\n    Hier ein paar Links:\n  </p>\n<ul>\n<li><a href=\"https://developer.mozilla.org/en-US/docs/Web/Web_Components\">MDN Web Docs: Web Components</a></li>\n<li><a href=\"https://lit.dev/docs/\">lit.dev: What is Lit?</a></li>\n<li><a href=\"https://web.dev/learn/html/template/\">Learn HTML!: Template, slot, and shadow</a></li>\n</ul>\n</div>\n<section>\n<h2 id=\"ueberlegungen-zur-funktionsweise\"><a class=\"header-anchor\" href=\"https://tony-spegel.com/blog/toc-observer/#ueberlegungen-zur-funktionsweise\">√úberlegungen zur Funktionsweise</a></h2>\n<p>&quot;Live&quot;-Inhaltsverzeichnisse, wie zuvor beschrieben gibt es einige - unterscheiden kann man diese vor allem darin, ob diese Abschnitte oder √úberschriften hervorheben.</p>\n<figure style=\"max-inline-size: 620px\">\n  <img src=\"https://tony-spegel.com/img/2023/toc-observer/mdn-web-docs--toc-example.webp\" width=\"1055\" height=\"618\" alt=\"Beispielhaftes Inhaltsverzeichnis mit Textabschnitt des Artikels 'Web Components' von MDN Web Docs\" class=\"sample-img\" />\n  <figcaption>\n    Beispielhaftes\n    <a href=\"https://developer.mozilla.org/en-US/docs/Web/API/Web_components\" target=\"_blank\" rel=\"noopener noreferrer\">Inhaltsverzeichnis</a> von MDN Web Docs\n  </figcaption>\n</figure>\n<p>Hier am Beispiel der MDN Web Docs kann man sehen, dass der Men√ºpunkt &quot;Concepts and usage&quot; weiterhin hervorgehoben wird, obwohl von diesem Abschnitt nur noch eine Zeile lesbar ist und der Abschnitt &quot;Guides&quot; bereits einen viel gr√∂√üeren Platz einnimmt. Ich habe mich dann gefragt, was diese Art des Inhaltsverzeichnisses √ºberhaupt darstellen oder aussagen m√∂chte. Denn wenn die beiden Abschnitte gleich viel Platz einnehmen w√ºrden, w√§re immer noch &quot;Concepts and usage&quot; hervorgehoben. Aber geht es darum, was man gerade liest oder wo man sich im Post befindet? Insbesondere was man gerade liest, l√§sst sich ja nicht wirklich sagen. Nach etwas Recherche bin ich dann auf diesen <a href=\"https://www.bram.us/2020/01/10/smooth-scrolling-sticky-scrollspy-navigation/\">Post</a> von <a href=\"https://www.bram.us/about/\">Bramus Van Damme</a> gesto√üen - dieser schl√§gt folgendes, vereinfachtes Markup vor:</p>\n<pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>section</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>beschreibung<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>h2</span><span class=\"token punctuation\">></span></span>Beschreibung<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>h2</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>p</span><span class=\"token punctuation\">></span></span>‚Ä¶<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>p</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>section</span><span class=\"token punctuation\">></span></span></code></pre>\n<p>Also Abschnitte mit ID mit darauf folgender √úberschrift. Auf diese Art werden sp√§ter ganze Abschnitte erfasst und somit potentiell auch mehrere Links im TOC hervorgehoben. Das ist, wie ich finde, eine genauere Darstellung dessen was gerade auf der Seite angezeigt wird bzw. wo man sich gerade befindet. Weswegen diese Struktur aber f√ºr mich auch problematisch wurde, f√ºhre ich sp√§ter noch genauer aus. F√ºr diese Component gilt beispielhaft das folgende Markup:</p>\n<pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>toc-observer</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>ul</span> <span class=\"token attr-name\">slot</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>toc<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>li</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>a</span> <span class=\"token attr-name\">href</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>#beschreibung<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>Beschreibung<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>a</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>ul</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>li</span><span class=\"token punctuation\">></span></span>\n          <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>a</span> <span class=\"token attr-name\">href</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>#lebensweise<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>Lebensweise<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>a</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>li</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>li</span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>a</span> <span class=\"token attr-name\">href</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>#nahrung<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>Nahrung<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>a</span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>li</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>ul</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>li</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>ul</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>toc-observer</span><span class=\"token punctuation\">></span></span></code></pre>\n<p>Hierbei besonders wichtig ist, dass zum einen ein <code>ul</code> mit <code>slot=&quot;toc&quot;</code> vorhanden ist und zum anderen Links zu diesen passenden Abschnitten oder √úberschriften enthalten sind. Die Ordnung dieser √úberschriften ist dabei nicht von Relevanz.</p>\n</section>\n<section>\n<h2 id=\"intersection-observer-and-datenstruktur\"><a class=\"header-anchor\" href=\"https://tony-spegel.com/blog/toc-observer/#intersection-observer-and-datenstruktur\">IntersectionObserver &amp; Datenstruktur</a></h2>\n<p>Dieses &quot;Live&quot;-Inhaltsverzeichnis wird h√§ufig mit dem so genannten &quot;ScrollSpy&quot;-Feature in Verbindung gebracht und heutzutage mit dem <a href=\"https://developer.mozilla.org/en-US/docs/Web/API/Intersection_Observer_API\">IntersectionObserver</a> realisiert. Diese API ist in der Lage, dass √úberschneiden von Elementen mit einem Elternelement oder des Dokuments zu √ºberwachen und bietet somit genau das - was f√ºr diese Component ben√∂tigt wird.</p>\n<p>Die hier entstehende Component ist verh√§ltnism√§√üig kompakt, enth√§lt kein eigenes Styling und arbeitet vor allem (imperativ) mit dem <code>Slot</code>-Element.</p>\n<pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span>LitElement<span class=\"token punctuation\">,</span> html<span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'lit'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span>\n  customElement<span class=\"token punctuation\">,</span>\n  queryAssignedElements<span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'lit/decorators.js'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">customElement</span></span><span class=\"token punctuation\">(</span><span class=\"token string\">'toc-observer'</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">TocObserver</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">LitElement</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">/**\n   * Converts '_tocList' into a getter that returns the assignedElements of the given slot.\n   * Provides a declarative way to use HTMLSlotElement.assignedElements\n   */</span>\n  <span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">queryAssignedElements</span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>slot<span class=\"token operator\">:</span> <span class=\"token string\">'toc'</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">private</span> _tocList<span class=\"token operator\">?</span><span class=\"token operator\">:</span> <span class=\"token builtin\">Array</span><span class=\"token operator\">&lt;</span>HTMLUListElement<span class=\"token operator\">></span><span class=\"token punctuation\">;</span>\n  <span class=\"token comment\">/**\n   * Receive any items within '_tocList' if present\n   */</span>\n  <span class=\"token keyword\">private</span> <span class=\"token keyword\">get</span> <span class=\"token function\">_tocListItems</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> HTMLAnchorElement<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">|</span> <span class=\"token keyword\">null</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>_tocList<span class=\"token operator\">?.</span>length\n      <span class=\"token operator\">?</span> <span class=\"token punctuation\">[</span><span class=\"token operator\">...</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>_tocList<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token generic-function\"><span class=\"token function\">querySelectorAll</span><span class=\"token generic class-name\"><span class=\"token operator\">&lt;</span>HTMLAnchorElement<span class=\"token operator\">></span></span></span><span class=\"token punctuation\">(</span><span class=\"token string\">'[href^=\"#\"]'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span>\n      <span class=\"token operator\">:</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span></code></pre>\n<p>Wie zuvor demonstriert, wird das Inhaltsverzeichnis von &quot;au√üen&quot; √ºber eine mit dem Slot-Attribut versehene Liste in die Component gegeben. Das hat zur Folge, dass alle Kind-Elemente dieser Liste manuell, wie hier in der <code>_tocListItems</code> Methode gezeigt, selektiert werden m√ºssen.<br />\nDas Slot-Element selbst w√§hle ich mit Hilfe des <code>@queryAssignedElements</code>-<a href=\"https://lit.dev/docs/components/shadow-dom/#query-assigned-nodes\">Decorators</a> aus.</p>\n<p>Diese <code>_tocListItems</code> (die Links des TOC) bilden nun die Grundlage der (plural) IntersectionObserver. Grunds√§tzlich kann man n√§mlich entweder einen IntersectionObserver haben, welcher mehrere Elemente √ºberwacht oder jeweils einen pro Element. Ich habe mich f√ºr letzteres entschieden, da ich es als einfacher nachzuvollziehen empfunden habe. Angemessen w√§re noch ein Test, ob es hierbei zu Performanceeinbu√üen kommen kann. Diese Observer entsprechen als Datenstruktur folgender <code>Map</code>:</p>\n<pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">private</span> anchorHashObserverMap<span class=\"token operator\">:</span> Map<span class=\"token operator\">&lt;</span>\n  HTMLAnchorElement<span class=\"token punctuation\">[</span><span class=\"token string\">'hash'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n  IntersectionObserver\n<span class=\"token operator\">></span><span class=\"token punctuation\">;</span></code></pre>\n<p>oder vereinfacht am Beispiel:</p>\n<pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token punctuation\">[</span>\n  <span class=\"token punctuation\">[</span><span class=\"token string\">'#beschreibung'</span>, IntersectionObserver<span class=\"token punctuation\">]</span>,\n  <span class=\"token punctuation\">[</span><span class=\"token string\">'#lebensweise'</span>, IntersectionObserver<span class=\"token punctuation\">]</span>,\n  <span class=\"token punctuation\">[</span><span class=\"token string\">'#nahrung'</span>, IntersectionObserver<span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">]</span></code></pre>\n<p>Nun zum eigentlichen IntersectionObserver und zum hervorheben der Links:</p>\n<pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">private</span> <span class=\"token function\">createIdObserverMap</span><span class=\"token punctuation\">(</span>\n  anchors<span class=\"token operator\">:</span> HTMLAnchorElement<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> Map<span class=\"token operator\">&lt;</span>HTMLAnchorElement<span class=\"token punctuation\">[</span><span class=\"token string\">'hash'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> IntersectionObserver<span class=\"token operator\">></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Map</span><span class=\"token punctuation\">(</span>\n    anchors<span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>anchor<span class=\"token operator\">:</span> HTMLAnchorElement<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span>hash<span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> anchor<span class=\"token punctuation\">;</span>\n\n      <span class=\"token keyword\">return</span> <span class=\"token punctuation\">[</span>\n        hash<span class=\"token punctuation\">,</span>\n        <span class=\"token keyword\">new</span> <span class=\"token class-name\">IntersectionObserver</span><span class=\"token punctuation\">(</span>\n          <span class=\"token punctuation\">(</span>entries<span class=\"token operator\">:</span> IntersectionObserverEntry<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n            entries<span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>entry<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n              <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>entry<span class=\"token punctuation\">.</span>intersectionRatio <span class=\"token operator\">></span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">selectTocLink</span><span class=\"token punctuation\">(</span>hash<span class=\"token punctuation\">)</span><span class=\"token operator\">?.</span>classList<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>tocActiveClass<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n                <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span>\n              <span class=\"token punctuation\">}</span>\n\n              <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">selectTocLink</span><span class=\"token punctuation\">(</span>hash<span class=\"token punctuation\">)</span><span class=\"token operator\">?.</span>classList<span class=\"token punctuation\">.</span><span class=\"token function\">remove</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>tocActiveClass<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n          <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n          <span class=\"token comment\">// IntersectionObserver options</span>\n          <span class=\"token punctuation\">{</span>\n            root<span class=\"token operator\">:</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>ownerDocument<span class=\"token punctuation\">.</span><span class=\"token function\">querySelector</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>rootElement<span class=\"token operator\">!</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">||</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span>\n            rootMargin<span class=\"token operator\">:</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>rootMargin<span class=\"token punctuation\">,</span>\n          <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<p>Mit diesem Code iteriere ich √ºber ein Array von Links, extrahiere jeweils den Hash um diesen in der <code>selectTocLink</code>-Methode als Selektor zu nutzen.<br />\nZu diesen ausgew√§hlten Links, wird dann eine CSS Klasse hinzugef√ºgt/entfernt, sobald der dazugeh√∂rige Observer einen <code>intersectionRatio</code>-Wert von gr√∂√üer/kleiner 0 besitzt.</p>\n<pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">private</span> <span class=\"token function\">selectTocLink</span><span class=\"token punctuation\">(</span>id<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> HTMLAnchorElement <span class=\"token operator\">|</span> <span class=\"token keyword\">null</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>_tocList<span class=\"token operator\">?.</span>length\n    <span class=\"token operator\">?</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>_tocList<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token generic-function\"><span class=\"token function\">querySelector</span><span class=\"token generic class-name\"><span class=\"token operator\">&lt;</span>HTMLAnchorElement<span class=\"token operator\">></span></span></span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">[href=\"</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>id<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">\"]</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span>\n    <span class=\"token operator\">:</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<p>Auch hier wieder manuelles selektieren der Links. Das ist eigentlich ganz grob auch schon alles, was die reine Funktionalit√§t betrifft. Aber wie eingangs erw√§hnt, bringt die Entscheidung auch Abschnitte zu unterst√ºtzen ein paar Herausforderungen mit sich, auf die ich im n√§chsten Abschnitt eingehe.</p>\n</section>\n<section>\n<h2 id=\"verschiedene-html-strukturen-unterstuetzen\"><a class=\"header-anchor\" href=\"https://tony-spegel.com/blog/toc-observer/#verschiedene-html-strukturen-unterstuetzen\">Verschiedene HTML Strukturen unterst√ºtzen</a></h2>\n<p>Das eingangs erw√§hnte, vereinfachte Markup geht davon aus, dass Sections eine ID besitzen. √úblicher ist es aber in Static site generators (SSG), eine Section zu haben auf die eine √úberschrift mit ID und einem Link folgt. Also eher so:</p>\n<pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>section</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>h2</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>beschreibung<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>a</span> <span class=\"token attr-name\">href</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>#beschreibung<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>Beschreibung<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>a</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>h2</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>p</span><span class=\"token punctuation\">></span></span>Opossums sind die gr√∂√üten Beutelratten.<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>p</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>section</span><span class=\"token punctuation\">></span></span></code></pre>\n<p>Das liegt daran, dass solche SSG h√§ufig mit Markdown-Dateien arbeiten und anhand derer HTML erzeugt wird. Es ist also naheliegend, die ID direkt an √úberschriften anzuh√§ngen.</p>\n<pre class=\"language-md\"><code class=\"language-md\"><span class=\"token title important\"><span class=\"token punctuation\">##</span> Beschreibung</span>\nOpossums sind die gr√∂√üten Beutelratten.</code></pre>\n<p>Das Problem hiermit ist, dass man nun ausgehend vom Link dessen Elternelement ausw√§hlen muss, wenn man eine Section √ºberwachen m√∂chte. Am einfachsten w√§re es, den CSS Selektor <code>:has()</code> zu nutzen - Stand jetzt wird dieser aber noch nicht von allen Browsern unterst√ºtzt.</p>\n<pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token comment\">/**\n * Useful for observing nested markup like this:\n * &lt;section>\n *   &lt;!-- ^observe -->\n *   &lt;h2 id=\"possum\">Possum&lt;/h2>\n * &lt;/section>\n *\n * Observing wrapper elements instead of just headings\n * has the advantage that those have more area to intersect with.\n *\n *     ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\n *     ‚îÇ #possum ‚îÇ\n *   ‚îå‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îê\n *   ‚îÇ ‚îÇ         ‚îÇ ‚îÇ\n *   ‚îÇ ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ&lt; Viewport\n *   ‚îÇ ^section    ‚îÇ\n *   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò\n */</span>\n<span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">property</span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>type<span class=\"token operator\">:</span> Boolean<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">public</span> observeParent <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// Should be used together with observeParent</span>\n<span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">property</span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>type<span class=\"token operator\">:</span> String<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">public</span> parentSelector <span class=\"token operator\">=</span> <span class=\"token string\">'section'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">/**\n * The 'firstUpdated' lifecycle is called after the component's DOM\n * has been updated the first time, immediately before updated() is called.\n * Only then an element's slot content (our toc items) is available and can be observed.\n */</span>\noverride <span class=\"token function\">firstUpdated</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token keyword\">void</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// Observe items when at least one is available</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>_tocListItems<span class=\"token operator\">?.</span>length<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>anchorHashObserverMap <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">createIdObserverMap</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>_tocListItems<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>anchorHashObserverMap<span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>observer<span class=\"token punctuation\">,</span> anchorHash<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">const</span> item <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>ownerDocument<span class=\"token punctuation\">.</span><span class=\"token function\">querySelector</span><span class=\"token punctuation\">(</span>anchorHash<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>observeParent <span class=\"token operator\">===</span> <span class=\"token boolean\">false</span> <span class=\"token operator\">&amp;&amp;</span> item<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        observer<span class=\"token punctuation\">.</span><span class=\"token function\">observe</span><span class=\"token punctuation\">(</span>item<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span>\n\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>observeParent <span class=\"token operator\">===</span> <span class=\"token boolean\">true</span> <span class=\"token operator\">&amp;&amp;</span>\n        item<span class=\"token operator\">!</span><span class=\"token punctuation\">.</span><span class=\"token function\">closest</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>parentSelector<span class=\"token punctuation\">)</span> <span class=\"token operator\">!==</span> <span class=\"token keyword\">null</span>\n      <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        observer<span class=\"token punctuation\">.</span><span class=\"token function\">observe</span><span class=\"token punctuation\">(</span>item<span class=\"token operator\">!</span><span class=\"token punctuation\">.</span><span class=\"token function\">closest</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>parentSelector<span class=\"token punctuation\">)</span><span class=\"token operator\">!</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<p>Die hier verwendete <code>firstUpdated</code> Methode ist ein so genannter <a href=\"https://lit.dev/docs/components/lifecycle/\">Lifecycle</a> und wie in dessen Kommentar beschrieben, der Zeitpunkt, an dem der Inhalt des Slots verf√ºgbar ist. Es wird die <code>anchorHashObserverMap</code> erstellt und die enthaltenen Observer beginnen ihre Elemente zu √ºberwachen. Abh√§ngig davon, ob die Component mit dem <code>observeParent</code>-Attribut versehen wird oder nicht, wird entweder by default ein Abschnitt oder ein beliebig w√§hlbares Element √ºberwacht.</p>\n<pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>toc-observer</span> <span class=\"token attr-name\">observeParent</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>ul</span> <span class=\"token attr-name\">slot</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>toc<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>ul</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>toc-observer</span><span class=\"token punctuation\">></span></span></code></pre>\n<p>√úbrig bleibt nun nur noch, das √úberwachen der Elemente zu beenden, f√ºr den Fall das <code>&lt;toc-observer&gt;</code> aus dem DOM entfernt wird. Auch das. l√§sst sich bequem in einem Lifecycle l√∂sen:</p>\n<pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token comment\">/**\n * Stop observing when the component is removed from the DOM\n */</span>\noverride <span class=\"token function\">disconnectedCallback</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token keyword\">void</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">/**\n   * As there are no toc-items left to highlight,\n   * observing elements should be stopped\n   */</span>\n  <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>anchorHashObserverMap<span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>obs<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> obs<span class=\"token punctuation\">.</span><span class=\"token function\">disconnect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<p>Eine Lit Web Component besitzt au√üerdem eine <code>render</code>-<a href=\"https://lit.dev/docs/components/rendering/\">Methode</a>. Diese f√§llt allerdings sehr kurz aus, da die Component ausschlie√ülich imperativ mit dem Inhalt des Slots arbeitet.</p>\n<pre class=\"language-typescript\"><code class=\"language-typescript\">override <span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> html<span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">&lt;slot name=\"toc\">&lt;/slot></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre>\n</section>\n<section>\n<h2 id=\"limitationen-and-fazit\"><a class=\"header-anchor\" href=\"https://tony-spegel.com/blog/toc-observer/#limitationen-and-fazit\">Limitationen &amp; Fazit</a></h2>\n<p>Das imperative selektieren von DOM-Elementen au√üerhalb des Shadow-DOM f√ºhlt sich meiner Empfindung nach immer etwas umst√§ndlich an, da nicht direkt ersichtlich ist, in welchem Zusammenhang Logik und User Interface stehen und man sich darauf verlassen muss, dass die hinzugef√ºgten Elemente den intern vorhergesehenen entsprechen. Als Limitation sehe ich, dass im Moment noch die (reactive) <code>observeParent</code>-Property verwendet werden muss, statt auf den CSS-Selektor <code>:has()</code> zur√ºckgreifen zu k√∂nnen. Au√üerdem ist der Hash in <code>Map&lt;HTMLAnchorElement['hash'], IntersectionObserver&gt;</code> doch nicht ganz ideal, da so auch Elemente erfasst werden, die lediglich als Sprungmarken zu √úberschriften gedacht sind. Als Verbesserung werde ich den Selektor konfigurierbar machen, so dass dieser spezifischer ist und nur die Elemente √ºberwacht werden, welche wirklich relevant sind.</p>\n</section>\n",
      "date_published": "2023-04-28T00:00:00Z"
    },{
      "id": "https://tony-spegel.com/blog/image-comparison-component/",
      "url": "https://tony-spegel.com/blog/image-comparison-component/",
      "title": "Image Comparison Component",
      "content_html": "<p>In diesem Post geht es darum, eine Component zu entwickeln, welche es erm√∂glicht, Bilder auf verschiedene Arten zu vergleichen. Bilder k√∂nnen mit einem Slider, einem Overlay oder in einer Split-Ansicht verglichen werden.</p>\n<image-comparison variant=\"slider\" sliderPrompt=\"Slider bewegen, um zu vergleichen\" overlayPrompt=\"Tippen und gedr√ºckt halten, um zu vergleichen\" class=\"post-img\" id=\"image-comparison-demo\">\n  <label slot=\"label-before\">Ohne Filter</label>\n  <label slot=\"label-after\">Graustufen</label>\n  <img slot=\"image-before\" src=\"https://tony-spegel.com/img/2023/image-comparison/2022_1004_14254000-w3120--opt.jpg\" width=\"440\" alt=\"Blumen in Paris\" />\n  <img slot=\"image-after\" src=\"https://tony-spegel.com/img/2023/image-comparison/2022_1004_14254000-w3120_grayscale--opt.jpg\" width=\"440\" alt=\"Blumen in Paris dargestellt in Graustufen\" />\n</image-comparison>\n<div class=\"slider-set-wrapper\">\n  <fieldset id=\"slider-variant-set\" class=\"slider-set\">\n    <legend>Variante</legend>\n    <div>\n      <input type=\"radio\" id=\"slider-variant\" name=\"variant\" value=\"slider\" checked=\"\" />\n      <label for=\"slider-variant\">Slider</label>\n    </div>\n    <div>\n      <input type=\"radio\" id=\"overlay-variant\" name=\"variant\" value=\"overlay\" />\n      <label for=\"overlay-variant\">Overlay</label>\n    </div>\n    <div>\n      <input type=\"radio\" id=\"split-variant\" name=\"variant\" value=\"split\" />\n      <label for=\"split-variant\">Split</label>\n    </div>\n  </fieldset>\n  <!-- <fieldset id=\"slider-reading-direction-set\" class=\"slider-set\">\n    <legend>Leserichtung</legend>\n    <div>\n      <input type=\"radio\" id=\"ltr\" name=\"reading-direction\" value=\"ltr\" checked>\n      <label for=\"ltr\">Left To Right (LTR)</label>\n    </div>\n    <div>\n      <input type=\"radio\" id=\"rtl\" name=\"reading-direction\" value=\"rtl\">\n      <label for=\"rtl\">Right To Left (RTL)</label>\n    </div>\n  </fieldset> -->\n</div>\n<p><code>&lt;image-comparison&gt;</code> unterst√ºtzt neben diesen Varianten diverse Tastaturk√ºrzel, verschiedene Leserichtungen, Custom Events und ist durch Slots, Attribute und CSS Custom Properties konfigurierbar. Im Folgenden gehe ich auf diese Aspekte ein und beginne mit dem Slider.</p>\n<p>Ist es sinnvoll, mehrere Components in einer zu vereinen? tl;dr: <a href=\"https://tony-spegel.com/blog/image-comparison-component/#warum-das-eigentlich-nicht-sinnvoll-ist\">In diesem Fall eigentlich nicht</a>.</p>\n<p><a href=\"https://github.com/TonySpegel/image-comparison\">GitHub</a>, <a href=\"https://npmjs.com/package/image-comparison-component\">NPM</a>, <a href=\"https://lit.dev/playground/#gist=2b393dfba73ce32f7b3426492142b926\">Lit Playground</a></p>\n<hr />\n<div class=\"disclaimer\">\n  <span>Hinweis</span>\n  <p>\n    Dieser Post geht davon aus, dass ihr euch schon ein wenig mit Web Components besch√§ftigt habt - wenn nicht, ist das aber auch in Ordnung.\n    Hier ein paar Links:\n  </p>\n<ul>\n<li><a href=\"https://developer.mozilla.org/en-US/docs/Web/Web_Components\">MDN Web Docs: Web Components</a></li>\n<li><a href=\"https://lit.dev/docs/\">lit.dev: What is Lit?</a></li>\n<li><a href=\"https://web.dev/learn/html/template/\">Learn HTML!: Template, slot, and shadow</a></li>\n</ul>\n</div>\n<section>\n<h2 id=\"slider\"><a class=\"header-anchor\" href=\"https://tony-spegel.com/blog/image-comparison-component/#slider\">Slider</a></h2>\n<p>Die Slider-Variante ist die komplexeste der drei Varianten. Komplex vor allem durch die vielseitigen Interaktions- und Konfigurationsm√∂glichkeiten aber weniger durch das CSS.</p>\n<section>\n<h3 id=\"html-and-css\"><a class=\"header-anchor\" href=\"https://tony-spegel.com/blog/image-comparison-component/#html-and-css\">HTML &amp; CSS</a></h3>\n<p>Wenn man die Component nutzen m√∂chte, gilt folgendes HTML. Die Label sind zwar optional aber zumindest die <code>alt</code>-Attribute der Bilder sollten gesetzt werden:</p>\n<pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>image-comparison</span>\n  <span class=\"token attr-name\">variant</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>slider<span class=\"token punctuation\">\"</span></span>\n  <span class=\"token attr-name\">sliderPrompt</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>Move the slider to compare<span class=\"token punctuation\">\"</span></span>\n  <span class=\"token attr-name\">overlayPrompt</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>Tap and hold to compare<span class=\"token punctuation\">\"</span></span>\n<span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>label</span> <span class=\"token attr-name\">slot</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>label-before<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>Ohne Filter<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>label</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>label</span> <span class=\"token attr-name\">slot</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>label-after<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>Graustufen<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>label</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>img</span> <span class=\"token attr-name\">slot</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>image-before<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">src</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>/img/2023/before.jpg<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">alt</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>Rote Zierquitte<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>img</span> <span class=\"token attr-name\">slot</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>image-after<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">src</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>/img/2023/after.jpg<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">alt</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>Rote Zierquitte (Graustufen)<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>image-comparison</span><span class=\"token punctuation\">></span></span></code></pre>\n<p>Auff√§llig sind hierbei vor allem die drei gesetzten Attribute sowie die zwei Label und Bildelemente. Die <code>variant</code> bestimmt sowohl das Verhalten als auch das Aussehen der Component, die beiden Prompt-Attribute geben kurze Hinweise zur Interaktion. Die sogenannten <code>slot</code>-Attribute sind eine Eigenheit der Web Components und k√∂nnen als eine Art Schnittstelle gesehen werden. In dieser Component werden sie genutzt, um die zu vergleichenden Bilder sowie deren Label anzuzeigen. Intern folgt das HTML diesem vereinfachten Schema:</p>\n<pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>image-container<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>slot</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>label-before<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>slot</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>slot</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>label-after<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>slot</span><span class=\"token punctuation\">></span></span>\n\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>container-before<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>slot</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>image-before<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>slot</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>container-after<span class=\"token punctuation\">\"</span></span> <span class=\"token special-attr\"><span class=\"token attr-name\">style</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span><span class=\"token value css language-css\"><span class=\"token property\">clip-path</span><span class=\"token punctuation\">:</span> <span class=\"token function\">inset</span><span class=\"token punctuation\">(</span>0 50% 0 0<span class=\"token punctuation\">)</span></span><span class=\"token punctuation\">\"</span></span></span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>slot</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>image-after<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>slot</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>button</span> <span class=\"token special-attr\"><span class=\"token attr-name\">style</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span><span class=\"token value css language-css\"><span class=\"token property\">left</span><span class=\"token punctuation\">:</span> 50%</span><span class=\"token punctuation\">\"</span></span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>button</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span></code></pre>\n<p>Neben zus√§tzlichem Markup, wie dem Button, steckt der gr√∂√üte Teil der <span aria-hidden=\"true\">‚ú®</span>Magie<span aria-hidden=\"true\">‚ú®</span> in der <code>clip-path: inset(0 50% 0 0)</code>-Anweisung des zweiten Containers. Der umliegende Container an sich ist schnell erkl√§rt:</p>\n<pre class=\"language-css\"><code class=\"language-css\"><span class=\"token selector\">#image-container</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token property\">display</span><span class=\"token punctuation\">:</span> inline-grid<span class=\"token punctuation\">;</span>\n  <span class=\"token property\">grid-template-areas</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"images\"</span><span class=\"token punctuation\">;</span>\n  <span class=\"token property\">overflow</span><span class=\"token punctuation\">:</span> hidden<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<p>Ich setze hier vor allem deswegen auf ein Grid-Layout, damit ich die verschiedenen Elemente einfach √ºbereinander stapeln kann. Dazu nutze ich <code>grid-template-areas: &quot;images&quot;</code> um mich in den √ºbrigen Elementen auf dieses beziehen zu k√∂nnen. <code>overflow: hidden</code> wird dann gesetzt, um den dann √ºberstehenden Divider des Buttons abzuschneiden.</p>\n<pre class=\"language-css\"><code class=\"language-css\"><span class=\"token selector\">#container-before, #container-after</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token property\">grid-area</span><span class=\"token punctuation\">:</span> images<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token selector\">button</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token property\">grid-area</span><span class=\"token punctuation\">:</span> images<span class=\"token punctuation\">;</span>\n  <span class=\"token property\">align-self</span><span class=\"token punctuation\">:</span> center<span class=\"token punctuation\">;</span>\n  <span class=\"token property\">position</span><span class=\"token punctuation\">:</span> relative<span class=\"token punctuation\">;</span>\n\n  <span class=\"token property\">border</span><span class=\"token punctuation\">:</span> <span class=\"token function\">var</span><span class=\"token punctuation\">(</span>--thumb-border-width<span class=\"token punctuation\">)</span> solid <span class=\"token function\">var</span><span class=\"token punctuation\">(</span>--slider-color<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token property\">border-radius</span><span class=\"token punctuation\">:</span> 50%<span class=\"token punctuation\">;</span>\n  <span class=\"token property\">width</span><span class=\"token punctuation\">:</span> <span class=\"token function\">var</span><span class=\"token punctuation\">(</span>--thumb-size<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token property\">aspect-ratio</span><span class=\"token punctuation\">:</span> 1<span class=\"token punctuation\">;</span>\n  <span class=\"token property\">transform</span><span class=\"token punctuation\">:</span> <span class=\"token function\">translateX</span><span class=\"token punctuation\">(</span>-50%<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token property\">cursor</span><span class=\"token punctuation\">:</span> col-resize<span class=\"token punctuation\">;</span>\n  <span class=\"token property\">background-color</span><span class=\"token punctuation\">:</span> transparent<span class=\"token punctuation\">;</span>\n  <span class=\"token property\">z-index</span><span class=\"token punctuation\">:</span> 3<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token selector\">button:before, button:after</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token property\">content</span><span class=\"token punctuation\">:</span> <span class=\"token string\">''</span><span class=\"token punctuation\">;</span>\n  <span class=\"token property\">width</span><span class=\"token punctuation\">:</span> <span class=\"token function\">var</span><span class=\"token punctuation\">(</span>--thumb-bar-width<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token property\">left</span><span class=\"token punctuation\">:</span> <span class=\"token function\">calc</span><span class=\"token punctuation\">(</span>50% - <span class=\"token function\">calc</span><span class=\"token punctuation\">(</span><span class=\"token function\">var</span><span class=\"token punctuation\">(</span>--thumb-bar-width<span class=\"token punctuation\">)</span> / 2<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token property\">background-color</span><span class=\"token punctuation\">:</span> <span class=\"token function\">var</span><span class=\"token punctuation\">(</span>--slider-color<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token property\">position</span><span class=\"token punctuation\">:</span> absolute<span class=\"token punctuation\">;</span>\n  <span class=\"token property\">height</span><span class=\"token punctuation\">:</span> 100vh<span class=\"token punctuation\">;</span>\n  <span class=\"token property\">z-index</span><span class=\"token punctuation\">:</span> -1<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token selector\">button:before</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token property\">bottom</span><span class=\"token punctuation\">:</span> <span class=\"token function\">calc</span><span class=\"token punctuation\">(</span>50% + <span class=\"token function\">calc</span><span class=\"token punctuation\">(</span><span class=\"token function\">var</span><span class=\"token punctuation\">(</span>--thumb-size<span class=\"token punctuation\">)</span> / 2<span class=\"token punctuation\">)</span> - <span class=\"token function\">calc</span><span class=\"token punctuation\">(</span><span class=\"token function\">var</span><span class=\"token punctuation\">(</span>--thumb-border-width<span class=\"token punctuation\">)</span> / 2<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token selector\">button:after</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token property\">top</span><span class=\"token punctuation\">:</span> <span class=\"token function\">calc</span><span class=\"token punctuation\">(</span><span class=\"token function\">var</span><span class=\"token punctuation\">(</span>--thumb-size<span class=\"token punctuation\">)</span> - <span class=\"token function\">var</span><span class=\"token punctuation\">(</span>--thumb-border-width<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<p>Wie am Anfang beschrieben, werden nun beide Container sowie der Button mit <code>grid-area: images</code> √ºbereinander gestapelt. Die Reihenfolge im Markup entscheidet dann dar√ºber, welches Element ganz oben liegt - hier ist es der Button. Dieser wird dann mit <code>align-self: center</code> vertikal zentriert und horizontal um die H√§lfte der eigenen Breite verschoben. Um dann schlie√ülich den Divider des Sliders zu erzeugen, positioniere ich einfach die Pseudo-Elemente <code>:before</code> und <code>:after</code> ober- und unterhalb des Buttons und nutze daf√ºr einige CSS Variablen. Auf diese Weise habe ich zwar einige Variablen aber das macht es f√ºr mich nachvollziehbarer und einfacher zu rechnen, was wie platziert wird.<br />\nAu√üerdem ist es so f√ºr Dritte ebenso leichter weil klar ist, was angepasst werden kann. Das war es auf der CSS Seite des Sliders. Eine Demo zu diesem Stand k√∂nnt ihr auf <a href=\"https://codepen.io/TonySpegel/pen/oNabodW?editors=1100\">Codepen</a> betrachten.</p>\n</section>\n<section>\n<h3 id=\"entwicklung-der-slider-funktion\"><a class=\"header-anchor\" href=\"https://tony-spegel.com/blog/image-comparison-component/#entwicklung-der-slider-funktion\">Entwicklung der Slider-Funktion</a></h3>\n<p>Die wichtigste Information, welche der Slider ben√∂tigt, ist die Position des Dividers.</p>\n<pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">ImageComparison</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">LitElement</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">property</span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> type<span class=\"token operator\">:</span> Number<span class=\"token punctuation\">,</span> reflect<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">public</span> sliderPosition<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span> <span class=\"token operator\">=</span> <span class=\"token number\">50</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<p>Lit nutzt an vielen Stellen so genannte Decorators, ein Pattern welches es einem erm√∂glicht, verschiedene Konstrukte mit zus√§tzlicher Funktionalit√§t zu erweitern. Dazu ein Zitat aus der offiziellen <a href=\"https://lit.dev/docs/components/properties/\">Dokumentation</a>:</p>\n<blockquote cite=\"https://lit.dev/docs/components/properties/\">\n\"Lit components receive input and store their state as JavaScript class fields or properties. Reactive properties are properties that can trigger the reactive update cycle when changed, re-rendering the component, and optionally be read or written to attributes.\"\n</blockquote>\n<p>In diesem Decorator werden zwei <a href=\"https://lit.dev/docs/components/properties/#property-options\">Optionen</a> genutzt. Zum einen <code>type</code>, diese gibt an auf welche Art ein Attribut intern konvertiert werden soll. Zum anderen sorgt <code>reflect</code> daf√ºr, dass der interne Wert auch wieder nach au√üen an das Attribut gegeben wird. Vereinfacht ausgedr√ºckt, erm√∂glicht das eine Synchronisation des √§u√üeren wie inneren Zustands.</p>\n<pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token operator\">&lt;</span>image<span class=\"token operator\">-</span>comparison sliderposition<span class=\"token operator\">=</span><span class=\"token string\">\"50\"</span> variant<span class=\"token operator\">=</span><span class=\"token string\">\"slider\"</span><span class=\"token operator\">></span><span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>image<span class=\"token operator\">-</span>comparison<span class=\"token operator\">></span>\n<span class=\"token comment\">// ‚Üì‚Üë</span>\n<span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">property</span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> type<span class=\"token operator\">:</span> Number<span class=\"token punctuation\">,</span> reflect<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">public</span> sliderPosition<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span> <span class=\"token operator\">=</span> <span class=\"token number\">50</span><span class=\"token punctuation\">;</span></code></pre>\n<p>Jetzt zur eigentlichen Funktionalit√§t, welche diesen Wert setzen wird. Lit setzt grunds√§tzlich auf einen deklarativen Ansatz, um dessen Templates zu beschreiben. Statt Schritt f√ºr Schritt anzugeben, wie sich ein Template ver√§ndert, gibt man in deklarativen Ans√§tzen vor, wie ein Template in dessen finalen Zustand auszusehen hat. Das bedeutet nicht, dass man nicht beide Ans√§tzen mischen kann.</p>\n<p>Dazu folgt der grunds√§tzliche weitere Aufbau des Templates. Alles was im Template anzuzeigen ist, wird in der <code>render()</code>-Methode aufgerufen:</p>\n<pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">ImageComparison</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">LitElement</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">property</span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> type<span class=\"token operator\">:</span> Number<span class=\"token punctuation\">,</span> reflect<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">public</span> sliderPosition<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span> <span class=\"token operator\">=</span> <span class=\"token number\">50</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">state</span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">private</span> isRtl<span class=\"token operator\">:</span> <span class=\"token builtin\">boolean</span> <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> html<span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">\n      &lt;div id=\"image-container\">\n        &lt;slot name=\"label-before\">&lt;/slot>\n        &lt;slot name=\"label-after\">&lt;/slot>\n\n        &lt;div id=\"container-before\">\n          &lt;slot name=\"image-before\">&lt;/slot>\n        &lt;/div>\n\n        &lt;div\n          id=\"container-after\"\n          style=</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>isRtl\n            <span class=\"token operator\">?</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">clip-path: inset(0 </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>sliderPosition<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">% 0 0)</span><span class=\"token template-punctuation string\">`</span></span>\n            <span class=\"token operator\">:</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">clip-path: inset(0 0 0 </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>sliderPosition<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">%)</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">\n        >\n          &lt;slot name=\"image-after\">&lt;/slot>\n        &lt;/div>\n\n        &lt;button\n          @mousedown=</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">setSlidingState</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token punctuation\">}</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">\n          @mousemove=</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token punctuation\">(</span>e<span class=\"token operator\">:</span> MouseEvent<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">slideCompareHandler</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">\n          style=\"</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">left: </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>\n            <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>isRtl <span class=\"token operator\">?</span> <span class=\"token operator\">-</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>sliderPosition <span class=\"token operator\">:</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>sliderPosition\n          <span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">%</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">\"\n        >\n        &lt;/button>\n      &lt;/div>\n    </span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<p>Hier nutze ich zwei neue Konzepte im Lit Kontext: die <a href=\"https://lit.dev/docs/components/events/#adding-event-listeners-in-the-element-template\">@-Syntax</a> definiert JavaScript-typische EventListener, der <code>@state()</code>-Decorator einen ausschlie√ülich internen Zustand. Inbesondere <code>isRtl</code> wird sp√§ter wichtig sein, um eine so genannte Right-to-left (RTL) script Unterst√ºtzung, also Sprachen welche von Rechts nach Links gelesen werden, zu bieten. Hier hat das den einfachen Hintergrund, dass ich das Vorzeichen im <code>left</code>-Attribut √§ndern oder im <code>inset()</code> das Rechteck von der anderen Seite aus aufziehen kann.</p>\n<p>Jetzt zu den eigentlichen Methoden, ich gehe dabei nur auf die wirklich wichtigen und etwas komplizierteren ein:</p>\n<pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token keyword\">private</span> slideCompareHandler <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>event<span class=\"token operator\">:</span> MouseEvent <span class=\"token operator\">|</span> TouchEvent<span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token keyword\">void</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">slideCompare</span><span class=\"token punctuation\">(</span>event<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">/**\n * Converts 'cursor' position and updates the UI accordingly\n */</span>\n<span class=\"token keyword\">private</span> slideCompare <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>event<span class=\"token operator\">:</span> MouseEvent <span class=\"token operator\">|</span> TouchEvent<span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token keyword\">void</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>slidingActive<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">let</span> pos <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">convertCursorToSliderPosition</span><span class=\"token punctuation\">(</span>event<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    pos <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>isRtl <span class=\"token operator\">?</span> <span class=\"token number\">100</span> <span class=\"token operator\">-</span> pos <span class=\"token operator\">:</span> pos<span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>sliderPosition <span class=\"token operator\">=</span> pos<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre>\n<p>Wenn <code>slidingActive</code> wahr ist, wird die Cursor-Position relativ zur Container-Position konvertiert und abh√§ngig von der Leserichtung gesetzt.<br />\n√úbrigens sieht man hier auch gut, dass nicht alles deklarativ sein kann und interne Werte nat√ºrlich auch imperativ gesetzt werden.</p>\n<pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token keyword\">const</span> clamp <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>num<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">,</span> min<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">,</span> max<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token builtin\">number</span> <span class=\"token operator\">=></span>\n  Math<span class=\"token punctuation\">.</span><span class=\"token function\">min</span><span class=\"token punctuation\">(</span>Math<span class=\"token punctuation\">.</span><span class=\"token function\">max</span><span class=\"token punctuation\">(</span>num<span class=\"token punctuation\">,</span> min<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> max<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">/**\n * The relative position of a cursor (as in: a touch or mouse device)\n * is converted into a clamped slider position value\n */</span>\n<span class=\"token function\">convertCursorToSliderPosition</span><span class=\"token punctuation\">(</span>event<span class=\"token operator\">:</span> TouchEvent <span class=\"token operator\">|</span> MouseEvent<span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token builtin\">number</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> left<span class=\"token punctuation\">,</span> width <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>imageContainer<span class=\"token punctuation\">.</span><span class=\"token function\">getBoundingClientRect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> scrollX <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> window<span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">const</span> pageX <span class=\"token operator\">=</span> event <span class=\"token keyword\">instanceof</span> <span class=\"token class-name\">MouseEvent</span> <span class=\"token operator\">?</span>\n    event<span class=\"token punctuation\">.</span>pageX <span class=\"token operator\">:</span>\n    event<span class=\"token punctuation\">.</span>changedTouches<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>pageX<span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">const</span> xOffset <span class=\"token operator\">=</span> left <span class=\"token operator\">+</span> scrollX<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> x <span class=\"token operator\">=</span> pageX <span class=\"token operator\">-</span> xOffset<span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">const</span> sliderPostion <span class=\"token operator\">=</span> <span class=\"token function\">parseFloat</span><span class=\"token punctuation\">(</span>\n    <span class=\"token function\">clamp</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>x <span class=\"token operator\">/</span> width<span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> <span class=\"token number\">100</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">100</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toFixed</span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">return</span> sliderPostion<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<p>Abh√§ngig davon ob es sich beim ausgef√ºhrten Event um ein <code>Touch</code>- oder <code>Mouse</code>-Event handelt, stehen unterschiedliche Properties zur Verf√ºgung. In beiden F√§llen wird jedoch <code>getBoundingClientRect()</code> genutzt, um die Position und Breite des Containers zu ermitteln. Mit Hilfe dieser wird in Abh√§ngigkeit dann bestimmt, wo sich das Eingabeger√§t relativ zu diesem befindet, um am Ende diesen Wert in eine Zahl zwischen 0 und 100 zu konvertieren. Ich gebe zu, dass das etwas kompliziert und nicht einfach zu verstehen ist - aber damit werden diverse Eventualit√§ten abgedeckt die sonst zu einem Fehlverhalten f√ºhren w√ºrden.</p>\n<p>Im Grunde genommen ist, dass die Funktionalit√§t die notwendig ist, um den Slider zu bewegen und Bilder vergleichen zu k√∂nnen. Das allein ist aber noch nicht ausreichend. Zum einen muss noch der Barrierefreiheit wegen (unter anderem) eine Tastatur Unterst√ºtzung und zum anderen etwas was ich Housekeeping nenne, implementiert werden.</p>\n</section>\n<section>\n<h3 id=\"barrierefreiheit-des-sliders\"><a class=\"header-anchor\" href=\"https://tony-spegel.com/blog/image-comparison-component/#barrierefreiheit-des-sliders\">Barrierefreiheit des Sliders</a></h3>\n<p>Zur Barrierefreiheit des Sliders z√§hle ich, dass dieser nicht nur mit einer Maus, sondern m√∂glichst mit beliebigen Eingabeger√§ten genutzt werden kann und auch seinen internen Zustand nach au√üen an Screenreader zu kommunizieren wei√ü. Wenn es darum geht, m√∂glichst barrierefreie L√∂sungen zu entwickeln, ist die <a href=\"https://www.w3.org/WAI/ARIA/apg/patterns/\">Patterns</a> Seite des W3C ein optimaler Einstieg. Diese bietet diverse, immer wiederkehrende, Patterns wie beispielsweise Tabs, Slide Shows und √§hnliches an und geht dabei auf deren Besonderheiten ein. Das <a href=\"https://www.w3.org/WAI/ARIA/apg/patterns/windowsplitter/\">Window Splitter</a> Pattern passt hierbei am ehesten zur Slider-Variante.<br />\nUm Tastatureingaben abzufangen, extrahiere ich aus dem <code>KeyboardEvent</code> zum einen die gedr√ºckten Tasten, zu denen vor allem die Cursortasten z√§hlen sowie <code>ctrlKey</code>, <code>metaKey</code> (<kbd>Win</kbd> / <kbd>‚åò</kbd>) und <code>shiftKey</code>, um diese in Kombination mit den Cursortasten zu nutzen.</p>\n<pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token comment\">/**\n * Applied when shift is pressed with an arrow key (variant 'slider')\n */</span>\n<span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">property</span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> type<span class=\"token operator\">:</span> Number <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">private</span> sliderSteps<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span> <span class=\"token operator\">=</span> <span class=\"token number\">5</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">/**\n * Handle arrow, home &amp; end keys and use more steps when shift is pressed\n */</span>\n<span class=\"token keyword\">private</span> keyboardSliderHandler <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>event<span class=\"token operator\">:</span> KeyboardEvent<span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token keyword\">void</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> code<span class=\"token punctuation\">,</span> ctrlKey<span class=\"token punctuation\">,</span> key<span class=\"token punctuation\">,</span> metaKey<span class=\"token punctuation\">,</span> shiftKey<span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> event<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> isRtl <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> isLtr <span class=\"token operator\">=</span> <span class=\"token operator\">!</span>isRtl<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> steps <span class=\"token operator\">=</span> shiftKey <span class=\"token operator\">?</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>sliderSteps <span class=\"token operator\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">let</span> position <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>sliderPosition<span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">// These keys would scroll the page when pressed</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>code <span class=\"token operator\">===</span> <span class=\"token string\">'Space'</span> <span class=\"token operator\">||</span> key <span class=\"token operator\">===</span> <span class=\"token string\">'Home'</span> <span class=\"token operator\">||</span> key <span class=\"token operator\">===</span> <span class=\"token string\">'End'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    event<span class=\"token punctuation\">.</span><span class=\"token function\">preventDefault</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>key <span class=\"token operator\">===</span> <span class=\"token string\">'ArrowLeft'</span> <span class=\"token operator\">&amp;&amp;</span> isLtr<span class=\"token punctuation\">)</span> <span class=\"token operator\">||</span> <span class=\"token punctuation\">(</span>key <span class=\"token operator\">===</span> <span class=\"token string\">'ArrowRight'</span> <span class=\"token operator\">&amp;&amp;</span> isRtl<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    event<span class=\"token punctuation\">.</span><span class=\"token function\">preventDefault</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// ‚Üê Firefox would highlight parts of the UI and labels w/o it</span>\n    position <span class=\"token operator\">-=</span> steps<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>key <span class=\"token operator\">===</span> <span class=\"token string\">'ArrowRight'</span> <span class=\"token operator\">&amp;&amp;</span> isLtr<span class=\"token punctuation\">)</span> <span class=\"token operator\">||</span> <span class=\"token punctuation\">(</span>key <span class=\"token operator\">===</span> <span class=\"token string\">'ArrowLeft'</span> <span class=\"token operator\">&amp;&amp;</span> isRtl<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    event<span class=\"token punctuation\">.</span><span class=\"token function\">preventDefault</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// same as above regarding Firefox</span>\n    position <span class=\"token operator\">+=</span> steps<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token comment\">// Also often called 'Pos1' or '‚åò + ‚Üê' on MacOS</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>key <span class=\"token operator\">===</span> <span class=\"token string\">'Home'</span> <span class=\"token operator\">||</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>metaKey <span class=\"token operator\">||</span> ctrlKey<span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;&amp;</span> key <span class=\"token operator\">===</span> <span class=\"token string\">'ArrowLeft'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    position <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token comment\">// End or '‚åò + ‚Üí' on MacOS</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>key <span class=\"token operator\">===</span> <span class=\"token string\">'End'</span> <span class=\"token operator\">||</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>metaKey <span class=\"token operator\">||</span> ctrlKey<span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;&amp;</span> key <span class=\"token operator\">===</span> <span class=\"token string\">'ArrowRight'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    position <span class=\"token operator\">=</span> <span class=\"token number\">100</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token comment\">// Center thumb position</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>key <span class=\"token operator\">===</span> <span class=\"token string\">'Enter'</span><span class=\"token punctuation\">)</span> position <span class=\"token operator\">=</span> <span class=\"token number\">50</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>sliderPosition <span class=\"token operator\">=</span> <span class=\"token function\">clamp</span><span class=\"token punctuation\">(</span>position<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">100</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre>\n<p>Eine weitere M√∂glichkeit den Slider zu bedienen, ist die direkte Eingabe, in dem man auf die gew√ºnschte Position tippt. Das kann Menschen helfen, welche motorisch nicht dauerhaft etwas gedr√ºckt halten und ziehen k√∂nnen und f√ºhlt sich meiner Meinung nach auch intuitiver an. Damit man ohne st√∂rendes Verhalten Bilder weiter √ºber das Kontextmen√º speichern kann, habe ich die Aktion auf die (in der Regel) linke und mittlere Maustaste beschr√§nkt. Au√üerdem l√§sst sich der Slider durch doppeltes klicken/tippen zentrieren.</p>\n<pre class=\"language-ts\"><code class=\"language-ts\">html<span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">\n  &lt;div\n    @mousedown=</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token punctuation\">(</span>e<span class=\"token operator\">:</span> MouseEvent<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> button <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> e<span class=\"token punctuation\">;</span>\n      <span class=\"token comment\">// The left or the wheel/middle button</span>\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>\n        button <span class=\"token operator\">===</span> MouseActions<span class=\"token punctuation\">.</span>Main <span class=\"token operator\">||</span>\n        button <span class=\"token operator\">===</span> MouseActions<span class=\"token punctuation\">.</span>Auxiliary\n      <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">setSlidingState</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">slideCompareHandler</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">\n    id=\"image-container\"\n  >\n    &lt;button @dblclick=</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>sliderPosition <span class=\"token operator\">=</span> <span class=\"token number\">50</span><span class=\"token punctuation\">;</span> <span class=\"token punctuation\">}</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">>&lt;/button>\n  &lt;/div>\n</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">;</span></code></pre>\n<p>Jetzt bleibt noch die Kommunikation mit Screenreadern √ºbrig, um hier eine gute Integration zu erm√∂glichen, nutze ich ich diverse <a href=\"https://www.w3.org/WAI/ARIA/apg/patterns/windowsplitter/#:~:text=the%20arrow%20keys.-,WAI%2DARIA%20Roles%2C%20States%2C%20and%20Properties,-The%20element%20that\">WAI-ARIA Roles</a> wie aus dem W3C Pattern zu entnehmen ist. Diese kommunizieren vor allem die minimale, maximale und aktuellen Position des Sliders.</p>\n</section>\n<section>\n<h3 id=\"housekeeping-mit-lifecycle-callbacks\"><a class=\"header-anchor\" href=\"https://tony-spegel.com/blog/image-comparison-component/#housekeeping-mit-lifecycle-callbacks\">Housekeeping üßΩ mit Lifecycle-Callbacks</a></h3>\n<p>Im einem vorherigen Abschnitt bin ich darauf eingegangen, dass die <a href=\"https://lit.dev/docs/components/events/#adding-event-listeners-in-the-element-template\">@-Syntax</a> es erm√∂glicht, EventListener hinzuzuf√ºgen. EventListener werden √ºblicherweise entfernt, wenn eine Component aus dem DOM entfernt wird. Das gilt aber nur f√ºr solche Events, die direkt an ein Element gebunden sind, also beispielsweise ein Click-Event an einem Button. Globale EventListener, also solche, die die Tastatur oder Mauseingaben verarbeiten und auch au√üerhalb einer Component verf√ºgbar sein m√ºssen, sind davon ausgenommen.</p>\n<p>Das ist an sich aber nicht weiter tragisch, denn Web Components unterst√ºtzen so genannte Lifecycles. Das sind Callbacks die zu unterschiedlichen Zeitpunkten ausgel√∂st werden so dass hier genau solche Arbeiten durchgef√ºhrt werden k√∂nnen. <code>connectedCallback</code> ist hierbei genau der richtige Zeitpunkt, denn die Component wurde zum DOM hinzugef√ºgt.</p>\n<pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token comment\">/**\n * Component is added to the document's DOM,\n * add EventListeners for variant 'slider'.\n */</span>\noverride <span class=\"token function\">connectedCallback</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token keyword\">void</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">super</span><span class=\"token punctuation\">.</span><span class=\"token function\">connectedCallback</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">addSliderEventListener</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">/**\n * Slider EventListener are added when 'variant' is set to 'slider'\n */</span>\n<span class=\"token keyword\">private</span> <span class=\"token function\">addSliderEventListener</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token keyword\">void</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>variant <span class=\"token operator\">===</span> <span class=\"token string\">'slider'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// Moving the slider</span>\n    window<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'mousemove'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>slideCompareHandler<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    window<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'touchmove'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>slideCompareHandler<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">// Stop moving the slider</span>\n    window<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'mouseup'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>slideEndHandler<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    window<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'touchend'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>slideEndHandler<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<p>√Ñquivalent dazu m√ºssen die EventListener dann sp√§testens entfernt werden, wenn die Component nicht mehr im DOM ist:</p>\n<pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token comment\">/**\n * Clean up EventListeners\n */</span>\noverride <span class=\"token function\">disconnectedCallback</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token keyword\">void</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">super</span><span class=\"token punctuation\">.</span><span class=\"token function\">disconnectedCallback</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">removeSliderEventListener</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<p>Da meine Component mehrere Varianten √ºber das dazu passende Attribut unterst√ºtzt, muss auch das bedacht werden:</p>\n<pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token comment\">/**\n * Because slider EventListeners are only added when the\n * 'variant' attribute is set to 'slider', you also have to react to its changes\n */</span>\noverride <span class=\"token function\">attributeChangedCallback</span><span class=\"token punctuation\">(</span>\n  name<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span> <span class=\"token operator\">=</span> <span class=\"token string\">'variant'</span><span class=\"token punctuation\">,</span>\n  oldVal<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span> <span class=\"token operator\">|</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span>\n  newVal<span class=\"token operator\">:</span> Variants\n<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">super</span><span class=\"token punctuation\">.</span><span class=\"token function\">attributeChangedCallback</span><span class=\"token punctuation\">(</span>name<span class=\"token punctuation\">,</span> oldVal<span class=\"token punctuation\">,</span> newVal<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>name <span class=\"token operator\">===</span> <span class=\"token string\">'variant'</span> <span class=\"token operator\">&amp;&amp;</span> newVal <span class=\"token operator\">!==</span> oldVal <span class=\"token operator\">&amp;&amp;</span> newVal <span class=\"token operator\">===</span> <span class=\"token string\">'slider'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">addSliderEventListener</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>name <span class=\"token operator\">===</span> <span class=\"token string\">'variant'</span> <span class=\"token operator\">&amp;&amp;</span> newVal <span class=\"token operator\">!==</span> oldVal <span class=\"token operator\">&amp;&amp;</span> newVal <span class=\"token operator\">===</span> <span class=\"token string\">'overlay'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">removeSliderEventListener</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<p>Damit stelle ich sicher, dass EventListener nur dann hinzugef√ºgt bzw. entfernt werden, wenn es auch wirklich notwendig ist.</p>\n</section>\n</section>\n<section>\n<h2 id=\"overlay\"><a class=\"header-anchor\" href=\"https://tony-spegel.com/blog/image-comparison-component/#overlay\">Overlay</a></h2>\n<p>Die Overlay Variante ist deutlich kompakter und arbeitet im Grunde genommen aber auch hier wieder mit einem praktischen Trick, den ich mir durch das Stapeln des Grid-Layouts zu nutzen mache.</p>\n<image-comparison variant=\"overlay\" overlayPrompt=\"Tippen und gedr√ºckt halten, um zu vergleichen\" id=\"kasimir-overlay\" class=\"post-img\">\n  <label slot=\"label-before\">Ohne Filter</label>\n  <label slot=\"label-after\">Graustufen</label>\n  <img slot=\"image-before\" src=\"https://tony-spegel.com/img/2023/image-comparison/kasimir--opt.jpg\" width=\"440\" alt=\"Tabby Katze\" />\n  <img slot=\"image-after\" src=\"https://tony-spegel.com/img/2023/image-comparison/kasimir_filter--opt.jpg\" width=\"440\" alt=\"Tabby Katze in Graustufen\" />\n</image-comparison>\n<p>Immer dann, wenn mit einem Eingabeger√§t auf das Bild gedr√ºckt und gehalten wird, √§ndere ich lediglich die Reihenfolge der Bilder im Stack und mehr nicht. Im CSS sieht das dann so aus:</p>\n<pre class=\"language-css\"><code class=\"language-css\"><span class=\"token comment\">/* Switch order of images */</span>\n<span class=\"token selector\">#image-container.pressed ::slotted([slot='image-after'])</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token property\">order</span><span class=\"token punctuation\">:</span> 1<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<p>ausgel√∂st wird das durch folgenden Code:</p>\n<pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">state</span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">private</span> pressed <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> overlayTemplate <span class=\"token operator\">=</span> html<span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">\n  &lt;div\n    @keydown=</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>keyboardOverlayHandler<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">\n    @keyup=</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">setPressed</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">\n    @mousedown=</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">setPressed</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">\n    @mouseup=</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">setPressed</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">\n    @mouseleave=</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">setPressed</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">\n    tabindex=\"0\"\n    title=</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>overlayPrompt<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">\n    id=\"image-container\"\n    class=\"</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>pressed <span class=\"token operator\">?</span> <span class=\"token string\">'pressed'</span> <span class=\"token operator\">:</span> <span class=\"token string\">''</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">\"\n  >\n    &lt;slot name=\"label-before\">&lt;/slot>\n    &lt;slot name=\"label-after\">&lt;/slot>\n    &lt;slot name=\"image-after\">&lt;/slot>\n    &lt;slot name=\"image-before\">&lt;/slot>\n  &lt;/div>\n  &lt;slot name=\"prompt\">&lt;/slot>\n</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">;</span></code></pre>\n<p>Also wird nur eine einzige interne Variable geflippt.</p>\n</section>\n<section>\n<h2 id=\"split\"><a class=\"header-anchor\" href=\"https://tony-spegel.com/blog/image-comparison-component/#split\">Split</a></h2>\n<image-comparison variant=\"split\" class=\"post-img\">\n  <label slot=\"label-before\">Ohne Filter</label>\n  <label slot=\"label-after\">Graustufen</label>\n  <img slot=\"image-before\" src=\"https://tony-spegel.com/img/2023/image-comparison/kasimir--opt.jpg\" width=\"212\" alt=\"Tabby Katze\" />\n  <img slot=\"image-after\" src=\"https://tony-spegel.com/img/2023/image-comparison/kasimir_filter--opt.jpg\" width=\"212\" alt=\"Tabby Katze in Graustufen\" />\n</image-comparison>\n<p>Es wird immer weniger komplex je weiter dieser Artikel fortschreitet, denn die Split-Variante ist tats√§chlich ausschlie√ülich CSS. Nicht besonders spannend, es ist einfach ein umbrechendes zweispaltiges Layout:</p>\n<pre class=\"language-css\"><code class=\"language-css\"><span class=\"token selector\">:host([variant='split']) #image-container</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token property\">gap</span><span class=\"token punctuation\">:</span> <span class=\"token function\">var</span><span class=\"token punctuation\">(</span>--split-gap<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token property\">grid-template-columns</span><span class=\"token punctuation\">:</span> <span class=\"token function\">repeat</span><span class=\"token punctuation\">(</span>\n    auto-fit<span class=\"token punctuation\">,</span>\n    <span class=\"token function\">minmax</span><span class=\"token punctuation\">(</span><span class=\"token function\">var</span><span class=\"token punctuation\">(</span>--split-column-min-width<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token function\">var</span><span class=\"token punctuation\">(</span>--split-column-max-width<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token selector\">:host([variant='split']) .container-split-column</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token property\">display</span><span class=\"token punctuation\">:</span> flex<span class=\"token punctuation\">;</span>\n  <span class=\"token property\">flex-direction</span><span class=\"token punctuation\">:</span> column<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token selector\">:host([variant='split']) ::slotted([slot^='label-'])</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token property\">opacity</span><span class=\"token punctuation\">:</span> 1<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre>\n</section>\n<section>\n<h2 id=\"custom-events\"><a class=\"header-anchor\" href=\"https://tony-spegel.com/blog/image-comparison-component/#custom-events\">Custom Events</a></h2>\n<p>Custom Events oder auch &quot;Synthetic Events&quot; sind wie der Name vermuten l√§sst eigens geschaffene Events. Da der Aufbau immer √§hnlich ist, gehe ich hier nur auf das Event des Sliders ein:</p>\n<pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">DragEvent</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">Event</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">static</span> <span class=\"token keyword\">readonly</span> eventName <span class=\"token operator\">=</span> <span class=\"token string\">'drag-event'</span> <span class=\"token keyword\">as</span> <span class=\"token keyword\">const</span><span class=\"token punctuation\">;</span>\n\n  targetElement<span class=\"token operator\">:</span> HTMLElement<span class=\"token punctuation\">;</span>\n\n  <span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span>targetElement<span class=\"token operator\">:</span> HTMLElement<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">super</span><span class=\"token punctuation\">(</span>DragEvent<span class=\"token punctuation\">.</span>eventName<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n      bubbles<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n      cancelable<span class=\"token operator\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span>\n      composed<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>targetElement <span class=\"token operator\">=</span> targetElement<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<p>Dieses l√∂se ich immer dann aus, wenn der Slider nicht mehr bewegt wird:</p>\n<pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token keyword\">private</span> slideEndHandler <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token keyword\">void</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">setSlidingState</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  window<span class=\"token punctuation\">.</span><span class=\"token function\">dispatchEvent</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">DragEvent</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre>\n<p>Abfangen k√∂nnte man dieses Event wie √ºblich so:</p>\n<pre class=\"language-js\"><code class=\"language-js\">window<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'drag-event'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">e</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre>\n<p>In Class field <code>targetElement</code> steckt dann auch das bekannte <code>sliderPosition</code>-Attribut und dessen Wert.</p>\n</section>\n<section>\n<h2 id=\"internationalisierung\"><a class=\"header-anchor\" href=\"https://tony-spegel.com/blog/image-comparison-component/#internationalisierung\">Internationalisierung</a></h2>\n<p>An manchen Stellen habe ich bereits angeschnitten, dass die Component auch Sprachen unterst√ºtzt, welche von rechts nach links gelesen werden. Meistens ist das auch kein Problem, denn Layouts wie <code>Grid</code> oder <code>Flex</code> unterst√ºtzen diese bereits von Haus aus so dass kein weiterer Code n√∂tig ist. Leider gibt es noch nicht in allen Browsern die CSS Pseudo Klasse <code>:dir()</code> so dass dann doch an einigen Stellen auf JavaScript zur√ºckgegriffen werden muss. In HTML bestimmt das <code>dir</code>-Attribut die Leserichtung eines Elements und wirkt sich auf alle Kind-Elemente aus.<br />\nNormalerweise k√∂nnte man mit <code>closest()</code> ohne weiteres ausgehend von einem Element bis zum <code>Document</code> suchen bis man ein Element mit dem entsprechenden Attribut gefunden hat - im ShadowDOM ist das allerdings etwas komplizierter, da dieses in sich geschlossen ist. Der folgende Ansatz ist deswegen auch leider nicht perfekt, sollte aber in den meisten F√§llen ausreichend sein. Auf diese Einschr√§nkung gehe ich gleich noch etwas genauer ein. Grunds√§tzlich nutze ich aber einen <code>MutationObserver</code> und gebe diesem einen Selektor, welche entweder das n√§chste Element mit einem <code>dir</code>-Attribut oder das <code>Document</code> an sich ist. √Ñhnlich der EventListener werden auch Observer im <code>connectedCallback</code> aktiviert und im <code>disconnectedCallback</code> deaktiviert.</p>\n<pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">ImageComparison</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">LitElement</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">state</span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">private</span> isRtl<span class=\"token operator\">:</span> <span class=\"token builtin\">boolean</span> <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">private</span> readingDirectionObserver<span class=\"token operator\">!</span><span class=\"token operator\">:</span> MutationObserver<span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">/**\n   * Callback to handle any mutations made to the dir-attribute\n   */</span>\n  <span class=\"token keyword\">private</span> <span class=\"token function-variable function\">readingDirectionHandler</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>mutations<span class=\"token operator\">:</span> MutationRecord<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">const</span> mutation <span class=\"token keyword\">of</span> mutations<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>mutation<span class=\"token punctuation\">.</span>attributeName <span class=\"token operator\">===</span> <span class=\"token string\">'dir'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> dir <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> mutation<span class=\"token punctuation\">.</span>target <span class=\"token keyword\">as</span> HTMLElement<span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>isRtl <span class=\"token operator\">=</span> dir <span class=\"token operator\">===</span> <span class=\"token string\">'rtl'</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">/**\n   * Component is added to the document's DOM, setup readingDirectionObserver\n   */</span>\n  override <span class=\"token function\">connectedCallback</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token keyword\">void</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">super</span><span class=\"token punctuation\">.</span><span class=\"token function\">connectedCallback</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>readingDirectionObserver <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">MutationObserver</span><span class=\"token punctuation\">(</span>\n      <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>readingDirectionHandler\n    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// Find closest element with a dir attribute by traversing upwards</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>textDirectionElement <span class=\"token operator\">=</span>\n      <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">closest</span><span class=\"token punctuation\">(</span><span class=\"token string\">'[dir]'</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">??</span>\n      <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>ownerDocument<span class=\"token operator\">?.</span><span class=\"token function\">querySelector</span><span class=\"token punctuation\">(</span><span class=\"token string\">'html'</span><span class=\"token punctuation\">)</span><span class=\"token operator\">!</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// Found one? Is it 'rtl'?</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>isRtl <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>textDirectionElement<span class=\"token punctuation\">.</span>dir <span class=\"token operator\">===</span> <span class=\"token string\">'rtl'</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// Start observing üîç</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>readingDirectionObserver<span class=\"token punctuation\">.</span><span class=\"token function\">observe</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>textDirectionElement<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n      attributes<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token comment\">/**\n   * Stop observing the dir attribute\n   */</span>\n  override <span class=\"token function\">disconnectedCallback</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token keyword\">void</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">super</span><span class=\"token punctuation\">.</span><span class=\"token function\">disconnectedCallback</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>readingDirectionObserver<span class=\"token punctuation\">.</span><span class=\"token function\">disconnect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<p>In den aller meisten F√§llen ist die folgende Integration ausreichend:</p>\n<pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>rtl-container<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">dir</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>rtl<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>image-comparison</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token comment\">&lt;!-- Content --></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>image-comparison</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span></code></pre>\n<p>Die Component w√ºrde korrekterweise in rtl gelesen und genutzt werden k√∂nnen. Was nicht funktionieren w√ºrde, ist das die Component selbst in einem <code>Slot</code> oder im ShadowDOM benutzt wird. Es ist auf jeden Fall eine Limitierung. Umgehen k√∂nnte man das eventuell noch in dem man ein weiteres Attribut f√ºr die Component selbst einf√ºhrt. Ich denke man kann damit aber leben. Die meisten Personen mit denen ich gesprochen habe, die ein rtl-Layout betreffen w√ºrde, w√§ren zum Beispiel gar nicht davon ausgegangen, dass sich die Bilder drehen m√ºssten. Das ist nat√ºrlich nur anekdotisch.</p>\n</section>\n<section>\n<h2 id=\"drei-components-in-einer\"><a class=\"header-anchor\" href=\"https://tony-spegel.com/blog/image-comparison-component/#drei-components-in-einer\">Drei Components in einer</a></h2>\n<p>Sollte man wirklich drei Components in einer verwirklichen? Wahrscheinlich eher nicht, aber interessant war es trotzdem und in meinen Tests mit einem √§lteren Smartphone gab es auch nicht wirklich Performance Probleme. Um &quot;live&quot; zwischen den Varianten wechseln zu k√∂nnen, bin ich wie folgt vorgegangen.<br />\nEinen Type f√ºr Varianten definieren:</p>\n<pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">type</span> <span class=\"token class-name\">Variants</span> <span class=\"token operator\">=</span> <span class=\"token string\">'overlay'</span> <span class=\"token operator\">|</span> <span class=\"token string\">'slider'</span> <span class=\"token operator\">|</span> <span class=\"token string\">'split'</span><span class=\"token punctuation\">;</span></code></pre>\n<p>Eine Property f√ºr die Component definieren:</p>\n<pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token decorator\"><span class=\"token at operator\">@</span><span class=\"token function\">property</span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> type<span class=\"token operator\">:</span> String <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">private</span> variant<span class=\"token operator\">:</span> Variants <span class=\"token operator\">=</span> <span class=\"token string\">'slider'</span><span class=\"token punctuation\">;</span></code></pre>\n<p>Mit Hilfe dieses Decorators wird ein Attribut erstellt auf dessen √Ñnderungen automatisch reagiert werden kann und bei Bedarf neu gerendert wird.</p>\n<p>Templates definieren und auf Property reagieren lassen:</p>\n<pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> sliderTemplate <span class=\"token operator\">=</span> html<span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> overlayTemplate <span class=\"token operator\">=</span> html<span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> splitTemplate <span class=\"token operator\">=</span> html<span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">return</span> html<span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">\n    </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token generic-function\"><span class=\"token function\">choose</span><span class=\"token generic class-name\"><span class=\"token operator\">&lt;</span>Variants<span class=\"token punctuation\">,</span> TemplateResult<span class=\"token operator\">></span></span></span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>variant<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>\n      <span class=\"token punctuation\">[</span><span class=\"token string\">'slider'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> sliderTemplate<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">[</span><span class=\"token string\">'overlay'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> overlayTemplate<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">[</span><span class=\"token string\">'split'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> splitTemplate<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">\n  </span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<p>Die zu Lit geh√∂rende <a href=\"https://lit.dev/docs/templates/directives/#choose\"><code>choose</code></a>-Direktive kann nun auf diese Art typsicher eines von drei Templates rendern und dies allein durch das √§ndern des <code>variant</code>-Attributes:</p>\n<pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>image-comparison</span> <span class=\"token attr-name\">variant</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>slider<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>image-comparison</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>image-comparison</span> <span class=\"token attr-name\">variant</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>overlay<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>image-comparison</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>image-comparison</span> <span class=\"token attr-name\">variant</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>split<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>image-comparison</span><span class=\"token punctuation\">></span></span></code></pre>\n<section>\n<h3 id=\"warum-das-eigentlich-nicht-sinnvoll-ist\"><a class=\"header-anchor\" href=\"https://tony-spegel.com/blog/image-comparison-component/#warum-das-eigentlich-nicht-sinnvoll-ist\">Warum das eigentlich nicht sinnvoll ist</a></h3>\n</section>\n</section>\n<section>\n<h2 id=\"integration-auf-websites-und-in-frameworks\"><a class=\"header-anchor\" href=\"https://tony-spegel.com/blog/image-comparison-component/#integration-auf-websites-und-in-frameworks\">Integration auf Websites und in Frameworks</a></h2>\n<p>Um diese Component beispielsweise in WordPress zu integrieren, reicht es aus, folgendes Script-Tag zum gew√ºnschten Template hinzuzuf√ºgen und √ºber deren Slots zu konfigurieren.</p>\n<pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span>\n  <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>module<span class=\"token punctuation\">\"</span></span>\n  <span class=\"token attr-name\">src</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>https://unpkg.com/image-comparison-component/dist/src/image-comparison.js?module<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token script\"><span class=\"token language-javascript\">\n</span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span>\n\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>image-comparison</span>\n  <span class=\"token attr-name\">variant</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>slider<span class=\"token punctuation\">\"</span></span>\n  <span class=\"token attr-name\">sliderPrompt</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>Move the slider to compare<span class=\"token punctuation\">\"</span></span>\n  <span class=\"token attr-name\">overlayPrompt</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>Tap and hold to compare<span class=\"token punctuation\">\"</span></span>\n<span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>label</span> <span class=\"token attr-name\">slot</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>label-before<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>Ohne Filter<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>label</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>label</span> <span class=\"token attr-name\">slot</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>label-after<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>Graustufen<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>label</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>img</span> <span class=\"token attr-name\">slot</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>image-before<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">src</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>/img/2023/before.jpg<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">alt</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>Rote Zierquitte<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>img</span> <span class=\"token attr-name\">slot</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>image-after<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">src</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>/img/2023/after.jpg<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">alt</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>Rote Zierquitte (Graustufen)<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>image-comparison</span><span class=\"token punctuation\">></span></span></code></pre>\n<p>In anderen Umgebungen sieht das dann √§hnlich aus. Wenn man die Component √ºber NPM installiert hat und dessen Attribute √ºber Radio Buttons √§ndern m√∂chte k√∂nnte man so etwas machen:</p>\n<pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">import</span> <span class=\"token string\">'image-comparison-component/image-comparison.js'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> imageComparisonDemoComponent <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">querySelector</span><span class=\"token punctuation\">(</span>\n  <span class=\"token string\">'#image-comparison-demo'</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> radioButtonVariants <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">querySelectorAll</span><span class=\"token punctuation\">(</span><span class=\"token string\">'input[name=\"variant\"]'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\nradioButtonVariants<span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>radioButton<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span>\n  radioButton<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'change'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> value <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> e<span class=\"token punctuation\">.</span>target<span class=\"token punctuation\">;</span>\n    imageComparisonDemoComponent<span class=\"token punctuation\">.</span><span class=\"token function\">setAttribute</span><span class=\"token punctuation\">(</span><span class=\"token string\">'variant'</span><span class=\"token punctuation\">,</span> value<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre>\n</section>\n<section>\n<h2 id=\"fazit\"><a class=\"header-anchor\" href=\"https://tony-spegel.com/blog/image-comparison-component/#fazit\">Fazit</a></h2>\n<p>Die Arbeit an dieser Component hatte ich bereits vor einer Weile abgeschlossen und konnte jetzt durch das Schreiben des Posts noch einiges dazu lernen. Dazu z√§hlte auf jeden Fall das hinzuf√ºgen von Default-Styles, die Integration in einen statischen Seitengenerator und insbesondere das Handling des <code>rtl</code>-Attributs. Etwas sp√§ter in der Entwicklung habe ich dann auch noch eine Component Library entdeckt, welche ebenfalls in Lit geschrieben ist und auch eine solche Component enth√§lt. Wer also eine ausgewachsenere Variante nutzen m√∂chte, dem kann ich nur <a href=\"https://shoelace.style/components/image-comparer\">Shoelace</a> empfehlen. Viel Spa√ü mit der Component :)</p>\n</section>\n<section>\n<h2 id=\"update-rtl-bugfix\"><a class=\"header-anchor\" href=\"https://tony-spegel.com/blog/image-comparison-component/#update-rtl-bugfix\">Update: RTL Bugfix</a></h2>\n</section>\n",
      "date_published": "2023-04-14T00:00:00Z"
    },{
      "id": "https://tony-spegel.com/blog/beschleunigte-navigation-mit-addPrefetchLink/",
      "url": "https://tony-spegel.com/blog/beschleunigte-navigation-mit-addPrefetchLink/",
      "title": "Beschleunigte Navigation mit Link prefetching",
      "content_html": "<p>Prefetching beschreibt einen Prozess, welcher eventuell ben√∂tigte Inhalte vorl√§dt, um diese schneller aufrufen zu k√∂nnen. Das kann beispielsweise so aussehen: <code>&lt;link rel=&quot;prefetch&quot; href=&quot;/img/catsarecute.jpg&quot; /&gt;</code>. Browser werden diese Ressource dann herunterladen und zwischenspeichern (allerdings nur im <a href=\"https://developer.mozilla.org/en-US/docs/Web/HTTP/Link_prefetching_FAQ#how_is_browser_idle_time_determined\">Idle</a>).</p>\n<p>Alle Links einer Seite f√ºr das Prefetching hinzuzuf√ºgen ist nat√ºrlich wenig sinnvoll.<br />\nUm das zu optimieren ist mein Ansatz, Links nur auf eine Interaktion hin zu prefetchen - also beispielsweise das Zeigen mit der Maus oder das Fokussieren mit einer Tastatur. Inspiration habe ich mir hierbei durch das von Google entwickelte <a href=\"https://getquick.link/\">Quicklink</a> geholt. Der entscheidende Unterschied zu meiner L√∂sung ist, dass Quicklink alle Links im sichtbaren Bereichen vorl√§dt (wenn der Browser im Idle ist) und nicht durch eine Interaktion.</p>\n<p>Links zu meiner L√∂sung <em>addPrefetchLink</em>:</p>\n<ul>\n<li><a href=\"https://codepen.io/TonySpegel/full/PojrqZb\">Demo (Codepen)</a></li>\n<li><a href=\"https://www.npmjs.com/package/add-prefetch-link\">NPM</a></li>\n<li><a href=\"https://github.com/TonySpegel/addPrefetchLink\">GitHub</a></li>\n</ul>\n<section>\n<h2 id=\"anforderungen\"><a class=\"header-anchor\" href=\"https://tony-spegel.com/blog/beschleunigte-navigation-mit-addPrefetchLink/#anforderungen\">Anforderungen</a></h2>\n<ul>\n<li>Links welche ein <code>mailto:</code> oder <code>tel:</code> enthalten, sollen nicht prefetched werden</li>\n<li>Ist ein Datensparmodus aktiv oder ist die Verbindung zu langsam, sollen keine Links prefetched werden</li>\n<li>Pro Link darf nur eine Interaktion das Prefetching ausl√∂sen</li>\n</ul>\n</section>\n<section>\n<h2 id=\"die-richtigen-links-selektieren\"><a class=\"header-anchor\" href=\"https://tony-spegel.com/blog/beschleunigte-navigation-mit-addPrefetchLink/#die-richtigen-links-selektieren\">Die richtigen Links selektieren</a></h2>\n<p>Da es bei E-Mail Links, Telefonnummern oder Linkf auf aktuellen Seite keinen Sinn ergibt, diese zu prefetchen, sollten diese ignoriert werden. Ich nutze dazu einfach einen CSS Selektor welche alle Links selektiert, deren href-Attribut nicht mit dem entsprechenden Prefix beginnt:</p>\n<pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">/* JavaScript */</span>\n<span class=\"token keyword\">const</span> links <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">querySelectorAll</span><span class=\"token punctuation\">(</span>\n  <span class=\"token string\">'a:not([href^=\"mailto:\"]):not([href^=\"tel:\"]):not([href^=\"#\"])'</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\ndocument\n  <span class=\"token punctuation\">.</span><span class=\"token function\">querySelectorAll</span><span class=\"token punctuation\">(</span>links<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">link</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre>\n<p>Man k√∂nnte nat√ºrlich auch ein Array erstellen und dieses entsprechend filtern.</p>\n</section>\n<section>\n<h2 id=\"links-prefetchen\"><a class=\"header-anchor\" href=\"https://tony-spegel.com/blog/beschleunigte-navigation-mit-addPrefetchLink/#links-prefetchen\">Links prefetchen</a></h2>\n<p>Als erstes definiere ich eine Funktion welche Links zum <code>&lt;head&gt;</code> hinzuf√ºgen soll, als einzigen Parameter ein Event erwartet und als R√ºckgabetyp zun√§chst <code>void</code> definiert:</p>\n<pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token comment\">/* TypeScript */</span>\n<span class=\"token keyword\">const</span> addToHead <span class=\"token operator\">=</span>\n  <span class=\"token punctuation\">(</span>event<span class=\"token operator\">:</span> Event<span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token keyword\">void</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span></code></pre>\n<p><code>event</code> nutzt schlie√ülich dessen Property <code>target</code> als Referenz auf das Objekt (hier ein Link) welches das Event ausgel√∂st hat.</p>\n<section>\n<h3 id=\"datensparmodus-und-langsame-verbindungen-beruecksichtigen\"><a class=\"header-anchor\" href=\"https://tony-spegel.com/blog/beschleunigte-navigation-mit-addPrefetchLink/#datensparmodus-und-langsame-verbindungen-beruecksichtigen\">Datensparmodus und langsame Verbindungen ber√ºcksichtigen</a></h3>\n<p>Um zu pr√ºfen, ob entweder ein Datensparmodus aktiv oder die Verbindung zu langsam ist reichen diese beiden Bedingungen:</p>\n<pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token comment\">/* TypeScript */</span>\n<span class=\"token keyword\">const</span> addToHead <span class=\"token operator\">=</span>\n  <span class=\"token punctuation\">(</span>event<span class=\"token operator\">:</span> Event<span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token keyword\">void</span> <span class=\"token operator\">|</span> Error <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>navigator<span class=\"token punctuation\">.</span>connection<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">const</span> connection <span class=\"token operator\">=</span> navigator<span class=\"token punctuation\">.</span>connection<span class=\"token punctuation\">;</span>\n      <span class=\"token comment\">/**\n       * Check if a data saver is running\n       */</span>\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>connection<span class=\"token punctuation\">.</span>saveData<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Error</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Prefetch is not available when using Data Saver'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span>\n      <span class=\"token comment\">/**\n       * Check for slow connections, don't\n       * prefetch on 2g or slower.\n       * effectiveType can be: slow-2g, 2g, 3g, or 4g\n       */</span>\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>connection<span class=\"token punctuation\">.</span>effectiveType<span class=\"token punctuation\">.</span><span class=\"token function\">includes</span><span class=\"token punctuation\">(</span><span class=\"token string\">'2g'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Error</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Prefetch is not available on slow connections'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<p>Allerdings besitzt nicht jeder Browser Informationen √ºber dessen Verbindungstyp so dass hier zuerst √ºber <code>navigator.connection</code><br />\nauf das Vorhandensein hin gepr√ºft wird. Die hier geworfenen Fehler werden nicht verwendet oder angezeigt um nicht unn√∂tig zu st√∂ren - es soll vor allem einfach nicht prefetched werden.</p>\n<p>TypeScript wirft hier zun√§chst einen Fehler, da es die beiden Properties <code>saveData</code> und <code>effectiveType</code> nicht kennt. Um das zu beheben, habe ich das entsprechende Interface erweitert:</p>\n<pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token comment\">/* TypeScript */</span>\n<span class=\"token keyword\">export</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">declare</span> global <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">interface</span> <span class=\"token class-name\">NetworkInformation</span> <span class=\"token punctuation\">{</span>\n    saveData<span class=\"token operator\">:</span> <span class=\"token builtin\">boolean</span><span class=\"token punctuation\">;</span>\n    effectiveType<span class=\"token operator\">:</span> <span class=\"token string\">'slow-2g'</span> <span class=\"token operator\">|</span> <span class=\"token string\">'2g'</span> <span class=\"token operator\">|</span> <span class=\"token string\">'3g'</span> <span class=\"token operator\">|</span> <span class=\"token string\">'4g'</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre>\n</section>\n<section>\n<h3 id=\"links-prefetchen-1\"><a class=\"header-anchor\" href=\"https://tony-spegel.com/blog/beschleunigte-navigation-mit-addPrefetchLink/#links-prefetchen-1\">Links prefetchen</a></h3>\n<p>Das eigentliche Prefetching ist unspektakul√§r. Es wird ein Link-Element erzeugt, dessen <code>href</code>- auf einen Link<br />\nund das <code>rel</code>-Attribut auf <code>prefetch</code> gesetzt und schlie√ülich zum <code>&lt;head&gt;</code> hinzugef√ºgt:</p>\n<pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">const</span> addToHead <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>event<span class=\"token operator\">:</span> Event<span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token keyword\">void</span> <span class=\"token operator\">|</span> Error <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// (...) previous code</span>\n\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>event<span class=\"token punctuation\">.</span>target <span class=\"token operator\">!==</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> link <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">createElement</span><span class=\"token punctuation\">(</span><span class=\"token string\">'link'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    link<span class=\"token punctuation\">.</span>href <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">&lt;</span>HTMLAnchorElement<span class=\"token operator\">></span>event<span class=\"token punctuation\">.</span>target<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>href<span class=\"token punctuation\">;</span>\n    link<span class=\"token punctuation\">.</span>rel <span class=\"token operator\">=</span> <span class=\"token string\">'prefetch'</span><span class=\"token punctuation\">;</span>\n\n    document<span class=\"token punctuation\">.</span>head<span class=\"token punctuation\">.</span><span class=\"token function\">appendChild</span><span class=\"token punctuation\">(</span>link<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre>\n</section>\n</section>\n<section>\n<h2 id=\"eine-interaktion-pro-link\"><a class=\"header-anchor\" href=\"https://tony-spegel.com/blog/beschleunigte-navigation-mit-addPrefetchLink/#eine-interaktion-pro-link\">Eine Interaktion pro Link</a></h2>\n<p>Um unn√∂tige Netzwerkanfragen zu vermeiden, soll nur eine Interaktion pro Link das Prefetching ausl√∂sen.<br />\nWurde ein Link beispielsweise mit der Tastatur fokussiert, soll ein Hovern mit der Maus keinen weiteren Vorgang ausl√∂sen.<br />\nEin Event an sich nur ein einziges Mal ausl√∂sen ist einfach:</p>\n<pre class=\"language-javascript\"><code class=\"language-javascript\">element<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span>\n  <span class=\"token string\">'click'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">once</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span> <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre>\n<p>Pro Element nur ein einziges Event auszul√∂sen ist etwas komplizierter.<br />\nVorbereitend wird wieder eine leere Funktion erstellt. Diese erwartet einen Link und ein Array an Events - hier vorbelegt mit <code>mouseover</code> und <code>focus</code>.</p>\n<pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token comment\">/* TypeScript */</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> addPrefetchLink <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>\n  link<span class=\"token operator\">:</span> HTMLAnchorElement<span class=\"token punctuation\">,</span>\n  userEvents<span class=\"token operator\">:</span> ReadonlyArray<span class=\"token operator\">&lt;</span><span class=\"token keyword\">keyof</span> HTMLElementEventMap<span class=\"token operator\">></span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token string\">'mouseover'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">'focus'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span></code></pre>\n<p>Der Rest des Codes wird in zwei Teile unterteilt, einen der EventListener entfernt und das hinzuf√ºgen zum <code>&lt;head&gt;</code> √ºbernimmt und einen welcher EventListener hinzuf√ºgt.</p>\n<pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token comment\">/* TypeScript */</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> addPrefetchLink <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>\n  link<span class=\"token operator\">:</span> HTMLAnchorElement<span class=\"token punctuation\">,</span>\n  userEvents<span class=\"token operator\">:</span> ReadonlyArray<span class=\"token operator\">&lt;</span><span class=\"token keyword\">keyof</span> HTMLElementEventMap<span class=\"token operator\">></span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token string\">'mouseover'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">'focus'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">handler</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>event<span class=\"token operator\">:</span> Event<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// Remove listeners</span>\n    userEvents<span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>userEvent<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span>\n      link<span class=\"token punctuation\">.</span><span class=\"token function\">removeEventListener</span><span class=\"token punctuation\">(</span>userEvent<span class=\"token punctuation\">,</span> handler<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token function\">addToHead</span><span class=\"token punctuation\">(</span>event<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">// Register listeners</span>\n  userEvents<span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>userEvent<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span>\n    link<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span>userEvent<span class=\"token punctuation\">,</span> handler<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre>\n<p>Die hier als <code>handler</code> benannte Funktion entfernt zun√§chst alle auf einen Link gebundenen Events und f√ºgt dann den Link via <code>addToHead</code> hinzu. Fertig! Wobei da eine Sache noch bleibt: sollte ein Link √∂fters vorhanden sein, wird dieser dennoch ein weiteres mal hinzugef√ºgt. L√∂sen k√∂nnte man das wohl mit einem <code>Set</code> - das kommt (vielleicht) in einem Update.</p>\n</section>\n<section>\n<h2 id=\"fazit\"><a class=\"header-anchor\" href=\"https://tony-spegel.com/blog/beschleunigte-navigation-mit-addPrefetchLink/#fazit\">Fazit</a></h2>\n<p>Neben der Herausforderung keine unn√∂tigen Netzwerkanfragen auszul√∂sen, war das Ganze<br />\nauch ein erster erfolgreicher Versuch ein NPM-Modul zu schreiben und zu ver√∂ffentlichen.<br />\nWichtige Felder die zur Ver√∂ffentlichung ben√∂tigt werden, sind: <code>main</code>, <code>type</code> sowie <code>files</code> in der package.json.<br />\nWeitere Details zum Projekt auf Github.<br />\nDa es mein erstes NPM-Modul ist, freue ich mich nat√ºrlich besonders √ºber Feedback <a class=\"text-link\" target=\"_blank\" rel=\"noopener noreferrer\" href=\"mailto:tony.spegel@gmail.com\" title=\"E-Mail schreiben\">tony.spegel@gmail.com</a></p>\n</section>\n",
      "date_published": "2021-10-04T00:00:00Z"
    },{
      "id": "https://tony-spegel.com/blog/challenge-progress-stepper/",
      "url": "https://tony-spegel.com/blog/challenge-progress-stepper/",
      "title": "Challenge: Progress Stepper",
      "content_html": "<figure>\n  <img src=\"https://tony-spegel.com/img/2021/fecc-challenge-008.png\" alt=\"Fortschrittsanzeige f√ºr einen Checkout-Prozess\" width=\"320\" height=\"303\" />\n  <figcaption>Abbildung von ¬© Andy Bell</figcaption>\n</figure>\n<p>Vor einer Weile habe ich auf Twitter diese <a href=\"https://piccalil.li/blog/challenge-008-progress-stepper/\">Challenge</a> entdeckt, gespeichert und schlie√ülich f√ºr l√§ngere Zeit vergessen (kennt man ja).</p>\n<p>In dieser Challenge geht es darum, einen so genanten Progress Stepper umzusetzen - also etwas das man beispielsweise aus einem Lieferprozess oder im Checkout eines Onlineshops kennt. Die wichtigsten Punkte welche dieser erf√ºllen soll sind:</p>\n<ul>\n<li>Die L√∂sung nutzt semantisches HTML</li>\n<li>Die L√∂sung funktioniert sowohl mit wenigen als auch beliebig vielen Punkten</li>\n<li>Lange wie kurze Texte sollen unterst√ºtzt werden</li>\n</ul>\n<section>\n<h2 id=\"vorueberlegungen\"><a class=\"header-anchor\" href=\"https://tony-spegel.com/blog/challenge-progress-stepper/#vorueberlegungen\">Vor√ºberlegungen</a></h2>\n<ul>\n<li>Da eine zeitliche Abfolge dargestellt werden soll, bietet es sich an ein <code>&lt;ol&gt;</code>-Element zu nutzen - eine ordered list</li>\n<li>verschiedene Zust√§nde m√ºssen dargestellt werden: offen, in Bearbeitung und abgeschlossen</li>\n<li>Auch Screenreader m√ºssen den jeweiligen Status eines Schritts verarbeiten k√∂nnen so dass jede/r wei√ü was der aktuelle Stand ist</li>\n</ul>\n</section>\n<section>\n<h2 id=\"html\"><a class=\"header-anchor\" href=\"https://tony-spegel.com/blog/challenge-progress-stepper/#html\">HTML</a></h2>\n<p>F√ºr ein Layout dieser Form habe ich mich entschieden f√ºr jeden Schritt sowie der Liste als Ganzes display: flex; und f√ºr den Fortschrittsindikator und den Verbindungsst√ºcken <code>:before</code> bzw. <code>:after</code> zu nutzen. Die Anzeige des jeweiligen Schritts und dessen Beschreibung wird jeweils mit einem <code>&lt;div&gt;</code> umschlossen. √úber das data-state=&quot;complete&quot;-Attribut wird ein abgeschlossener Zustand signalisiert und mit <code>aria-current=&quot;step&quot;</code> f√ºr Screenreader der aktuelle Schritt gekennzeichnet (mehr zum <code>aria-tag</code> hier).</p>\n<pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>progress-stepper<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>ol</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>li</span> <span class=\"token attr-name\">data-state</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>complete<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>step<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n          <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>span</span><span class=\"token punctuation\">></span></span>Schritt 1<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>span</span><span class=\"token punctuation\">></span></span>\n          <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>strong</span><span class=\"token punctuation\">></span></span>Warenkorb<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>strong</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>li</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>li</span> <span class=\"token attr-name\">data-state</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>complete<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>step<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n          <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>span</span><span class=\"token punctuation\">></span></span>Schritt 2<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>span</span><span class=\"token punctuation\">></span></span>\n          <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>strong</span><span class=\"token punctuation\">></span></span>Details<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>strong</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>li</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>li</span> <span class=\"token attr-name\">aria-current</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>step<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>step<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n          <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>span</span><span class=\"token punctuation\">></span></span>Schritt 3<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>span</span><span class=\"token punctuation\">></span></span>\n          <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>strong</span><span class=\"token punctuation\">></span></span>Zahlungsmittel<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>strong</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>li</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>li</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>step<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n          <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>span</span><span class=\"token punctuation\">></span></span>Schritt 4<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>span</span><span class=\"token punctuation\">></span></span>\n          <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>strong</span><span class=\"token punctuation\">></span></span>Zahlung abschlie√üen<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>strong</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>li</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>ol</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span></code></pre>\n</section>\n<section>\n<h2 id=\"css\"><a class=\"header-anchor\" href=\"https://tony-spegel.com/blog/challenge-progress-stepper/#css\">CSS</a></h2>\n<p>Um verschieden Lange und beliebig viele Schritte darzustellen nutze ich CSS custom properties / CSS Variablen. Diese Variablen sind hier besonders praktisch, um die L√§nge der Verbindungsst√ºcke zu berechnen. Der Rest ist vor allem viel Berechnung mit Hilfe von <code>calc()</code> und den Eingangs erw√§hnten Zust√§nden via <code>[data-state='complete']</code>.</p>\n<section>\n<h3 id=\"variablen-and-reset\"><a class=\"header-anchor\" href=\"https://tony-spegel.com/blog/challenge-progress-stepper/#variablen-and-reset\">Variablen &amp; Reset</a></h3>\n<p>Die hier genutzten Variablen sind relativ √ºberschaubar: ich lege vor allem ein paar Grundfarben sowie Abst√§nde, die Gr√∂√üe des Indikators, die Zeilenh√∂he, den Abstand zwischen den Schritten sowie die Breite des Verbindungsst√ºcks fest. Die Farben sind hierbei selbst gew√§hlt und weichen etwas von der Vorgabe ab; oft bietet es sich an, neben surface colors auch Schriftfarben zu definieren.</p>\n<pre class=\"language-css\"><code class=\"language-css\"><span class=\"token selector\">:root</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token property\">--surface-1</span><span class=\"token punctuation\">:</span> #cb99e1<span class=\"token punctuation\">;</span>\n  <span class=\"token property\">--surface-2</span><span class=\"token punctuation\">:</span> #debfed<span class=\"token punctuation\">;</span>\n  <span class=\"token property\">--surface-3</span><span class=\"token punctuation\">:</span> #f2e6f8<span class=\"token punctuation\">;</span>\n  <span class=\"token property\">--surface-4</span><span class=\"token punctuation\">:</span> #f8f2fb<span class=\"token punctuation\">;</span>\n\n  <span class=\"token property\">--base-gap</span><span class=\"token punctuation\">:</span> 16px<span class=\"token punctuation\">;</span>\n  <span class=\"token property\">--circle-size</span><span class=\"token punctuation\">:</span> 26px<span class=\"token punctuation\">;</span>\n\n  <span class=\"token property\">--line-height</span><span class=\"token punctuation\">:</span> <span class=\"token function\">var</span><span class=\"token punctuation\">(</span>--circle-size<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token property\">--step-margin</span><span class=\"token punctuation\">:</span> 16px<span class=\"token punctuation\">;</span>\n  <span class=\"token property\">--connection-width</span><span class=\"token punctuation\">:</span> 4px<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token selector\">body</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token property\">font-family</span><span class=\"token punctuation\">:</span> sans-serif<span class=\"token punctuation\">;</span>\n  <span class=\"token property\">box-sizing</span><span class=\"token punctuation\">:</span> border-box<span class=\"token punctuation\">;</span>\n  <span class=\"token property\">margin</span><span class=\"token punctuation\">:</span> 0<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token selector\">*,\n*:before,\n*:after</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token property\">box-sizing</span><span class=\"token punctuation\">:</span> border-box<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">/* Container element */</span>\n<span class=\"token selector\">.progress-stepper</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token property\">padding</span><span class=\"token punctuation\">:</span> <span class=\"token function\">var</span><span class=\"token punctuation\">(</span>--base-gap<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">/* Wrapper for description */</span>\n<span class=\"token selector\">.step</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token property\">display</span><span class=\"token punctuation\">:</span> flex<span class=\"token punctuation\">;</span>\n  <span class=\"token property\">flex-direction</span><span class=\"token punctuation\">:</span> column<span class=\"token punctuation\">;</span>\n  <span class=\"token property\">justify-content</span><span class=\"token punctuation\">:</span> center<span class=\"token punctuation\">;</span>\n\n  <span class=\"token property\">line-height</span><span class=\"token punctuation\">:</span> <span class=\"token function\">var</span><span class=\"token punctuation\">(</span>--line-height<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre>\n</section>\n<section>\n<h3 id=\"die-liste\"><a class=\"header-anchor\" href=\"https://tony-spegel.com/blog/challenge-progress-stepper/#die-liste\">Die Liste</a></h3>\n<p>Die Liste als solches ist schnell beschrieben: ein <code>flex</code>-Layout in der Vertikalen sowie in der Horizontalen f√ºr jeden Schritt. Hierbei noch erw√§hnenswert ist die Property <code>gap</code> welche mittlerweile auch f√ºr <code>flex</code>-Container verf√ºgbar ist und einen Abstand zwischen Elementen erzeugt.</p>\n<pre class=\"language-css\"><code class=\"language-css\"><span class=\"token selector\">ol</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token property\">display</span><span class=\"token punctuation\">:</span> flex<span class=\"token punctuation\">;</span>\n  <span class=\"token property\">flex-direction</span><span class=\"token punctuation\">:</span> column<span class=\"token punctuation\">;</span>\n  <span class=\"token property\">margin</span><span class=\"token punctuation\">:</span> 0<span class=\"token punctuation\">;</span>\n  <span class=\"token property\">padding</span><span class=\"token punctuation\">:</span> 0<span class=\"token punctuation\">;</span>\n\n  <span class=\"token property\">list-style-type</span><span class=\"token punctuation\">:</span> none<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token selector\">li</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token property\">display</span><span class=\"token punctuation\">:</span> flex<span class=\"token punctuation\">;</span>\n  <span class=\"token property\">gap</span><span class=\"token punctuation\">:</span> <span class=\"token function\">var</span><span class=\"token punctuation\">(</span>--base-gap<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token property\">margin-bottom</span><span class=\"token punctuation\">:</span> <span class=\"token function\">var</span><span class=\"token punctuation\">(</span>--step-margin<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token property\">position</span><span class=\"token punctuation\">:</span> relative<span class=\"token punctuation\">;</span>\n  <span class=\"token property\">cursor</span><span class=\"token punctuation\">:</span> pointer<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token selector\">li:last-child</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token property\">margin-bottom</span><span class=\"token punctuation\">:</span> 0<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre>\n</section>\n<section>\n<h3 id=\"fortschrittsindikator\"><a class=\"header-anchor\" href=\"https://tony-spegel.com/blog/challenge-progress-stepper/#fortschrittsindikator\">Fortschrittsindikator</a></h3>\n<p>Der Fortschrittsindikator (der jeweilige Kreis in jedem Schritt) wiederum ist auch nur ein <code>flex</code>-Container und wird mittels <code>align-self: center</code> vertikal zentriert. Ist ein Schritt als abgeschlossen markiert, √§ndert sich dessen Farbe und ein Haken wird hinzugef√ºgt.</p>\n<pre class=\"language-css\"><code class=\"language-css\"><span class=\"token comment\">/**\n * Circle Element - default\n */</span>\n<span class=\"token selector\">li:before</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token property\">content</span><span class=\"token punctuation\">:</span> <span class=\"token string\">''</span><span class=\"token punctuation\">;</span>\n  <span class=\"token property\">display</span><span class=\"token punctuation\">:</span> flex<span class=\"token punctuation\">;</span>\n  <span class=\"token property\">align-self</span><span class=\"token punctuation\">:</span> center<span class=\"token punctuation\">;</span>\n  <span class=\"token property\">place-content</span><span class=\"token punctuation\">:</span> center<span class=\"token punctuation\">;</span>\n\n  <span class=\"token property\">border</span><span class=\"token punctuation\">:</span> 1px solid <span class=\"token function\">var</span><span class=\"token punctuation\">(</span>--surface-1<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token property\">border-radius</span><span class=\"token punctuation\">:</span> <span class=\"token function\">var</span><span class=\"token punctuation\">(</span>--circle-size<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token property\">min-width</span><span class=\"token punctuation\">:</span> <span class=\"token function\">var</span><span class=\"token punctuation\">(</span>--circle-size<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token property\">min-height</span><span class=\"token punctuation\">:</span> <span class=\"token function\">var</span><span class=\"token punctuation\">(</span>--circle-size<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token property\">z-index</span><span class=\"token punctuation\">:</span> 1<span class=\"token punctuation\">;</span>\n  <span class=\"token property\">background-color</span><span class=\"token punctuation\">:</span> <span class=\"token function\">var</span><span class=\"token punctuation\">(</span>--surface-4<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">/**\n * Circle Element - complete\n */</span>\n<span class=\"token selector\">li[data-state='complete']:before</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">content</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'‚úì'</span><span class=\"token punctuation\">;</span>\n    <span class=\"token property\">background-color</span><span class=\"token punctuation\">:</span> <span class=\"token function\">var</span><span class=\"token punctuation\">(</span>--surface-1<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre>\n</section>\n<section>\n<h3 id=\"verbindungselement\"><a class=\"header-anchor\" href=\"https://tony-spegel.com/blog/challenge-progress-stepper/#verbindungselement\">Verbindungselement</a></h3>\n<p>Die eigentliche Herausforderung waren die Verbindungselemente zwischen den Kreisen. Diese mussten nahtlos ineinander √ºbergehen und das m√∂glichst bei verschieden langen Beschriftungen. Um nicht zu viel zus√§tzliches HTML zu schreiben, hat es sich als praktisch erwiesen, das Verbindungselement absolut zu positionieren. Die L√§nge der Verbindung ergibt sich dann aus Abstand, H√∂he des Schritts sowie der Zeilenh√∂he. Das Ganze ist auf jeden Fall nicht perfekt und funktioniert nicht mehr optimal bei Beschriftungen die sich √ºber drei Zeilen erstrecken - was hoffentlich selten der Fall sein sollte. Falls jemand noch eine bessere L√∂sung hat - gern an mich schicken <a class=\"text-link\" target=\"_blank\" rel=\"noopener noreferrer\" href=\"mailto:tony.spegel@gmail.com\" title=\"E-Mail schreiben\">tony.spegel@gmail.com</a></p>\n<pre class=\"language-css\"><code class=\"language-css\"><span class=\"token comment\">/* Connection - default */</span>\n<span class=\"token selector\">li:after</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token property\">content</span><span class=\"token punctuation\">:</span> <span class=\"token string\">''</span><span class=\"token punctuation\">;</span>\n  <span class=\"token property\">display</span><span class=\"token punctuation\">:</span> none<span class=\"token punctuation\">;</span>\n  <span class=\"token property\">width</span><span class=\"token punctuation\">:</span> <span class=\"token function\">var</span><span class=\"token punctuation\">(</span>--connection-width<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token property\">height</span><span class=\"token punctuation\">:</span> 50%<span class=\"token punctuation\">;</span>\n\n  <span class=\"token property\">position</span><span class=\"token punctuation\">:</span> absolute<span class=\"token punctuation\">;</span>\n  <span class=\"token property\">left</span><span class=\"token punctuation\">:</span> <span class=\"token function\">calc</span><span class=\"token punctuation\">(</span>\n      <span class=\"token function\">var</span><span class=\"token punctuation\">(</span>--circle-size<span class=\"token punctuation\">)</span> / 2 - <span class=\"token function\">var</span><span class=\"token punctuation\">(</span>--connection-width<span class=\"token punctuation\">)</span> / 2\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token property\">z-index</span><span class=\"token punctuation\">:</span> 0<span class=\"token punctuation\">;</span>\n  <span class=\"token property\">background-color</span><span class=\"token punctuation\">:</span> <span class=\"token function\">var</span><span class=\"token punctuation\">(</span>--surface-2<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">/* Finished step */</span>\n<span class=\"token selector\">li[data-state='complete']:after</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token property\">display</span><span class=\"token punctuation\">:</span> flex<span class=\"token punctuation\">;</span>\n  <span class=\"token property\">height</span><span class=\"token punctuation\">:</span> <span class=\"token function\">calc</span><span class=\"token punctuation\">(</span>100% + <span class=\"token function\">var</span><span class=\"token punctuation\">(</span>--step-margin<span class=\"token punctuation\">)</span> + <span class=\"token function\">var</span><span class=\"token punctuation\">(</span>--line-height<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">/* First connection */</span>\n<span class=\"token selector\">li:first-child:after</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token property\">height</span><span class=\"token punctuation\">:</span> <span class=\"token function\">calc</span><span class=\"token punctuation\">(</span>100% + <span class=\"token function\">var</span><span class=\"token punctuation\">(</span>--step-margin<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token property\">transform</span><span class=\"token punctuation\">:</span> <span class=\"token function\">translateY</span><span class=\"token punctuation\">(</span><span class=\"token function\">var</span><span class=\"token punctuation\">(</span>--line-height<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">/* Last connection */</span>\n<span class=\"token selector\">li:last-child:after</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token property\">height</span><span class=\"token punctuation\">:</span> 50%<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre>\n</section>\n</section>\n<section>\n<h2 id=\"fazit\"><a class=\"header-anchor\" href=\"https://tony-spegel.com/blog/challenge-progress-stepper/#fazit\">Fazit</a></h2>\n<p>Perfekt ist meine L√∂sung zwar nicht aber interessant war es alle Mal. Besonders geholfen haben hier die CSS Variablen mit denen zwar viel mit festen Werten gerechnet wurde aber diese immerhin voneinander abh√§ngig sind und somit kein gro√ües Problem darstellen sollten. In der Realit√§t m√ºsste es noch einen Prozess geben, welcher den jeweiligen Stand einer Bestellung etc. im HTML widerspiegelt - ob statisch oder dynamisch w√§re hierbei egal. Lediglich das f√ºr Screenreader wichtige <code>aria-current=&quot;step&quot;</code> sollte im aktuellen Schritt gesetzt sein.<br />\nDen Code als Ganzes gibt es noch einmal hier auf meinem <a href=\"https://codepen.io/TonySpegel/pen/XWgWRgm?editors=1100\">Codepen</a>.</p>\n</section>\n",
      "date_published": "2021-08-23T00:00:00Z"
    }
  ]
}
