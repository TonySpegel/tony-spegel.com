<!DOCTYPE html>

<!doctype html>
<html lang="de">
  
  <head>
  
  








<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Custom Events mit @eventEmitter</title>
<meta name="description" content="Ein ClassMethod-Decorator welcher CustomEvents auslösen kann. Mit diesem Standard Decorator kann DOM-unabhängig kommuniziert werden. Eine gute Lösung für (Web) Components und Frameworks.">
<meta name="generator" content="Eleventy v2.0.1">
<meta name="theme-color" content="#d5d5ff" media="(prefers-color-scheme: light)">
<meta property="og:title" content="Custom Events mit @eventEmitter">
<meta property="og:description" content="Ein ClassMethod-Decorator welcher CustomEvents auslösen kann. Mit diesem Standard Decorator kann DOM-unabhängig kommuniziert werden. Eine gute Lösung für (Web) Components und Frameworks.">

<meta property="og:image" content="https://tony-spegel.com/img/social-images/2023/event-emitter-decorator.png">

<meta name="version" content="6.0.4">


  

  <style>
    
      *{margin:0;padding:0}*,:after,:before{box-sizing:border-box}h1{font-size:2em;margin:var(--base-gap) 0}p:not(.post-summary){line-height:1.9;font-size:clamp(1rem, .96rem + .18vw, 1.125rem);margin-block-end:var(--base-gap)}.glass{position:fixed;width:100vw;height:100vh;background-color:var(--glass-tint);backdrop-filter:blur(70px);z-index:0}.bubble{border-radius:65% 41% 48% 61%/61% 47% 57% 43%;width:var(--bubble-size);height:var(--bubble-size);background-color:var(--bubble-1--color-1);background-image:linear-gradient(19deg,var(--bubble-1--color-1) 0,var(--bubble-1--color-2) 100%);z-index:-1;position:fixed;right:-35px;top:-50px}.bubble-2{border-radius:72% 80% 70% 63%/83% 50% 100% 43%;width:var(--bubble-size);height:var(--bubble-size);background-color:var(--bubble-2--color-1);background-image:linear-gradient(226deg,var(--bubble-2--color-1) 0,var(--bubble-2--color-2) 100%);z-index:-1;bottom:-120px;position:fixed}#site-header{position:sticky;top:0;line-height:1;z-index:2}#site-header.opaque{background-color:var(--header-bg-color);border-bottom:2px solid var(--surface-4)}#site-header.opaque .logo{box-shadow:var(--shadow-2)}.logo{transition:transform ease .5s,box-shadow ease .5s}#site-header>*{margin:0}#site-header>nav{display:flex;align-items:center;justify-content:space-between;height:var(--header-height);padding:var(--base-gap)}.logo{display:flex;gap:var(--base-gap);align-items:center;border-radius:15px;padding:var(--logo-padding);width:var(--logo-size);height:var(--logo-size);transition:transform .1s ease-in-out;aspect-ratio:1/1;border:1px solid transparent;background-color:var(--logo-bg-color)}.logo img{width:100%;height:100%}#btn-theme-selection{border-radius:50%;border:2px solid hsla(281,53%,97%,.63);width:25px;aspect-ratio:1;background:linear-gradient(-45deg,#ca98e1,#20d4fc);transition:border .5s ease-out}#btn-theme-selection:is(:focus,:hover){border-color:hsla(281,100%,63%,.75)}:where(html){--base-gap:16px;--base-radius:8px;--site-max-width:1280px;--site-width:960px;--base-line-height:1.25;--logo-size:56px;--logo-padding:2px;--header-height:100px;--shadow-color:220 3% 15%;--shadow-strength:1%;--shadow-2:0 3px 5px -2px hsl(var(--shadow-color) /
          calc(var(--shadow-strength) + 3%)),0 7px 14px -5px hsl(var(--shadow-color) / calc(var(--shadow-strength) + 5%));--tag-border-radius:18px;--detail-summary-icon-size:24px}:where(h1,h2,h3,h4,h5,h6){line-height:var(--base-line-height)}theme-switch{--base-gap:16px}theme-switch:not(:defined) [slot]{display:none}toc-observer ol{list-style-type:none;line-height:1;padding:0}toc-observer ol:not(:first-child){padding-inline:0.85em}toc-observer a{display:flex;border-left:2px solid var(--toc-item-border-default-color);padding:calc(var(--base-gap)/ 2) var(--base-gap);color:var(--text-color-1);transition:all 50ms ease-in-out;text-decoration:none}toc-observer a:is(:hover,:focus,.toc-active){border-left-color:var(--toc-item-border-active-color)}[theme-preference=dark] .dropdown__toc{border:1px solid var(--surface-4);background-color:var(--surface-5)}theme-switch{--base-gap:16px}theme-switch:not(:defined) [slot]{display:none}toc-observer ol{list-style-type:none;line-height:1;padding:0}toc-observer ol:not(:first-child){padding-inline:0.85em}toc-observer a{display:flex;border-left:2px solid var(--toc-item-border-default-color);padding:calc(var(--base-gap)/ 2) var(--base-gap);color:var(--text-color-1);transition:all 50ms ease-in-out;text-decoration:none}toc-observer a:is(:hover,:focus,.toc-active){border-left-color:var(--toc-item-border-active-color)}[theme-preference=dark] .dropdown__toc{border:1px solid var(--surface-4);background-color:var(--surface-5)}:where(html){--shade-50:hsla(281, 53%, 97%, 1);--shade-50-glass:hsla(281, 53%, 97%, 0.63);--shade-100:hsla(281, 56%, 94%, 1);--shade-200:hsla(281, 56%, 84%, 1);--shade-300:hsla(281, 55%, 74%, 1);--shade-400:hsla(281, 55%, 55%, 1);--shade-500:hsla(281, 100%, 35%, 1);--shade-600:hsla(281, 100%, 32%, 1);--shade-700:hsla(281, 100%, 27%, 1);--shade-800:hsla(281, 100%, 21%, 1);--shade-900:hsla(281, 100%, 16%, 1);--text-1-light:var(--shade-800);--text-2-light:var(--shade-900);--surface-1-light:var(--shade-300);--surface-2-light:var(--shade-200);--surface-3-light:var(--shade-100);--surface-4-light:var(--shade-600);--surface-5-light:var(--surface-4-light);--border-light:var(--shade-200);--bubble-size:350px;--bubble-1--color-1:hsl(191, 98%, 56%);--bubble-1--color-2:hsl(281, 100%, 56%);--bubble-2--color-1:hsl(338, 78%, 48%);--bubble-2--color-2:hsl(199, 98%, 48%);--lavender-blue-1:#e6e6ff;--lavender-blue-2:#ccc9ff;--lavender-blue-3:#b3b3ff;--lavender-blue-4:#9996ff;--lavender-blue-5:#bbb9fe;--text-color-1--light:var(--shade-900);--glass-tint--light:hsl(200deg 100% 96% / 67%);--header-bg-color--light:#d5d5ff;--logo-bg-color--light:var(--lavender-blue-1);--hr-color--light:var(--lavender-blue-2);--disclaimer-badge-border--light:hsl(53.88deg 100% 80.78%);--disclaimer-badge-bg--light:hsl(54deg 100% 73%);--disclaimer-badge-text--light:var(--text-color-1--light);--disclaimer-box-border-color--light:#bbdefb;--disclaimer-box-bg-color--light:hsl(205.38deg 86.67% 94.12%);--details-summary-border-color--light:hsl(146deg 87.42% 65.38%);--details-summary-bg-color--light:hsl(146deg 87.42% 80.38%);--details-summary-bg-color-active--light:hsl(146deg 87.42% 70.38%);--details-summary-font-color--light:#000;--tag-border-color--light:var(--lavender-blue-2);--tag-bg-color--light:#d5d5ff;--tag-bg-color-active--light:var(--lavender-blue-1);--tag-font-color--light:var(--text-color-1--light);--code-bg-color-inline--light:var(--lavender-blue-1);--kbd-border-color--light:var(--lavender-blue-3);--kbd-bg-color--light:var(--lavender-blue-1);--radio-container-badge-bg-color--light:var(--lavender-blue-2);--radio-container-border-color--light:var(--lavender-blue-2);--radio-container-bg-color--light:var(--lavender-blue-1);--post-card-border-color--light:var(--lavender-blue-2);--post-card-bg-color--light:#f0efff;--social-link-border-color--light:var(--lavender-blue-2);--social-link-bg-color--light:var(--tag-bg-color--light);--social-link-bg-color-active--light:var(--tag-bg-color-active--light);--toc-item-border-default-color--light:var(--lavender-blue-2);--toc-item-border-active-color--light:var(--surface-4);--toc-dropdown-border-color--light:var(--lavender-blue-5);--toc-dropdown-bg--light:var(--lavender-blue-1);--toc-dropdown-icon-color-filter-value--light:0;--dialog-bg-color--light:var(--lavender-blue-1);--dialog-border-color--light:var(--lavender-blue-4);--themes-border-color--light:var(--lavender-blue-2);--control-color--light:var(--lavender-blue-3);--control-interaction-color--light:var(--lavender-blue-2);--circle-border-color--light:var(--lavender-blue-4);--circle-bg-color--light:var(--lavender-blue-1);--circle-bg-color-checked--light:var(--lavender-blue-3);--circle-wave--light:#000;--checkbox-border-color--light:var(--lavender-blue-4);--checkbox-bg-color--light:var(--lavender-blue-1);--checkbox-bg-color-checked--light:var(--lavender-blue-2);--checkmark-color--light:var(--lavender-blue-1);--deep-purple-1:hsl(281, 56%, 10%);--deep-purple-2:hsl(281, 60%, 15%);--deep-purple-3:hsl(281, 60%, 20%);--deep-purple-4:hsl(281, 60%, 25%);--deep-purple-5:hsl(262, 86%, 8%);--text-color-1--dark:#fff;--glass-tint--dark:hsla(286, 86%, 6%, 0.657);--header-bg-color--dark:var(--deep-purple-2);--logo-bg-color--dark:var(--deep-purple-3);--hr-color--dark:var(--deep-purple-4);--disclaimer-badge-border--dark:hsl(53.88deg 100% 80.78%);--disclaimer-badge-bg--dark:hsl(54deg 100% 73%);--disclaimer-badge-text--dark:#000;--disclaimer-box-border-color--dark:#bbdefb;--disclaimer-box-bg-color--dark:hsl(205.38deg 64.06% 21.67%);--tag-border-color--dark:none;--tag-bg-color--dark:var(--deep-purple-3);--tag-bg-color-active--dark:var(--deep-purple-2);--tag-font-color--dark:var(--text-color-1--dark);--code-bg-color-inline--dark:var(--deep-purple-3);--kbd-border-color--dark:var(--deep-purple-4);--kbd-bg-color--dark:var(--deep-purple-3);--radio-container-badge-bg-color--dark:var(--deep-purple-2);--radio-container-border-color--dark:var(--deep-purple-1);--radio-container-bg-color--dark:var(--deep-purple-3);--post-card-border-color--dark:var(--deep-purple-4);--post-card-bg-color--dark:var(--deep-purple-1);--social-link-border-color--dark:var(--deep-purple-4);--social-link-bg-color--dark:var(--tag-bg-color--dark);--social-link-bg-color-active--dark:var(--tag-bg-color-active--dark);--toc-item-border-default-color--dark:var(--deep-purple-4);--toc-item-border-active-color--dark:var(--shade-50);--toc-dropdown-border-color--dark:var(--lavender-blue-5);--toc-dropdown-bg-color--dark:var(--deep-purple-5);--toc-dropdown-icon-color-filter-value--dark:1;--dialog-border-color--dark:var(--deep-purple-2);--dialog-bg-color--dark:var(--deep-purple-5);--themes-border-color--dark:var(--deep-purple-3);--circle-border-color--dark:#eedcf530;--circle-bg-color--dark:#2a1d5445;--circle-bg-color-checked--dark:var(--deep-purple-3);--circle-wave--dark:#fff;--control-color--dark:var(--deep-purple-3);--control-interaction-color--dark:var(--deep-purple-2);--checkbox-border-color--dark:var(--deep-purple-3);--checkbox-bg-color--dark:#402e7e45;--checkbox-bg-color-checked--dark:var(--deep-purple-3);--checkmark-color--dark:#fff;--text-1-dark:hsl(0, 0%, 90%);--text-2-dark:hsl(0, 0%, 95%);--border-dark:var(--shade-800)}:where(html),[theme-preference=light]{color-scheme:light;--surface-1:var(--surface-1-light);--surface-2:var(--surface-2-light);--surface-3:var(--surface-3-light);--surface-4:var(--surface-4-light);--surface-5:var(--surface-4-light);--text-color-1:var(--text-color-1--light);--header-bg-color:var(--header-bg-color--light);--logo-bg-color:var(--logo-bg-color--light);--glass-tint:var(--glass-tint--light);--hr-color:var(--hr-color--light);--disclaimer-badge-border:var(--disclaimer-badge-border--light);--disclaimer-badge-bg:var(--disclaimer-badge-bg--light);--disclaimer-badge-text:var(--disclaimer-badge-text--light);--disclaimer-box-border-color:var(--disclaimer-box-border-color--light);--disclaimer-box-bg-color:var(--disclaimer-box-bg-color--light);--details-summary-border-color:var(--details-summary-border-color--light);--details-summary-bg-color:var(--details-summary-bg-color--light);--details-summary-bg-color-active:var(--details-summary-bg-color-active--light);--details-summary-font-color:var(--details-summary-font-color--light);--tag-border-color:var(--tag-border-color--light);--tag-bg-color:var(--tag-bg-color--light);--tag-bg-color-active:var(--tag-bg-color-active--light);--tag-font-color:var(--tag-font-color--light);--code-bg-color-inline:var(--code-bg-color-inline--light);--kbd-border-color:var(--kbd-border-color--light);--kbd-bg-color:var(--kbd-bg-color--light);--radio-container-badge-bg-color:var(--radio-container-badge-bg-color--light);--radio-container-border-color:var(--radio-container-border-color--light);--radio-container-bg-color:var(--radio-container-bg-color--light);--post-card-border-color:var(--post-card-border-color--light);--post-card-bg-color:var(--post-card-bg-color--light);--social-link-border-color:var(--social-link-border-color--light);--social-link-bg-color:var(--social-link-bg-color--light);--social-link-bg-color-active:var(--social-link-bg-color-active--light);--toc-dropdown-border-color:var(--toc-dropdown-border-color--light);--toc-dropdown-bg-color:var(--toc-dropdown-bg--light);--toc-dropdown-icon-color-filter-value:var(--toc-dropdown-icon-color-filter-value--light)}:where(html) theme-switch,[theme-preference=light] theme-switch{--text-color-1:var(--purple-950);--text-color-2:var(--purple-900);--dialog-border-color:var(--dialog-border-color--light);--dialog-bg-color:var(--dialog-bg-color--light);--themes-border-color:var(--themes-border-color--light);--circle-border-color:var(--circle-border-color--light);--circle-bg-color:var(--circle-bg-color--light);--circle-bg-color-checked:var(--circle-bg-color-checked--light);--circle-wave:var(--circle-wave--light);--control-color:var(--control-color--light);--control-interaction-color:var(--control-interaction-color--light);--checkbox-border-color:var(--checkbox-border-color--light);--checkbox-bg-color:var(--checkbox-bg-color--light);--checkbox-bg-color-checked:var(--checkbox-bg-color-checked--light);--checkmark-color:var(--checkmark-color--light)}:where(html) toc-observer,[theme-preference=light] toc-observer{--toc-item-border-default-color:var(--toc-item-border-default-color--light);--toc-item-border-active-color:var(--toc-item-border-active-color--light)}@media (prefers-color-scheme:dark){:where(html){color-scheme:dark;--surface-1:var(--deep-purple-1);--surface-2:var(--deep-purple-2);--surface-3:var(--deep-purple-3);--surface-4:var(--deep-purple-4);--surface-5:var(--deep-purple-5);--text-color-1:#fff;--header-bg-color:var(--header-bg-color--dark);--logo-bg-color:var(--logo-bg-color--dark);--glass-tint:var(--glass-tint--dark);--hr-color:var(--hr-color--dark);--disclaimer-badge-bg:var(--disclaimer-badge-bg--dark);--disclaimer-badge-border:var(--disclaimer-badge-border--dark);--disclaimer-badge-text:var(--disclaimer-badge-text--dark);--disclaimer-box-border-color:var(--disclaimer-box-border-color--dark);--disclaimer-box-bg-color:var(--disclaimer-box-bg-color--dark);--tag-border-color:var(--tag-border-color--dark);--tag-bg-color:var(--tag-bg-color--dark);--tag-bg-color-active:var(--tag-bg-color-active--dark);--tag-font-color:var(--tag-font-color--dark);--code-bg-color-inline:var(--code-bg-color-inline--dark);--kbd-border-color:var(--kbd-border-color--dark);--kbd-bg-color:var(--kbd-bg-color--dark);--radio-container-badge-bg-color:var(--radio-container-badge-bg-color--dark);--radio-container-border-color:var(--radio-container-border-color--dark);--radio-container-bg-color:var(--radio-container-bg-color--dark);--post-card-border-color:var(--post-card-border-color--dark);--post-card-bg-color:var(--post-card-bg-color--dark);--social-link-border-color:var(--social-link-border-color--dark);--social-link-bg-color:var(--social-link-bg-color--dark);--social-link-bg-color-active:var(--social-link-bg-color-active--dark);--toc-dropdown-border-color:var(--toc-dropdown-border-color--dark);--toc-dropdown-bg-color:var(--toc-dropdown-bg-color--dark);--toc-dropdown-icon-color-filter-value:var(--toc-dropdown-icon-color-filter-value--dark)}:where(html) theme-switch{--text-color-1:#fff;--text-color-2:#fff;--dialog-border-color:var(--dialog-border-color--dark);--dialog-bg-color:var(--dialog-bg-color--dark);--themes-border-color:var(--themes-border-color--dark);--circle-border-color:var(--circle-border-color--dark);--circle-bg-color:var(--circle-bg-color--dark);--circle-bg-color-checked:var(--circle-bg-color-checked--dark);--circle-wave:var(--circle-wave--dark);--control-color:var(--control-color--dark);--control-interaction-color:var(--control-interaction-color--dark);--checkbox-border-color:var(--checkbox-border-color--dark);--checkbox-bg-color:var(--checkbox-bg-color--dark);--checkbox-bg-color-checked:var(--checkbox-bg-color-checked--dark);--checkmark-color:#fff}toc-observer{--toc-item-border-default-color:var(--toc-item-border-default-color--dark);--toc-item-border-active-color:var(--toc-item-border-active-color--dark)}.social-links img{filter:brightness(0) invert(1)}header.opaque .logo{border-color:var(--surface-4)}}[theme-preference=dark]{color-scheme:dark;--surface-1:var(--deep-purple-1);--surface-2:var(--deep-purple-2);--surface-3:var(--deep-purple-3);--surface-4:var(--deep-purple-4);--surface-5:var(--deep-purple-5);--text-color-1:#fff;--header-bg-color:var(--header-bg-color--dark);--logo-bg-color:var(--logo-bg-color--dark);--glass-tint:var(--glass-tint--dark);--hr-color:var(--hr-color--dark);--disclaimer-badge-bg:var(--disclaimer-badge-bg--dark);--disclaimer-badge-border:var(--disclaimer-badge-border--dark);--disclaimer-badge-text:var(--disclaimer-badge-text--dark);--disclaimer-box-border-color:var(--disclaimer-box-border-color--dark);--disclaimer-box-bg-color:var(--disclaimer-box-bg-color--dark);--tag-border-color:var(--tag-border-color--dark);--tag-bg-color:var(--tag-bg-color--dark);--tag-bg-color-active:var(--tag-bg-color-active--dark);--tag-font-color:var(--tag-font-color--dark);--code-bg-color-inline:var(--code-bg-color-inline--dark);--kbd-border-color:var(--kbd-border-color--dark);--kbd-bg-color:var(--kbd-bg-color--dark);--radio-container-badge-bg-color:var(--radio-container-badge-bg-color--dark);--radio-container-border-color:var(--radio-container-border-color--dark);--radio-container-bg-color:var(--radio-container-bg-color--dark);--post-card-border-color:var(--post-card-border-color--dark);--post-card-bg-color:var(--post-card-bg-color--dark);--social-link-border-color:var(--social-link-border-color--dark);--social-link-bg-color:var(--social-link-bg-color--dark);--social-link-bg-color-active:var(--social-link-bg-color-active--dark);--toc-dropdown-border-color:var(--toc-dropdown-border-color--dark);--toc-dropdown-bg-color:var(--toc-dropdown-bg-color--dark);--toc-dropdown-icon-color-filter-value:var(--toc-dropdown-icon-color-filter-value--dark)}[theme-preference=dark] theme-switch{--text-color-1:#fff;--text-color-2:#fff;--dialog-border-color:var(--dialog-border-color--dark);--dialog-bg-color:var(--dialog-bg-color--dark);--themes-border-color:var(--themes-border-color--dark);--circle-border-color:var(--circle-border-color--dark);--circle-bg-color:var(--circle-bg-color--dark);--circle-bg-color-checked:var(--circle-bg-color-checked--dark);--circle-wave:var(--circle-wave--dark);--control-color:var(--control-color--dark);--control-interaction-color:var(--control-interaction-color--dark);--checkbox-border-color:var(--checkbox-border-color--dark);--checkbox-bg-color:var(--checkbox-bg-color--dark);--checkbox-bg-color-checked:var(--checkbox-bg-color-checked--dark);--checkmark-color:#fff}[theme-preference=dark] toc-observer{--toc-item-border-default-color:var(--toc-item-border-default-color--dark);--toc-item-border-active-color:var(--toc-item-border-active-color--dark)}[theme-preference=dark] .social-links img{filter:brightness(0) invert(1)}[theme-preference=dark] header.opaque .logo{border-color:var(--surface-4)}.header-links{display:flex;align-items:center;gap:var(--base-gap)}.header-links>li{list-style-type:none}#dropdown__title{display:flex;align-items:center;gap:calc(var(--base-gap)/ 2);border-radius:var(--base-radius);border:2px solid hsla(281,53%,97%,.63);padding:calc(var(--base-gap)/ 4) calc(var(--base-gap)/ 2);background-color:transparent}#dropdown__title img{aspect-ratio:1;height:1.5rem;filter:brightness(0) invert(var(--toc-dropdown-icon-color-filter-value))}.dropdown{position:relative;display:flex;justify-content:center;align-items:center}.dropdown:focus-within .dropdown__toc,.dropdown:hover .dropdown__toc{opacity:1;transform:rotateX(0) translateX(0);visibility:visible}.dropdown .dropdown__toc{display:grid;position:absolute;top:calc(100% - .25rem);right:0;transform:rotateX(-90deg) translateX(0);transform-origin:top center;opacity:.3;transition:280ms all ease-out;border-radius:4px;border:1px solid var(--toc-dropdown-border-color);background-color:var(--toc-dropdown-bg-color);box-shadow:0 .15em .25em rgba(0,0,0,.25);margin-block-start:var(--base-gap);padding:calc(var(--base-gap)/ 2);min-width:20ch}.dropdown .dropdown__toc a{color:var(text-1);display:block;padding:.5em}[theme-preference=dark] .post-tag.lit span{background-image:url("/img/flame-white.svg")}:where(a[href],area,button,input,label[for],select,summary,textarea,[tabindex]:not([tabindex*="-"])){cursor:pointer;touch-action:manipulation}html{block-size:100%;-webkit-text-size-adjust:none}hr{background-color:var(--hr-color);height:1px;border:0}body{display:flex;flex-direction:column;color:var(--text-color-1);font-family:Inter,sans-serif}:where(p,a,h1,h2,h3,h4,h5,h6){color:var(--text-color-1);overflow-wrap:break-word}:where(button,input,a[href],summary):where(:not(:active)):focus-visible{outline-offset:5px;transition:outline-offset 145ms ease}@media (prefers-reduced-motion:no-preference){a{transition:all .1s ease-in-out}a[href]:active{transform:scale(.95)}}.tmpl-home{display:flex;flex-direction:column;height:100vh}.tmpl-home .main-wrapper{flex:1;padding:var(--base-gap)}.main-wrapper{z-index:1}.main-wrapper main{margin:0 auto;width:100%;max-width:var(--site-width)}.intro{line-height:1.5;max-width:470px}.intro h1{margin-block-start:0}.social-links{--social-link-size:64px;display:flex;flex-wrap:wrap;gap:var(--base-gap);margin-block-start:calc(var(--base-gap) * -2);padding:0;list-style:none}.social-links li{border:1px solid var(--social-link-border-color);border-radius:50%;width:var(--social-link-size);height:var(--social-link-size);background-color:var(--social-link-bg-color)}.social-links li:is(:hover,:focus){background-color:var(--social-link-bg-color-active)}.social-links li a{display:flex;border-radius:50%;height:100%;padding:calc(var(--base-gap)/ 2)}.social-links li a img{width:100%;height:auto}aside.toc{grid-area:toc;position:sticky;top:calc(var(--header-height) + var(--base-gap) * 2);max-height:200px}.dropdown{display:none}@media screen and (max-width:750px){#main-wrapper.post{grid-template-areas:"main";grid-template-columns:1fr}aside.toc{display:none}aside#toc-mobile{display:block}}@media screen and (max-width:1199px){.dropdown{display:flex}}pre[class*=language-]{max-width:100%}footer{display:flex;align-items:center;justify-content:space-between;gap:var(--base-gap);padding:var(--base-gap);z-index:1}footer ul{display:flex;list-style-type:none;gap:var(--base-gap)}@media screen and (max-width:500px){footer{flex-direction:column-reverse;text-align:center}footer ul{flex-direction:column}}.post-tags{display:inline-flex;flex-wrap:wrap;gap:calc(var(--base-gap)/ 2 + 4px);padding:0;margin:0;list-style-type:none}.post-tags>li{display:inherit;align-items:center;height:36px}.post-tag{gap:calc(var(--base-gap)/ 2)}.post-tag.lit span{background-image:url("/img/flame.svg");background-size:contain;background-repeat:no-repeat;height:100%;aspect-ratio:4/5}.post-tag{display:flex;align-items:center;height:100%;padding:calc(var(--base-gap)/ 2) calc(var(--base-gap) * .75);border-radius:var(--tag-border-radius);text-decoration:none;background-color:var(--tag-bg-color);border:1px solid var(--tag-border-color);color:var(--tag-font-color);transform-origin:center}.post-tag img{height:100%}a.postlist-link{font-weight:500;font-size:1.2rem}.post-tag:is(:hover,:focus){background-color:var(--tag-bg-color-active)}.post-tag:active{transform:scale(.95)}.single-tag{display:inline-flex;margin-block-end:var(--base-gap)}.all-tags{margin:var(--base-gap) 0!important}.posts{display:grid;gap:var(--base-gap);grid-template-columns:repeat(auto-fill,minmax(300px,1fr));margin-block-start:var(--base-gap);margin-block-end:var(--base-gap);max-width:1280px}.postlist-item{--shadow-strength:1px;box-shadow:0 3px 5px -2px hsla(var(--shadow-color)/.04),0 7px 14px -5px hsla(var(--shadow-color)/.06),0 0 0 var(--shadow-strength) var(--post-card-border-color),0 7px 14px -5px hsla(var(--shadow-color)/.1);display:flex;flex-direction:column;gap:var(--base-gap);border-radius:var(--base-radius);border:1px solid var(--post-card-border-color);padding:var(--base-gap);background-color:var(--post-card-bg-color)}.postlist-item:focus-within{--shadow-strength:2px}.postlist-item header{display:flex;flex-direction:column}.post-tags{margin-top:auto}.disclaimer{position:relative;display:inline-block;border-radius:calc(var(--base-radius) * 1.5);border:1px solid var(--disclaimer-box-border-color);margin-block-start:calc(var(--base-gap) * 2);margin-block-end:var(--base-gap);max-width:500px;width:100%;padding:var(--base-gap);background-color:var(--disclaimer-box-bg-color);line-height:1.5}.disclaimer span{position:absolute;top:-20px;padding:4px 8px;border-radius:8px;border:1px solid var(--disclaimer-badge-border);background:var(--disclaimer-badge-bg);color:var(--disclaimer-badge-text)}.disclaimer ul{margin-block-end:0;padding-inline-start:2.5rem}details{position:relative;max-width:500px;width:100%;margin-block-end:var(--base-gap)}details[open] summary{position:absolute}details[open] summary:before{content:"";transform:rotate(180deg)}details[open]>.details-content{border-radius:calc(var(--base-radius) * 1.5);border:1px solid var(--disclaimer-box-border-color)}details summary{display:inline-flex;align-items:center;list-style:none;border-radius:calc(var(--base-radius) * 1.5);border:1px solid var(--details-summary-border-color);margin-inline-start:1px;margin-block-start:1px;padding:calc(var(--base-gap)/ 2) var(--base-gap);color:var(--details-summary-font-color);background-color:var(--details-summary-bg-color)}details summary:before{content:"";height:var(--detail-summary-icon-size);width:var(--detail-summary-icon-size);background-image:url("/img/icons/expand_more_FILL0_wght400_GRAD0_opsz48.svg");background-size:var(--detail-summary-icon-size);background-repeat:no-repeat;transform-origin:center;transition:transform 225ms cubic-bezier(.4, 0, .2, 1)}details summary:is(:hover,:focus){background-color:var(--details-summary-bg-color-active)}details .details-content{padding-block-start:calc(var(--base-gap) * 2.5);padding-block-end:var(--base-gap);padding-inline:var(--base-gap);background-color:var(--disclaimer-box-bg-color)}details .details-content p:last-child{margin-block-end:0}.main-start{display:flex;flex-direction:column;gap:var(--base-gap);--filter-value:"1"}.main-start .intro h1{margin:var(--base-gap) 0;margin-block-start:0}.main-start h1{margin:0}.main-start .posts{margin:0}.main-start #read-more-link{display:flex;align-items:center;text-decoration:none;margin-inline-start:auto}.main-start #read-more-chevron{filter:invert(var(--filter-value), 1)}#me-wrapper{display:flex;gap:var(--base-gap);flex-wrap:wrap;padding:var(--base-gap) 0 calc(var(--base-gap) * 1.5);padding-block-end:0}.me{display:flex;flex-direction:column;align-items:center;margin:calc(var(--base-gap) * -1) auto 0}.profile-picture svg{width:100%;height:100%}.profile-picture img{max-width:100%}#menu-items{bottom:anchor(bottom);left:anchor(center);translate:-50% 0}body{line-height:1.5;-webkit-font-smoothing:antialiased}.post{max-width:fit-content}.main-wrapper{display:flex;flex-direction:column;gap:3rem;margin:0 auto;padding-inline:clamp(1.375rem,1.2rem + 0.89vw,2rem)}aside{display:none}kbd{padding:3px 5px;border-radius:6px;background-color:var(--kbd-bg-color);box-shadow:0 2px 0 1px var(--kbd-border-color)}.sample-img{height:auto;width:100%}@media screen and (min-width:1200px){body:not(.content-page) .main-wrapper{display:grid;grid-template-columns:var(--site-width) 250px;grid-template-areas:"main toc"}aside{display:block}}header{margin-bottom:calc(var(--base-gap) * 2);line-height:normal}h1{margin-block-start:0;font-size:clamp(1.5rem, 1.29rem + 1.07vw, 2.25rem)}h2{font-size:clamp(1.25rem, 1.11rem + .71vw, 1.75rem)}h3{font-size:clamp(1.125rem, 1.09rem + .18vw, 1.25rem)}:is(h2,h3):not([slot]){margin:revert;scroll-margin-top:calc(var(--header-height) + var(--base-gap))}p{line-height:1.9;font-size:clamp(1rem, .96rem + .18vw, 1.125rem)}aside{--top:calc(var(--header-height) + var(--base-gap) * 5);position:sticky;top:var(--top);height:fit-content}ul:not(.post-tags,.footer-links,.header-links){line-height:2;margin:var(--base-gap) 0;padding:revert}blockquote,p{margin-block-end:var(--base-gap)}.post :is(h2,h3,h4,h5,h6){margin-block-start:clamp(1.5rem,3vw,2rem)}figure{margin-block-end:var(--base-gap);width:fit-content}figcaption{text-align:center}table{border-collapse:collapse}table,td,th{border:1px solid var(--text-color-1);text-align:left;padding:calc(var(--base-gap)/ 2) var(--base-gap)}code{overflow-x:auto}code:not([class^=language-]){border-radius:calc(var(--base-radius)/ 2);padding:calc(var(--base-gap)/ 4) calc(var(--base-gap)/ 2);background-color:var(--code-bg-color-inline)}blockquote{font-style:italic;border-radius:var(--base-radius);border:2px solid var(--surface-3);padding:var(--base-gap)}#toc-nav{display:none;top:var(--header-height);position:fixed;right:0}#toc-opener:is(:focus,:hover)+#toc-nav{display:block}#skip-to-main-link{position:fixed;left:10px;top:var(--header-height);border-radius:var(--base-radius);padding:var(--base-gap);background-color:#d5d5ff;z-index:5}toc-observer ol{list-style-type:none;line-height:1;padding:0}toc-observer ol:not(:first-child){padding-inline:0.85em}toc-observer a{display:flex;border-left:2px solid var(--toc-item-border-default-color);padding:calc(var(--base-gap)/ 2) var(--base-gap);color:var(--text-color-1);transition:all 50ms ease-in-out;text-decoration:none}toc-observer a:is(:hover,:focus,.toc-active){border-left-color:var(--toc-item-border-active-color)}[theme-preference=dark] .dropdown__toc{border:1px solid var(--surface-4);background-color:var(--surface-5)}theme-switch{--base-gap:16px}theme-switch:not(:defined) [slot]{display:none}:root{--color-bg:#2b2b2b;--color-color-primary:#f8f8f2;--color-color-secondary:#d4d0ab;--code-color-punctuation:#fefefe;--color-4:#ffa07a;--color-5:#00e0e0;--code-color-boolean:var(--color-5);--color-6:#abe338;--color-7:#ffd700}:is(code,pre):is([class*=language-]){color:var(--color-color-primary);background:0 0;font-family:Consolas,Monaco,"Andale Mono","Ubuntu Mono",monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;tab-size:4;hyphens:none}pre[class*=language-]{padding:1em;margin-block-end:1em;border-radius:calc(var(--base-radius) * 2);max-width:100%;padding:var(--base-gap);max-width:100%;border-radius:8px;display:grid;grid-template-areas:"code";gap:var(--base-gap);align-items:center}:not(pre)>code[class*=language-],pre[class*=language-]{background:var(--color-bg)}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal}.token:is(.comment,.prolog,.doctype,.cdata){color:var(--color-color-secondary)}.token.punctuation{color:var(--code-color-punctuation)}.token:is(.property,.tag,.constant,.symbol,.deleted){color:var(--color-4)}.token:is(.boolean,.number){color:var(--color-5)}.language-css .token.string,.style .token.string,.token:is(.entity,.keyword,.operator,.url,.variable){color:var(--color-5)}.token:is(.selector,.attr-name,.string,.char,.builtin,.inserted){color:var(--color-6)}.token:is(.atrule,.attr-value,.function,.regex,.important){color:var(--color-7)}.token:is(.important,.bold){font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}@media screen and (-ms-high-contrast:active){code[class*=language-],pre[class*=language-]{color:windowText;background:window}:not(pre)>code[class*=language-],pre[class*=language-]{background:window}.token.important{background:highlight;color:window;font-weight:400}.token:is(.atrule,.attr-value,.function,.keyword,.operator,.selector){font-weight:700}.token:is(.attr-value,.comment,.doctype,.function,.keyword,.operator,.property,.string){color:highlight}.token:is(.attr-value,.url){font-weight:400}}@font-face{font-family:Inter;font-style:normal;font-weight:400;font-display:swap;src:url("/fonts/inter-v7-latin-regular.woff2") format("woff2");unicode-range:U+0000-00FF,U+02BB-02BC,U+02DA,U+02DC,U+2000-206F,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215}@font-face{font-family:Inter;font-style:normal;font-weight:500;font-display:swap;src:url("/fonts/inter-v7-latin-500.woff2") format("woff2");unicode-range:U+0000-00FF,U+02BB-02BC,U+02DA,U+02DC,U+2000-206F,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215}@font-face{font-family:Inter;font-style:normal;font-weight:700;font-display:swap;src:url("/fonts/inter-v7-latin-700.woff2") format("woff2");unicode-range:U+0000-00FF,U+02BB-02BC,U+02DA,U+02DC,U+2000-206F,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215}
    
  </style>


  <script>
  // Read theme preference from localStorage
  const themePreference = localStorage.getItem('theme-preference');
  // Set theme if one is present in localStorage
  if (themePreference !== null) {
    document
      .querySelector('html')
      .setAttribute('theme-preference', themePreference);
  }
</script>


  <link rel="alternate" href="/feed/feed.xml" type="application/atom+xml" title="Tony Spegel">
  <link rel="alternate" href="/feed/feed.json" type="application/json" title="Tony Spegel">

  
  
    
    <script type="module" src="/js/theme-switch.js"></script>
  
    
    <script type="module" src="/js/index.js"></script>
  
    
    <script type="module" src="/js/post.js"></script>
  
  <link rel="icon" href="/favicon.svg">
</head>

  <body>
    
<theme-switch>
  <h2 slot="heading">Theme Auswahl</h2>
  <span slot="sub-heading">Wähle ein Theme für die Website</span>
  <a href="datenschutzerklaerung/#auswertung-des-verhaltens-von-besucherinnen-und-besuchern-cookies"
    id="read-more"
    slot="read-more"
    target="_blank"
    title="Was wird gespeichert?"
  >
    ?
  </a>
  <span slot="close-caption">Schließen</span>
</theme-switch>

    <header id="site-header">
  <nav aria-label="Hauptnavigation">
    
      <a class="logo" href="/" title="Zur Startseite">
        <img src="/tsp_icon.svg" alt="Tony Spegel Logo">
      </a>
    

    <ul class="header-links">
      
      <li class="dropdown">
        <button type="button"id="dropdown__title">
          Inhalt
          <img src="/img/icons/toc_FILL0_wght400_GRAD0_opsz48.svg" aria-hidden="true" >
        </button>

        <div class="dropdown__toc" id="drop-down-container">
          <toc-observer observeParent>
            <div slot="toc">
              <nav class="toc">
                <ol>
                    
                    <li><a href="#motivation">Motivation</a>
            		</li>

                    <li><a href="#anwendungsbeispiel">Anwendungsbeispiel</a>
            		</li>

                    <li><a href="#implementation">Implementation</a>
            
                <ol>
                    
                    <li><a href="#optionen">Optionen</a>
            		</li>

                    <li><a href="#decorator">Decorator</a>
            		</li>
                </ol>
            		</li>

                    <li><a href="#limitationen-und-andere-implementationen">Limitationen und andere Implementationen</a>
            		</li>
                </ol>
            </nav>
            </div>
          </toc-observer>
        </div>
      </li>
      
      <li>
        <button id="btn-theme-selection" title="Farbschema auswählen"></button>
      </li>
    </ul>
  </nav>
</header>

    <div class="glass"></div>
    <div class="bubble"></div>
    <div class="bubble-2"></div>
    <div class="main-wrapper post">
      <main>
        <div id="sentinel-element"></div>
        <header>
          <time class="article-date" datetime="2023-12-08">
            08. Dez. 2023
          </time>
          <h1>Custom Events mit @eventEmitter</h1>
          <ul class="post-tags">
            
              
              <li>
                
  
      <a href="/tags/decorator/" class="post-tag">#Decorator</a>
  

              </li>
            
              
              <li>
                
  
      <a href="/tags/typescript/" class="post-tag">#TypeScript</a>
  

              </li>
            
              
              <li>
                
  
      <a href="/tags/web-components/" class="post-tag">#Web Components</a>
  

              </li>
            
              
              <li>
                
  
      <a href="/tags/upcoming/" class="post-tag upcoming">
        Upcoming <span aria-hidden="true">🔮</span>
      </a>

    

              </li>
            
          </ul>
        </header>

        <p>Events sind eine super Möglichkeit um zwischen verschiedenen (Web) Components<br>
zu kommunizieren und besonders geeignet, wenn man nicht so sehr an das DOM gebunden sein möchte oder keine Annahmen über dessen Aufbau treffen kann. Deswegen habe ich mir die Frage gestellt, wie man das Auslösen von Custom Events mit Hilfe von Standard Decorators etwas &quot;bequemer&quot; lösen kann und führe hier durch meinen Denkprozess. Kleiner Spoiler: man könnte das so machen, wie ich es umgesetzt habe, aber es geht auch noch besser. Übrigens unterstützen auch die meisten Frontend-Frameworks native DOM-Events.</p>
<details>
   <summary>Gut zu wissen: Decorators</summary>
   <div class="details-content">
    <p>
      Decorators ermöglichen es, das Verhalten von Classes und deren Member zu ändern. Dazu zählen beispielsweise das Hinzufügen von Metadaten, die Erweiterung von Funktionalität oder die Validierung von Daten.
    </p>
    <p>
      Es ist wichtig zu beachten, dass hier Standard Decorators gemeint sind, die derzeit als <a href="https://github.com/tc39/proposal-decorators" target="_blank" rel="noopener noreferrer">Stage 3 Proposal</a> existieren. (Legacy) Decorators können bereits seit längerem genutzt werden und entsprechen einem vorherigen Entwurf. Obwohl Standard Decorators derzeit von keinem Browser unterstützt werden, können sie bereits mit Compilern wie TypeScript (>= 5.x.x) oder Babel genutzt werden.
    </p>
   </div>
</details>
<section>
<h2 id="motivation"><a class="header-anchor" href="#motivation">Motivation</a></h2>
<p>In meiner <a href="/blog/image-comparison-component/#custom-events">Image Comparison Component</a> nutze ich Custom Events, um zu kommunizieren, dass der Slider abschließend bewegt wurde oder das auf andere Weise mit der Component interagiert wird. Das kann man unter anderem so umsetzen:</p>
<pre class="language-ts"><code class="language-ts"><span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">DragEvent</span> <span class="token keyword">extends</span> <span class="token class-name">Event</span> <span class="token punctuation">{</span><br>  <span class="token keyword">static</span> <span class="token keyword">readonly</span> eventName <span class="token operator">=</span> <span class="token string">'drag-event'</span> <span class="token keyword">as</span> <span class="token keyword">const</span><span class="token punctuation">;</span><br><br>  targetElement<span class="token operator">:</span> HTMLElement<span class="token punctuation">;</span><br><br>  <span class="token function">constructor</span><span class="token punctuation">(</span>targetElement<span class="token operator">:</span> HTMLElement<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">super</span><span class="token punctuation">(</span>DragEvent<span class="token punctuation">.</span>eventName<span class="token punctuation">,</span> <span class="token punctuation">{</span><br>      bubbles<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span><br>      cancelable<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span><br>      composed<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span><br>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    <span class="token keyword">this</span><span class="token punctuation">.</span>targetElement <span class="token operator">=</span> targetElement<span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre>
<p>Die Optionen sollte man dann natürlich anpassen. Nutzen lässt es sich das Custom Event dann, in dem man <code>dispatchEvent</code> auf einem <a href="https://developer.mozilla.org/en-US/docs/Web/API/EventTarget/dispatchEvent" target="_blank" rel="noopener noreferrer">Element</a> ausführt, welches Events empfangen kann:</p>
<pre class="language-ts"><code class="language-ts"><span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">ImageComparison</span> <span class="token keyword">extends</span> <span class="token class-name">LitElement</span> <span class="token punctuation">{</span><br>  <span class="token comment">// (...)</span><br>  <span class="token keyword">private</span> slideEndHandler <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>    <span class="token comment">// (...)</span><br>    window<span class="token punctuation">.</span><span class="token function">dispatchEvent</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">DragEvent</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre>
<p>Die Stelle des Auslösen ist später nochmal wichtig <span aria-hidden="true">👀</span>.</p>
</section>
<section>
<h2 id="anwendungsbeispiel"><a class="header-anchor" href="#anwendungsbeispiel">Anwendungsbeispiel</a></h2>
<p>Weil ich mich noch mehr mit Standard Decorators befassen wollte, habe mich dann dazu entschieden einen <code>ClassMethod</code>-Decorator als Basis meiner Entwicklung umzusetzen was am Ende angewandt so aussehen kann:</p>
<pre class="language-ts"><code class="language-ts"><span class="token keyword">import</span> <span class="token punctuation">{</span> eventEmitter <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./event-emitter.js'</span><span class="token punctuation">;</span><br><br><span class="token keyword">class</span> <span class="token class-name">EmitterElement</span> <span class="token keyword">extends</span> <span class="token class-name">HTMLElement</span> <span class="token punctuation">{</span><br>  #counter<span class="token operator">:</span> <span class="token builtin">number</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><br><br>  <span class="token decorator"><span class="token at operator">@</span><span class="token function">eventEmitter</span></span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">'counter-event'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><br>  <span class="token function">increase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">number</span> <span class="token punctuation">{</span><br>    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>#counter <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span></code></pre>
<p>Dieser Decorator wird dann jeweils direkt an der Class Method angefügt und löst gleichzeitig mit der Ausführung der Method ein Event aus. Über verschiedene Optionen lässt sich <code>@eventEmitter</code> dann weiter konfigurieren. Mir ging es in diesem Projekt vor allem darum, noch mehr zu Standard Decorators zu lernen. Da bietet es sich natürlich an, etwas zu versuchen zu lösen, was man öfter benötigt. Bis auf die Types ist das übrigens, so bald Decorators im Browser unterstützt werden, standardkonformes JavaScript.</p>
</section>
<section>
<h2 id="implementation"><a class="header-anchor" href="#implementation">Implementation</a></h2>
<p>Meine Implementation teile ich in <a href="#optionen">Optionen</a> und die <a href="#decorator">Kernfunktionalität</a> des Decorators ein. Am Ende zeige ich noch auf, wie man den Decorator nutzen kann und im anschließenden Abschnitt worauf noch zu achten ist und welche alternativen Implementationen es gibt.</p>
<section>
<h3 id="optionen"><a class="header-anchor" href="#optionen">Optionen</a></h3>
<p>Um für die Optionen etwas flexibler als im <code>DragEvent</code>-Beispiel gezeigt zu bleiben, erweitere ich das<br>
<code>CustomEventInit</code> Interface mit zwei weiteren Properties: <code>name</code> und <code>emitter</code>:</p>
<pre class="language-ts"><code class="language-ts"><span class="token comment">/**<br> * EmitterConfig includes not only a name for your custom event<br> * but also all other properties one would like to set such as:<br> * detail, bubbles and so on.<br> */</span><br><span class="token keyword">interface</span> <span class="token class-name">EmitterConfig</span> <span class="token keyword">extends</span> <span class="token class-name">CustomEventInit</span> <span class="token punctuation">{</span><br>  <span class="token comment">/**<br>   * The event name you can listen to<br>   */</span><br>  name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span><br>  <span class="token comment">/**<br>   * The emitter for your events,<br>   * by default the class instance (this)<br>   */</span><br>  emitter<span class="token operator">?</span><span class="token operator">:</span> Window <span class="token operator">|</span> Document<span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre>
<p>Alle bisherigen Properties aus dem <code>CustomEventInit</code> Interface (zum Beispiel <code>bubbles</code>) lassen sich so weiter wie gewohnt nutzen. <code>name</code> ist dabei in jedem Fall anzugeben. Der Grund dafür ist, dass ich zuerst den Namen des Custom Events von der Class Method ableiten wollte und das aber zu folgendem Problem führt. Nämlich dann, wenn ein Minifier den Namen der Class Method verändert, also aus <code>increase()</code> ein <code>i()</code> kürzt. Niemand könnte dann wissen, auf welches Event zu hören ist und mit einer Pflicht-Property wie dieser ist es dann deutlich impliziter. <code>emitter</code> ist optional aber fällt standardmäßig auf die Instanz der Klasse zurück.</p>
</section>
<section>
<h3 id="decorator"><a class="header-anchor" href="#decorator">Decorator</a></h3>
<p>Der Decorator sieht auf dem ersten, und auch auf den zweiten und dritten, Blick erst mal kompliziert aus:</p>
<pre class="language-ts"><code class="language-ts"><span class="token comment">// A: Signature</span><br><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">eventEmitter</span><span class="token punctuation">(</span>config<span class="token operator">:</span> EmitterConfig<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token comment">// B: Returning a wrapped method</span><br>  <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token operator">&lt;</span>This <span class="token keyword">extends</span> <span class="token class-name">EventTarget</span><span class="token punctuation">,</span> Args <span class="token keyword">extends</span> <span class="token class-name"><span class="token builtin">any</span></span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> Return<span class="token operator">></span><span class="token punctuation">(</span><br>    <span class="token function-variable function">target</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token operator">:</span> This<span class="token punctuation">,</span> <span class="token operator">...</span>args<span class="token operator">:</span> Args<span class="token punctuation">)</span> <span class="token operator">=></span> Return<span class="token punctuation">,</span><br>    _context<span class="token operator">:</span> ClassMethodDecoratorContext<span class="token operator">&lt;</span><br>      This<span class="token punctuation">,</span><br>      <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token operator">:</span> This<span class="token punctuation">,</span> <span class="token operator">...</span>args<span class="token operator">:</span> Args<span class="token punctuation">)</span> <span class="token operator">=></span> Return<br>    <span class="token operator">></span><br>  <span class="token punctuation">)</span><br>  <span class="token comment">// C: Extracting options (...)</span><br><br>  <span class="token comment">// D: Wrapping the initial method</span><br>  <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token operator">:</span> This<span class="token punctuation">,</span> <span class="token operator">...</span>args<span class="token operator">:</span> Args<span class="token punctuation">)</span><span class="token operator">:</span> Return <span class="token punctuation">{</span><span class="token punctuation">}</span><br>  <span class="token punctuation">}</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre>
<p>In den Abschnitten <code>A</code> und <code>B</code> wird eine bestehende Class Method genommen, vom Decorator umschlossen, mit zusätzlicher Logik ergänzt und schließlich mit diesem ersetzt. Das Typing in der Form ist notwendig, wobei ich <code>_context</code> nicht weiter nutze. Dadurch dass ich <code>EventTarget</code> erweitere, kann ich später im <code>emitter</code> einfacher auf einen Default zurückfallen.</p>
<p>Das extrahieren der Optionen im Abschnitt <code>C</code> ist nicht weiter spannend, aber ich habe einen Laufzeit Check hinzugefügt damit man auch in einem JavaScript Kontext Fehler angezeigt bekommt, wenn man sein Custom Event nicht benennt:</p>
<pre class="language-ts"><code class="language-ts"><span class="token comment">/**<br> * Throw an error if no config or no name has been set.<br> */</span><br><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>config<span class="token operator">?.</span>name<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><br>    <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">The "name"-property in the config is mandatory. It is used to name your custom event.</span><span class="token template-punctuation string">`</span></span><br>  <span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><span class="token comment">/**<br> * Extracts the event name from the provided config.<br> */</span><br><span class="token keyword">const</span> <span class="token punctuation">{</span> name <span class="token punctuation">}</span> <span class="token operator">=</span> config<span class="token punctuation">;</span></code></pre>
<p>Abschnitt D bringt dann den Rest zusammen und übernimmt die eigentliche Logik:</p>
<pre class="language-ts"><code class="language-ts"><span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token operator">:</span> This<span class="token punctuation">,</span> <span class="token operator">...</span>args<span class="token operator">:</span> Args<span class="token punctuation">)</span><span class="token operator">:</span> Return <span class="token punctuation">{</span><br>  <span class="token comment">/**<br>   * The method's return value<br>   */</span><br>  <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token function">target</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token operator">...</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token comment">/**<br>   * 'detail' is by default what is set with the config and if not<br>   * the method's return value<br>   */</span><br>  <span class="token keyword">const</span> detail <span class="token operator">=</span> config<span class="token punctuation">.</span>detail <span class="token operator">??</span> result<span class="token punctuation">;</span><br>  <span class="token comment">/**<br>   * The emitter which dispatches the event<br>   */</span><br>  <span class="token keyword">const</span> emitter <span class="token operator">=</span> config<span class="token punctuation">.</span>emitter <span class="token operator">??</span> <span class="token keyword">this</span><span class="token punctuation">;</span><br><br>  emitter<span class="token punctuation">.</span><span class="token function">dispatchEvent</span><span class="token punctuation">(</span><br>    <span class="token keyword">new</span> <span class="token class-name">CustomEvent</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> <span class="token punctuation">{</span> detail<span class="token punctuation">,</span> <span class="token operator">...</span>config <span class="token punctuation">}</span><span class="token punctuation">)</span><br>  <span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token keyword">return</span> result<span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre>
<p>Interessant finde ich hier vor allem die Zuweisung von <code>detail</code> und <code>emitter</code>. Das macht es schon flexibler als in meiner ursprünglichen Lösung. Das ganze Typing und die Zeilen bis zu diesem Punkt sind so gesehen nur Setup für diese paar Zeilen:</p>
<pre class="language-ts"><code class="language-ts">emitter<span class="token punctuation">.</span><span class="token function">dispatchEvent</span><span class="token punctuation">(</span><br>  <span class="token keyword">new</span> <span class="token class-name">CustomEvent</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> <span class="token punctuation">{</span> detail<span class="token punctuation">,</span> <span class="token operator">...</span>config <span class="token punctuation">}</span><span class="token punctuation">)</span><br><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>Auf das Event im Counter Beispiel lässt sich dann beispielsweise so hören:</p>
<pre class="language-ts"><code class="language-ts">window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'counter-event'</span><span class="token punctuation">,</span> e <span class="token operator">=></span> <span class="token punctuation">{</span><br>  <span class="token keyword">const</span> <span class="token punctuation">{</span> detail <span class="token punctuation">}</span> <span class="token operator">=</span> e <span class="token keyword">as</span> CustomEvent<span class="token punctuation">;</span><br><br>  <span class="token keyword">this</span><span class="token punctuation">.</span>#counter <span class="token operator">=</span> detail<span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
</section>
</section>
<section>
<h2 id="limitationen-und-andere-implementationen"><a class="header-anchor" href="#limitationen-und-andere-implementationen">Limitationen und andere Implementationen</a></h2>
<p>Soweit so gut könnte man meinen, aber später ist mir dann ein entscheidender Nachteil aufgefallen: mein Decorator löst immer dann ein Event aus, wenn eine Methode mit diesem Decorator ausgeführt wird.</p>
<p>Dieser Decorator diente für mich vor allem dazu, noch mehr über Standard Decorators zu lernen und das wollte ich so unvoreingenommen wie möglich machen. Als ich dann an einem ersten brauchbaren Stand angekommen bin, habe ich nach weiteren Implementationen gesucht und bin auf die der <a href="https://stenciljs.com/docs/events" target="_blank" rel="noopener noreferrer">Stencil-Bibliothek</a> gestoßen. <a href="https://stenciljs.com/" target="_blank" rel="noopener noreferrer">Stencil</a> ermöglicht es, ähnlich wie mit <a href="https://lit.dev/" target="_blank" rel="noopener noreferrer">Lit</a> Web Components erstellen zu können. Genutzt wird es beispielsweise vom Cross-Plattform Framework <a href="https://ionicframework.com/" target="_blank" rel="noopener noreferrer">Ionic</a> oder dem Design System der <a href="https://github.com/db-ui/elements" target="_blank" rel="noopener noreferrer">Deutschen Bahn</a>. Die Implementation von Stencil sieht grob so aus:</p>
<pre class="language-ts"><code class="language-ts"><span class="token keyword">import</span> <span class="token punctuation">{</span> Event<span class="token punctuation">,</span> EventEmitter <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@stencil/core'</span><span class="token punctuation">;</span><br><br><span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">TodoList</span> <span class="token punctuation">{</span><br>  <span class="token comment">// Event called 'todoCompleted' that is "composed", "cancellable" and it will bubble up!</span><br>  <span class="token decorator"><span class="token at operator">@</span><span class="token function">Event</span></span><span class="token punctuation">(</span><span class="token punctuation">{</span><br>    eventName<span class="token operator">:</span> <span class="token string">'todoCompleted'</span><span class="token punctuation">,</span><br>    composed<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span><br>    cancelable<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span><br>    bubbles<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span><br>  <span class="token punctuation">}</span><span class="token punctuation">)</span> todoCompleted<span class="token operator">:</span> EventEmitter<span class="token operator">&lt;</span>Todo<span class="token operator">></span><span class="token punctuation">;</span><br><br>  <span class="token function">todoCompletedHandler</span><span class="token punctuation">(</span>todo<span class="token operator">:</span> Todo<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">const</span> event <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>todoCompleted<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span>todo<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>event<span class="token punctuation">.</span>defaultPrevented<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>      <span class="token comment">// if not prevented, do some default handling code</span><br>    <span class="token punctuation">}</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre>
<p>Zu den (groben) Unterschieden: zum einen wird hier keine Methode sondern ein Class field dekoriert und zum anderen kann der Type des Emitters mit einem Generic noch genauer gesetzt werden: <code>EventEmitter&lt;Todo&gt;</code>. Letztlich lässt sich dann, an einem beliebigen Punkt in der der eigenen Methode, die <code>emit</code>-Methode des Decorators aufrufen:<br>
<code>this.todoCompleted.emit(todo)</code>. Das hat, finde ich, den entscheidenden Vorteil, dass man noch mehr Logik oder Bedingungen einführen kann bevor das Event ausgelöst wird. Schön zu sehen ist aber auch, dass man auf ähnliche Lösungen wie etablierte Bibliotheken kommt <span aria-hidden="true">😅</span>. Neben dem <code>Event</code>-Decorator bietet Stencil außerdem noch einen <code>Listen</code>-Decorator um Events verarbeiten zu können. Ein nächster Schritt für mein Projekt könnte sein, es alternativ mit einem <code>ClassField</code>-Decorator zu versuchen und dann noch mehr Möglichkeiten zur Typisierung zu bieten. Einen Link zum GitHub Repository gibt es <a href="https://github.com/TonySpegel/event-emitter" target="_blank" rel="noopener noreferrer">hier</a> - über Feedback freue ich mich natürlich auch.</p>
</section>

      </main>

      
        <aside>
          <toc-observer observeParent>
            <div slot="toc">
              <nav class="toc">
                <ol>
                    
                    <li><a href="#motivation">Motivation</a>
            		</li>

                    <li><a href="#anwendungsbeispiel">Anwendungsbeispiel</a>
            		</li>

                    <li><a href="#implementation">Implementation</a>
            
                <ol>
                    
                    <li><a href="#optionen">Optionen</a>
            		</li>

                    <li><a href="#decorator">Decorator</a>
            		</li>
                </ol>
            		</li>

                    <li><a href="#limitationen-und-andere-implementationen">Limitationen und andere Implementationen</a>
            		</li>
                </ol>
            </nav>
            </div>
          </toc-observer>
        </aside>
      
    </div>

    
  
  <script>
    if ('serviceWorker' in navigator) {
      navigator
        .serviceWorker
        .register('/sw.js');
    }
  </script>


    <footer>
  <span id="copyright">
    © Tony Spegel
    2023
  </span>
  <ul class="footer-links">
    
      <li>
        <a href="/impressum/">Impressum</a>
      </li>
    
      <li>
        <a href="/datenschutzerklaerung/">Datenschutzerklärung</a>
      </li>
    
      <li>
        <a href="/barrierefreiheit/">Barrierefreiheit</a>
      </li>
    
  </ul>
</footer>

  </body>
</html>
