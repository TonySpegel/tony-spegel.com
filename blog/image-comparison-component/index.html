<!DOCTYPE html>

<!doctype html>
<html lang="de">
  
  <head>
  
  <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Image Comparison Component</title>
<meta name="description" content="Bilder vergleichen: Slider, Overlay, Side-by-Side">
<meta name="generator" content="Eleventy v2.0.1">
<meta name="theme-color" content="hsla(281, 56%, 84%, 1)" media="(prefers-color-scheme: light)">

<meta property="og:title" content="Image Comparison Component">
<meta property="og:description" content="Bilder vergleichen: Slider, Overlay, Side-by-Side">

  <meta property="og:image" content="https://tony-spegel.com/img/2023/image-comparison/2022_1004_14254000.jpg">



  <link rel="stylesheet" href="/css/index.css">
  <link rel="stylesheet" href="/css/blog-post.css">
  <link rel="stylesheet" href="/css/components/toc-observer.css">
  <link rel="stylesheet" href="/css/components/theme-switch.css">
  <link rel="stylesheet" href="/css/components/image-comparison.css">
  <link rel="stylesheet" href="/css/prism-a11y-rework.css">

  <script>
  // Read theme preference from localStorage
  const themePreference = localStorage.getItem('theme-preference');
  // Set theme if one is present in localStorage
  if (themePreference !== null) {
    document
      .querySelector('html')
      .setAttribute('theme-preference', themePreference);
  }
</script>


  
    
    <script type="module" src="/js/theme-switch.js"></script>
  
    
    <script type="module" src="/js/index.js"></script>
  
    
    <script type="module" src="/js/post.js"></script>
  
    
    <script type="module" src="/js/image-comparison.js"></script>
  
  <link rel="icon" href="/favicon.svg">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@48,400,0,0" >
</head>

  <body>
    
<theme-switch>
  <h2 slot="heading">Theme Auswahl</h2>
  <span slot="sub-heading">W√§hle ein Theme f√ºr die Website</span>
  <a href="datenschutzerklaerung/#auswertung-des-verhaltens-von-besucherinnen-und-besuchern-cookies"
    id="read-more"
    slot="read-more"
    target="_blank"
    title="Was wird gespeichert?"
  >
    ?
  </a>
  <span slot="close-caption">Schlie√üen</span>
</theme-switch>

    <header id="site-header">
  <nav aria-label="Hauptnavigation">
    
      <a class="logo" href="/" title="Zur Startseite">
        <img src="/tsp_icon.svg" alt="Tony Spegel Logo">
      </a>
    

    <ul class="header-links">
      
      <li class="dropdown">
        <button type="button"id="dropdown__title">
          Inhalt
          <span class="material-symbols-outlined">toc</span>
        </button>

        <div class="dropdown__toc" id="drop-down-container">
          <toc-observer observeParent>
            <div slot="toc">
              <nav class="toc">
                <ol>
                    
                    <li><a href="#slider">Slider</a>
            
                <ol>
                    
                    <li><a href="#html-and-css">HTML & CSS</a>
            		</li>

                    <li><a href="#entwicklung-der-slider-funktion">Entwicklung der Slider-Funktion</a>
            		</li>

                    <li><a href="#barrierefreiheit-des-sliders">Barrierefreiheit des Sliders</a>
            		</li>

                    <li><a href="#housekeeping-mit-lifecycle-callbacks">Housekeeping üßΩ mit Lifecycle-Callbacks</a>
            		</li>
                </ol>
            		</li>

                    <li><a href="#overlay">Overlay</a>
            		</li>

                    <li><a href="#split">Split</a>
            		</li>

                    <li><a href="#custom-events">Custom Events</a>
            		</li>

                    <li><a href="#internationalisierung">Internationalisierung</a>
            		</li>

                    <li><a href="#drei-components-in-einer">Drei Components in einer</a>
            		</li>

                    <li><a href="#integration-auf-websites-und-in-frameworks">Integration auf Websites und in Frameworks</a>
            		</li>

                    <li><a href="#fazit">Fazit</a>
            		</li>
                </ol>
            </nav>
            </div>
          </toc-observer>
        </div>
      </li>
      
      <li>
        <button id="btn-theme-selection" title="Farbschema ausw√§hlen"></button>
      </li>
    </ul>
  </nav>
</header>

    <div class="glass"></div>
    <div class="bubble"></div>
    <div class="bubble-2"></div>
    <div class="main-wrapper post">
      <main>
        <div id="sentinel-element"></div>
        <header>
          <time class="article-date" datetime="2023-04-14">
            14.04.2023
          </time>
          <h1>Image Comparison Component</h1>
          <ul class="post-tags">
            
              
              <li>
                
  <a href="/tags/lit/" class="post-tag lit">
    #Lit
    
      <span></span>
    
  </a>

              </li>
            
              
              <li>
                
  <a href="/tags/web-components/" class="post-tag ">
    #Web Components
    
  </a>

              </li>
            
              
              <li>
                
  <a href="/tags/a11y/" class="post-tag ">
    #a11y
    
  </a>

              </li>
            
              
              <li>
                
  <a href="/tags/typescript/" class="post-tag ">
    #TypeScript
    
  </a>

              </li>
            
          </ul>
        </header>

        <p>In diesem Post geht es darum, eine Component zu entwickeln, welche es erm√∂glicht, Bilder auf verschiedene Arten zu vergleichen. Bilder k√∂nnen mit einem Slider, einem Overlay oder in einer Split-Ansicht verglichen werden.</p>
<image-comparison variant="slider" sliderPrompt="Slider bewegen, um zu vergleichen" overlayPrompt="Tippen und gedr√ºckt halten, um zu vergleichen" class="post-img" id="image-comparison-demo">
  <label slot="label-before">Ohne Filter</label>
  <label slot="label-after">Graustufen</label>
  <img slot="image-before" src="/img/2023/image-comparison/2022_1004_14254000-w3120--opt.jpg" width="440" alt="Blumen in Paris" >
  <img slot="image-after" src="/img/2023/image-comparison/2022_1004_14254000-w3120_grayscale--opt.jpg" width="440" alt="Blumen in Paris dargestellt in Graustufen" >
</image-comparison>
<div class="slider-set-wrapper">
  <fieldset id="slider-variant-set" class="slider-set">
    <legend>Variante</legend>
    <div>
      <input type="radio" id="slider-variant" name="variant" value="slider" checked>
      <label for="slider-variant">Slider</label>
    </div>
    <div>
      <input type="radio" id="overlay-variant" name="variant" value="overlay">
      <label for="overlay-variant">Overlay</label>
    </div>
    <div>
      <input type="radio" id="split-variant" name="variant" value="split">
      <label for="split-variant">Split</label>
    </div>
  </fieldset>
  
</div>
<p><code>&lt;image-comparison&gt;</code> unterst√ºtzt neben diesen Varianten diverse Tastaturk√ºrzel, verschiedene Leserichtungen, Custom Events und ist durch Slots, Attribute und CSS Custom Properties konfigurierbar. Im Folgenden gehe ich auf diese Aspekte ein und beginne mit dem Slider.</p>
<p><a href="https://github.com/TonySpegel/image-comparison" target="_blank" rel="noopener noreferrer">GitHub</a>, <a href="https://npmjs.com/package/image-comparison-component" target="_blank" rel="noopener noreferrer">NPM</a>, <a href="https://lit.dev/playground/#gist=2b393dfba73ce32f7b3426492142b926" target="_blank" rel="noopener noreferrer">Lit Playground</a></p>
<hr>
<div class="disclaimer">
  <span>Hinweis</span>
  <p>
    Dieser Post geht davon aus, dass ihr euch schon ein wenig mit Web Components besch√§ftigt habt - wenn nicht, ist das aber auch in Ordnung.
    Hier ein paar Links:
  </p>
<ul>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/Web_Components" target="_blank" rel="noopener noreferrer">MDN Web Docs: Web Components</a></li>
<li><a href="https://lit.dev/docs/" target="_blank" rel="noopener noreferrer">lit.dev: What is Lit?</a></li>
<li><a href="https://web.dev/learn/html/template/" target="_blank" rel="noopener noreferrer">Learn HTML!: Template, slot, and shadow</a></li>
</ul>
</div>
<section>
<h2 id="slider"><a class="header-anchor" href="#slider">Slider</a></h2>
<p>Die Slider-Variante ist die komplexeste der drei Varianten. Komplex vor allem durch die vielseitigen Interaktions- und Konfigurationsm√∂glichkeiten aber weniger durch das CSS.</p>
<section>
<h3 id="html-and-css"><a class="header-anchor" href="#html-and-css">HTML &amp; CSS</a></h3>
<p>Wenn man die Component nutzen m√∂chte, gilt folgendes HTML. Die Label sind zwar optional aber zumindest die <code>alt</code>-Attribute der Bilder sollten gesetzt werden:</p>
<pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>image-comparison</span><br>  <span class="token attr-name">variant</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>slider<span class="token punctuation">"</span></span><br>  <span class="token attr-name">sliderPrompt</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Move the slider to compare<span class="token punctuation">"</span></span><br>  <span class="token attr-name">overlayPrompt</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Tap and hold to compare<span class="token punctuation">"</span></span><br><span class="token punctuation">></span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span> <span class="token attr-name">slot</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>label-before<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>Ohne Filter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">></span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span> <span class="token attr-name">slot</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>label-after<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>Graustufen<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">></span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">slot</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>image-before<span class="token punctuation">"</span></span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/img/2023/before.jpg<span class="token punctuation">"</span></span> <span class="token attr-name">alt</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Rote Zierquitte<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">slot</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>image-after<span class="token punctuation">"</span></span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/img/2023/after.jpg<span class="token punctuation">"</span></span> <span class="token attr-name">alt</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Rote Zierquitte (Graustufen)<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>image-comparison</span><span class="token punctuation">></span></span></code></pre>
<p>Auff√§llig sind hierbei vor allem die drei gesetzten Attribute sowie die zwei Label und Bildelemente. Die <code>variant</code> bestimmt sowohl das Verhalten als auch das Aussehen der Component, die beiden Prompt-Attribute geben kurze Hinweise zur Interaktion. Die sogenannten <code>slot</code>-Attribute sind eine Eigenheit der Web Components und k√∂nnen als eine Art Schnittstelle gesehen werden. In dieser Component werden sie genutzt, um die zu vergleichenden Bilder sowie deren Label anzuzeigen. Intern folgt das HTML diesem vereinfachten Schema:</p>
<pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>image-container<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>slot</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>label-before<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>slot</span><span class="token punctuation">></span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>slot</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>label-after<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>slot</span><span class="token punctuation">></span></span><br><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>container-before<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>slot</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>image-before<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>slot</span><span class="token punctuation">></span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><br><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>container-after<span class="token punctuation">"</span></span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value css language-css"><span class="token property">clip-path</span><span class="token punctuation">:</span> <span class="token function">inset</span><span class="token punctuation">(</span>0 50% 0 0<span class="token punctuation">)</span></span><span class="token punctuation">"</span></span></span><span class="token punctuation">></span></span><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>slot</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>image-after<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>slot</span><span class="token punctuation">></span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><br><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value css language-css"><span class="token property">left</span><span class="token punctuation">:</span> 50%</span><span class="token punctuation">"</span></span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span></code></pre>
<p>Neben zus√§tzlichem Markup, wie dem Button, steckt der gr√∂√üte Teil der <span aria-hidden="true">‚ú®</span>Magie<span aria-hidden="true">‚ú®</span> in der <code>clip-path: inset(0 50% 0 0)</code>-Anweisung des zweiten Containers. Der umliegende Container an sich ist schnell erkl√§rt:</p>
<pre class="language-css"><code class="language-css"><span class="token selector">#image-container</span> <span class="token punctuation">{</span><br>  <span class="token property">display</span><span class="token punctuation">:</span> inline-grid<span class="token punctuation">;</span><br>  <span class="token property">grid-template-areas</span><span class="token punctuation">:</span> <span class="token string">"images"</span><span class="token punctuation">;</span><br>  <span class="token property">overflow</span><span class="token punctuation">:</span> hidden<span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre>
<p>Ich setze hier vor allem deswegen auf ein Grid-Layout, damit ich die verschiedenen Elemente einfach √ºbereinander stapeln kann. Dazu nutze ich <code>grid-template-areas: &quot;images&quot;</code> um mich in den √ºbrigen Elementen auf dieses beziehen zu k√∂nnen. <code>overflow: hidden</code> wird dann gesetzt, um den dann √ºberstehenden Divider des Buttons abzuschneiden.</p>
<pre class="language-css"><code class="language-css"><span class="token selector">#container-before, #container-after</span> <span class="token punctuation">{</span><br>  <span class="token property">grid-area</span><span class="token punctuation">:</span> images<span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br><span class="token selector">button</span> <span class="token punctuation">{</span><br>  <span class="token property">grid-area</span><span class="token punctuation">:</span> images<span class="token punctuation">;</span><br>  <span class="token property">align-self</span><span class="token punctuation">:</span> center<span class="token punctuation">;</span><br>  <span class="token property">position</span><span class="token punctuation">:</span> relative<span class="token punctuation">;</span><br><br>  <span class="token property">border</span><span class="token punctuation">:</span> <span class="token function">var</span><span class="token punctuation">(</span>--thumb-border-width<span class="token punctuation">)</span> solid <span class="token function">var</span><span class="token punctuation">(</span>--slider-color<span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token property">border-radius</span><span class="token punctuation">:</span> 50%<span class="token punctuation">;</span><br>  <span class="token property">width</span><span class="token punctuation">:</span> <span class="token function">var</span><span class="token punctuation">(</span>--thumb-size<span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token property">aspect-ratio</span><span class="token punctuation">:</span> 1<span class="token punctuation">;</span><br>  <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">translateX</span><span class="token punctuation">(</span>-50%<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token property">cursor</span><span class="token punctuation">:</span> col-resize<span class="token punctuation">;</span><br>  <span class="token property">background-color</span><span class="token punctuation">:</span> transparent<span class="token punctuation">;</span><br>  <span class="token property">z-index</span><span class="token punctuation">:</span> 3<span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br><span class="token selector">button:before, button:after</span> <span class="token punctuation">{</span><br>  <span class="token property">content</span><span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">;</span><br>  <span class="token property">width</span><span class="token punctuation">:</span> <span class="token function">var</span><span class="token punctuation">(</span>--thumb-bar-width<span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token property">left</span><span class="token punctuation">:</span> <span class="token function">calc</span><span class="token punctuation">(</span>50% - <span class="token function">calc</span><span class="token punctuation">(</span><span class="token function">var</span><span class="token punctuation">(</span>--thumb-bar-width<span class="token punctuation">)</span> / 2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token property">background-color</span><span class="token punctuation">:</span> <span class="token function">var</span><span class="token punctuation">(</span>--slider-color<span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token property">position</span><span class="token punctuation">:</span> absolute<span class="token punctuation">;</span><br>  <span class="token property">height</span><span class="token punctuation">:</span> 100vh<span class="token punctuation">;</span><br>  <span class="token property">z-index</span><span class="token punctuation">:</span> -1<span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br><span class="token selector">button:before</span> <span class="token punctuation">{</span><br>  <span class="token property">bottom</span><span class="token punctuation">:</span> <span class="token function">calc</span><span class="token punctuation">(</span>50% + <span class="token function">calc</span><span class="token punctuation">(</span><span class="token function">var</span><span class="token punctuation">(</span>--thumb-size<span class="token punctuation">)</span> / 2<span class="token punctuation">)</span> - <span class="token function">calc</span><span class="token punctuation">(</span><span class="token function">var</span><span class="token punctuation">(</span>--thumb-border-width<span class="token punctuation">)</span> / 2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br><span class="token selector">button:after</span> <span class="token punctuation">{</span><br>  <span class="token property">top</span><span class="token punctuation">:</span> <span class="token function">calc</span><span class="token punctuation">(</span><span class="token function">var</span><span class="token punctuation">(</span>--thumb-size<span class="token punctuation">)</span> - <span class="token function">var</span><span class="token punctuation">(</span>--thumb-border-width<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre>
<p>Wie am Anfang beschrieben, werden nun beide Container sowie der Button mit <code>grid-area: images</code> √ºbereinander gestapelt. Die Reihenfolge im Markup entscheidet dann dar√ºber, welches Element ganz oben liegt - hier ist es der Button. Dieser wird dann mit <code>align-self: center</code> vertikal zentriert und horizontal um die H√§lfte der eigenen Breite verschoben. Um dann schlie√ülich den Divider des Sliders zu erzeugen, positioniere ich einfach die Pseudo-Elemente <code>:before</code> und <code>:after</code> ober- und unterhalb des Buttons und nutze daf√ºr einige CSS Variablen. Auf diese Weise habe ich zwar einige Variablen aber das macht es f√ºr mich nachvollziehbarer und einfacher zu rechnen, was wie platziert wird.<br>
Au√üerdem ist es so f√ºr Dritte ebenso leichter weil klar ist, was angepasst werden kann. Das war es auf der CSS Seite des Sliders. Eine Demo zu diesem Stand k√∂nnt ihr auf <a href="https://codepen.io/TonySpegel/pen/oNabodW?editors=1100" target="_blank" rel="noopener noreferrer">Codepen</a> betrachten.</p>
</section>
<section>
<h3 id="entwicklung-der-slider-funktion"><a class="header-anchor" href="#entwicklung-der-slider-funktion">Entwicklung der Slider-Funktion</a></h3>
<p>Die wichtigste Information, welche der Slider ben√∂tigt, ist die Position des Dividers.</p>
<pre class="language-ts"><code class="language-ts"><span class="token keyword">class</span> <span class="token class-name">ImageComparison</span> <span class="token keyword">extends</span> <span class="token class-name">LitElement</span> <span class="token punctuation">{</span><br>  <span class="token decorator"><span class="token at operator">@</span><span class="token function">property</span></span><span class="token punctuation">(</span><span class="token punctuation">{</span> type<span class="token operator">:</span> Number<span class="token punctuation">,</span> reflect<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><br>  <span class="token keyword">public</span> sliderPosition<span class="token operator">:</span> <span class="token builtin">number</span> <span class="token operator">=</span> <span class="token number">50</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre>
<p>Lit nutzt an vielen Stellen so genannte Decorators, ein Pattern welches es einem erm√∂glicht, verschiedene Konstrukte mit zus√§tzlicher Funktionalit√§t zu erweitern. Dazu ein Zitat aus der offiziellen <a href="https://lit.dev/docs/components/properties/" target="_blank" rel="noopener noreferrer">Dokumentation</a>:</p>
<blockquote cite="https://lit.dev/docs/components/properties/">
"Lit components receive input and store their state as JavaScript class fields or properties. Reactive properties are properties that can trigger the reactive update cycle when changed, re-rendering the component, and optionally be read or written to attributes."
</blockquote>
<p>In diesem Decorator werden zwei <a href="https://lit.dev/docs/components/properties/#property-options" target="_blank" rel="noopener noreferrer">Optionen</a> genutzt. Zum einen <code>type</code>, diese gibt an auf welche Art ein Attribut intern konvertiert werden soll. Zum anderen sorgt <code>reflect</code> daf√ºr, dass der interne Wert auch wieder nach au√üen an das Attribut gegeben wird. Vereinfacht ausgedr√ºckt, erm√∂glicht das eine Synchronisation des √§u√üeren wie inneren Zustands.</p>
<pre class="language-ts"><code class="language-ts"><span class="token operator">&lt;</span>image<span class="token operator">-</span>comparison sliderposition<span class="token operator">=</span><span class="token string">"50"</span> variant<span class="token operator">=</span><span class="token string">"slider"</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>image<span class="token operator">-</span>comparison<span class="token operator">></span><br><span class="token comment">// ‚Üì‚Üë</span><br><span class="token decorator"><span class="token at operator">@</span><span class="token function">property</span></span><span class="token punctuation">(</span><span class="token punctuation">{</span> type<span class="token operator">:</span> Number<span class="token punctuation">,</span> reflect<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><br><span class="token keyword">public</span> sliderPosition<span class="token operator">:</span> <span class="token builtin">number</span> <span class="token operator">=</span> <span class="token number">50</span><span class="token punctuation">;</span></code></pre>
<p>Jetzt zur eigentlichen Funktionalit√§t, welche diesen Wert setzen wird. Lit setzt grunds√§tzlich auf einen deklarativen Ansatz, um dessen Templates zu beschreiben. Statt Schritt f√ºr Schritt anzugeben, wie sich ein Template ver√§ndert, gibt man in deklarativen Ans√§tzen vor, wie ein Template in dessen finalen Zustand auszusehen hat. Das bedeutet nicht, dass man nicht beide Ans√§tzen mischen kann.</p>
<p>Dazu folgt der grunds√§tzliche weitere Aufbau des Templates. Alles was im Template anzuzeigen ist, wird in der <code>render()</code>-Methode aufgerufen:</p>
<pre class="language-ts"><code class="language-ts"><span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">ImageComparison</span> <span class="token keyword">extends</span> <span class="token class-name">LitElement</span> <span class="token punctuation">{</span><br>  <span class="token decorator"><span class="token at operator">@</span><span class="token function">property</span></span><span class="token punctuation">(</span><span class="token punctuation">{</span> type<span class="token operator">:</span> Number<span class="token punctuation">,</span> reflect<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><br>  <span class="token keyword">public</span> sliderPosition<span class="token operator">:</span> <span class="token builtin">number</span> <span class="token operator">=</span> <span class="token number">50</span><span class="token punctuation">;</span><br><br>  <span class="token decorator"><span class="token at operator">@</span><span class="token function">state</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>  <span class="token keyword">private</span> isRtl<span class="token operator">:</span> <span class="token builtin">boolean</span> <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span><br><br>  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">return</span> html<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string"><br>      &lt;div id="image-container"><br>        &lt;slot name="label-before">&lt;/slot><br>        &lt;slot name="label-after">&lt;/slot><br><br>        &lt;div id="container-before"><br>          &lt;slot name="image-before">&lt;/slot><br>        &lt;/div><br><br>        &lt;div<br>          id="container-after"<br>          style=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>isRtl<br>            <span class="token operator">?</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">clip-path: inset(0 </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>sliderPosition<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">% 0 0)</span><span class="token template-punctuation string">`</span></span><br>            <span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">clip-path: inset(0 0 0 </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>sliderPosition<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">%)</span><span class="token template-punctuation string">`</span></span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"><br>        ><br>          &lt;slot name="image-after">&lt;/slot><br>        &lt;/div><br><br>        &lt;button<br>          @mousedown=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setSlidingState</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"><br>          @mousemove=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token punctuation">(</span>e<span class="token operator">:</span> MouseEvent<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">slideCompareHandler</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"><br>          style="</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">left: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><br>            <span class="token keyword">this</span><span class="token punctuation">.</span>isRtl <span class="token operator">?</span> <span class="token operator">-</span><span class="token keyword">this</span><span class="token punctuation">.</span>sliderPosition <span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>sliderPosition<br>          <span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">%</span><span class="token template-punctuation string">`</span></span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">"<br>        ><br>        &lt;/button><br>      &lt;/div><br>    </span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre>
<p>Hier nutze ich zwei neue Konzepte im Lit Kontext: die <a href="https://lit.dev/docs/components/events/#adding-event-listeners-in-the-element-template" target="_blank" rel="noopener noreferrer">@-Syntax</a> definiert JavaScript-typische EventListener, der <code>@state()</code>-Decorator einen ausschlie√ülich internen Zustand. Inbesondere <code>isRtl</code> wird sp√§ter wichtig sein, um eine so genannte <abbr>RTL</abbr> (Right-to-left) script Unterst√ºtzung, also Sprachen welche von Rechts nach Links gelesen werden, zu bieten. Hier hat das den einfachen Hintergrund, dass ich das Vorzeichen im <code>left</code>-Attribut √§ndern oder im <code>inset()</code> das Rechteck von der anderen Seite aus aufziehen kann.</p>
<p>Jetzt zu den eigentlichen Methoden, ich gehe dabei nur auf die wirklich wichtigen und etwas komplizierteren ein:</p>
<pre class="language-ts"><code class="language-ts"><span class="token keyword">private</span> slideCompareHandler <span class="token operator">=</span> <span class="token punctuation">(</span>event<span class="token operator">:</span> MouseEvent <span class="token operator">|</span> TouchEvent<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">slideCompare</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">;</span><br><br><span class="token comment">/**<br> * Converts 'cursor' position and updates the UI accordingly<br> */</span><br><span class="token keyword">private</span> slideCompare <span class="token operator">=</span> <span class="token punctuation">(</span>event<span class="token operator">:</span> MouseEvent <span class="token operator">|</span> TouchEvent<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>slidingActive<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">let</span> pos <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">convertCursorToSliderPosition</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    pos <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>isRtl <span class="token operator">?</span> <span class="token number">100</span> <span class="token operator">-</span> pos <span class="token operator">:</span> pos<span class="token punctuation">;</span><br><br>    <span class="token keyword">this</span><span class="token punctuation">.</span>sliderPosition <span class="token operator">=</span> pos<span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre>
<p>Wenn <code>slidingActive</code> wahr ist, wird die Cursor-Position relativ zur Container-Position konvertiert und abh√§ngig von der Leserichtung gesetzt.<br>
√úbrigens sieht man hier auch gut, dass nicht alles deklarativ sein kann und interne Werte nat√ºrlich auch imperativ gesetzt werden.</p>
<pre class="language-ts"><code class="language-ts"><span class="token keyword">const</span> clamp <span class="token operator">=</span> <span class="token punctuation">(</span>num<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span> min<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span> max<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">number</span> <span class="token operator">=></span><br>  Math<span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span>num<span class="token punctuation">,</span> min<span class="token punctuation">)</span><span class="token punctuation">,</span> max<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br><span class="token comment">/**<br> * The relative position of a cursor (as in: a touch or mouse device)<br> * is converted into a clamped slider position value<br> */</span><br><span class="token function">convertCursorToSliderPosition</span><span class="token punctuation">(</span>event<span class="token operator">:</span> TouchEvent <span class="token operator">|</span> MouseEvent<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">number</span> <span class="token punctuation">{</span><br>  <span class="token keyword">const</span> <span class="token punctuation">{</span> left<span class="token punctuation">,</span> width <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>imageContainer<span class="token punctuation">.</span><span class="token function">getBoundingClientRect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">const</span> <span class="token punctuation">{</span> scrollX <span class="token punctuation">}</span> <span class="token operator">=</span> window<span class="token punctuation">;</span><br><br>  <span class="token keyword">const</span> pageX <span class="token operator">=</span> event <span class="token keyword">instanceof</span> <span class="token class-name">MouseEvent</span> <span class="token operator">?</span><br>    event<span class="token punctuation">.</span>pageX <span class="token operator">:</span><br>    event<span class="token punctuation">.</span>changedTouches<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>pageX<span class="token punctuation">;</span><br><br>  <span class="token keyword">const</span> xOffset <span class="token operator">=</span> left <span class="token operator">+</span> scrollX<span class="token punctuation">;</span><br>  <span class="token keyword">const</span> x <span class="token operator">=</span> pageX <span class="token operator">-</span> xOffset<span class="token punctuation">;</span><br><br>  <span class="token keyword">const</span> sliderPostion <span class="token operator">=</span> <span class="token function">parseFloat</span><span class="token punctuation">(</span><br>    <span class="token function">clamp</span><span class="token punctuation">(</span><span class="token punctuation">(</span>x <span class="token operator">/</span> width<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toFixed</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><br>  <span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token keyword">return</span> sliderPostion<span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre>
<p>Abh√§ngig davon ob es sich beim ausgef√ºhrten Event um ein <code>Touch</code>- oder <code>Mouse</code>-Event handelt, stehen unterschiedliche Properties zur Verf√ºgung. In beiden F√§llen wird jedoch <code>getBoundingClientRect()</code> genutzt, um die Position und Breite des Containers zu ermitteln. Mit Hilfe dieser wird in Abh√§ngigkeit dann bestimmt, wo sich das Eingabeger√§t relativ zu diesem befindet, um am Ende diesen Wert in eine Zahl zwischen 0 und 100 zu konvertieren. Ich gebe zu, dass das etwas kompliziert und nicht einfach zu verstehen ist - aber damit werden diverse Eventualit√§ten abgedeckt die sonst zu einem Fehlverhalten f√ºhren w√ºrden.</p>
<p>Im Grunde genommen ist, dass die Funktionalit√§t die notwendig ist, um den Slider zu bewegen und Bilder vergleichen zu k√∂nnen. Das allein ist aber noch nicht ausreichend. Zum einen muss noch der Barrierefreiheit wegen (unter anderem) eine Tastatur Unterst√ºtzung und zum anderen etwas was ich Housekeeping nenne, implementiert werden.</p>
</section>
<section>
<h3 id="barrierefreiheit-des-sliders"><a class="header-anchor" href="#barrierefreiheit-des-sliders">Barrierefreiheit des Sliders</a></h3>
<p>Zur Barrierefreiheit des Sliders z√§hle ich, dass dieser nicht nur mit einer Maus, sondern m√∂glichst mit beliebigen Eingabeger√§ten genutzt werden kann und auch seinen internen Zustand nach au√üen an Screenreader zu kommunizieren wei√ü. Wenn es darum geht, m√∂glichst barrierefreie L√∂sungen zu entwickeln, ist die <a href="https://www.w3.org/WAI/ARIA/apg/patterns/" target="_blank" rel="noopener noreferrer">Patterns</a> Seite des W3C ein optimaler Einstieg. Diese bietet diverse, immer wiederkehrende, Patterns wie beispielsweise Tabs, Slide Shows und √§hnliches an und geht dabei auf deren Besonderheiten ein. Das <a href="https://www.w3.org/WAI/ARIA/apg/patterns/windowsplitter/" target="_blank" rel="noopener noreferrer">Window Splitter</a> Pattern passt hierbei am ehesten zur Slider-Variante.<br>
Um Tastatureingaben abzufangen, extrahiere ich aus dem <code>KeyboardEvent</code> zum einen die gedr√ºckten Tasten, zu denen vor allem die Cursortasten z√§hlen sowie <code>ctrlKey</code>, <code>metaKey</code> (<kbd>Win</kbd> / <kbd>‚åò</kbd>) und <code>shiftKey</code>, um diese in Kombination mit den Cursortasten zu nutzen.</p>
<pre class="language-ts"><code class="language-ts"><span class="token comment">/**<br> * Applied when shift is pressed with an arrow key (variant 'slider')<br> */</span><br><span class="token decorator"><span class="token at operator">@</span><span class="token function">property</span></span><span class="token punctuation">(</span><span class="token punctuation">{</span> type<span class="token operator">:</span> Number <span class="token punctuation">}</span><span class="token punctuation">)</span><br><span class="token keyword">private</span> sliderSteps<span class="token operator">:</span> <span class="token builtin">number</span> <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span><br><br><span class="token comment">/**<br> * Handle arrow, home &amp; end keys and use more steps when shift is pressed<br> */</span><br><span class="token keyword">private</span> keyboardSliderHandler <span class="token operator">=</span> <span class="token punctuation">(</span>event<span class="token operator">:</span> KeyboardEvent<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  <span class="token keyword">const</span> <span class="token punctuation">{</span> code<span class="token punctuation">,</span> ctrlKey<span class="token punctuation">,</span> key<span class="token punctuation">,</span> metaKey<span class="token punctuation">,</span> shiftKey<span class="token punctuation">}</span> <span class="token operator">=</span> event<span class="token punctuation">;</span><br>  <span class="token keyword">const</span> <span class="token punctuation">{</span> isRtl <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span><br>  <span class="token keyword">const</span> isLtr <span class="token operator">=</span> <span class="token operator">!</span>isRtl<span class="token punctuation">;</span><br>  <span class="token keyword">const</span> steps <span class="token operator">=</span> shiftKey <span class="token operator">?</span> <span class="token keyword">this</span><span class="token punctuation">.</span>sliderSteps <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">;</span><br><br>  <span class="token keyword">let</span> position <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>sliderPosition<span class="token punctuation">;</span><br><br>  <span class="token comment">// These keys would scroll the page when pressed</span><br>  <span class="token keyword">if</span> <span class="token punctuation">(</span>code <span class="token operator">===</span> <span class="token string">'Space'</span> <span class="token operator">||</span> key <span class="token operator">===</span> <span class="token string">'Home'</span> <span class="token operator">||</span> key <span class="token operator">===</span> <span class="token string">'End'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    event<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><br>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>key <span class="token operator">===</span> <span class="token string">'ArrowLeft'</span> <span class="token operator">&amp;&amp;</span> isLtr<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token punctuation">(</span>key <span class="token operator">===</span> <span class="token string">'ArrowRight'</span> <span class="token operator">&amp;&amp;</span> isRtl<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    event<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ‚Üê Firefox would highlight parts of the UI and labels w/o it</span><br>    position <span class="token operator">-=</span> steps<span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><br>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>key <span class="token operator">===</span> <span class="token string">'ArrowRight'</span> <span class="token operator">&amp;&amp;</span> isLtr<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token punctuation">(</span>key <span class="token operator">===</span> <span class="token string">'ArrowLeft'</span> <span class="token operator">&amp;&amp;</span> isRtl<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    event<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// same as above regarding Firefox</span><br>    position <span class="token operator">+=</span> steps<span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><br>  <span class="token comment">// Also often called 'Pos1' or '‚åò + ‚Üê' on MacOS</span><br>  <span class="token keyword">if</span> <span class="token punctuation">(</span>key <span class="token operator">===</span> <span class="token string">'Home'</span> <span class="token operator">||</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>metaKey <span class="token operator">||</span> ctrlKey<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> key <span class="token operator">===</span> <span class="token string">'ArrowLeft'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    position <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><br>  <span class="token comment">// End or '‚åò + ‚Üí' on MacOS</span><br>  <span class="token keyword">if</span> <span class="token punctuation">(</span>key <span class="token operator">===</span> <span class="token string">'End'</span> <span class="token operator">||</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>metaKey <span class="token operator">||</span> ctrlKey<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> key <span class="token operator">===</span> <span class="token string">'ArrowRight'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    position <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><br>  <span class="token comment">// Center thumb position</span><br>  <span class="token keyword">if</span> <span class="token punctuation">(</span>key <span class="token operator">===</span> <span class="token string">'Enter'</span><span class="token punctuation">)</span> position <span class="token operator">=</span> <span class="token number">50</span><span class="token punctuation">;</span><br><br>  <span class="token keyword">this</span><span class="token punctuation">.</span>sliderPosition <span class="token operator">=</span> <span class="token function">clamp</span><span class="token punctuation">(</span>position<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre>
<p>Eine weitere M√∂glichkeit den Slider zu bedienen, ist die direkte Eingabe, in dem man auf die gew√ºnschte Position tippt. Das kann Menschen helfen, welche motorisch nicht dauerhaft etwas gedr√ºckt halten und ziehen k√∂nnen und f√ºhlt sich meiner Meinung nach auch intuitiver an. Damit man ohne st√∂rendes Verhalten Bilder weiter √ºber das Kontextmen√º speichern kann, habe ich die Aktion auf die (in der Regel) linke und mittlere Maustaste beschr√§nkt. Au√üerdem l√§sst sich der Slider durch doppeltes klicken/tippen zentrieren.</p>
<pre class="language-ts"><code class="language-ts">html<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string"><br>  &lt;div<br>    @mousedown=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token punctuation">(</span>e<span class="token operator">:</span> MouseEvent<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>      <span class="token keyword">const</span> <span class="token punctuation">{</span> button <span class="token punctuation">}</span> <span class="token operator">=</span> e<span class="token punctuation">;</span><br>      <span class="token comment">// The left or the wheel/middle button</span><br>      <span class="token keyword">if</span> <span class="token punctuation">(</span><br>        button <span class="token operator">===</span> MouseActions<span class="token punctuation">.</span>Main <span class="token operator">||</span><br>        button <span class="token operator">===</span> MouseActions<span class="token punctuation">.</span>Auxiliary<br>      <span class="token punctuation">)</span> <span class="token punctuation">{</span><br>        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setSlidingState</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">slideCompareHandler</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span><br>      <span class="token punctuation">}</span><br>    <span class="token punctuation">}</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"><br>    id="image-container"<br>  ><br>    &lt;button @dblclick=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span> <span class="token keyword">this</span><span class="token punctuation">.</span>sliderPosition <span class="token operator">=</span> <span class="token number">50</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">>&lt;/button><br>  &lt;/div><br></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span></code></pre>
<p>Jetzt bleibt noch die Kommunikation mit Screenreadern √ºbrig, um hier eine gute Integration zu erm√∂glichen, nutze ich ich diverse <a href="https://www.w3.org/WAI/ARIA/apg/patterns/windowsplitter/#:~:text=the%20arrow%20keys.-,WAI%2DARIA%20Roles%2C%20States%2C%20and%20Properties,-The%20element%20that" target="_blank" rel="noopener noreferrer">WAI-ARIA Roles</a> wie aus dem W3C Pattern zu entnehmen ist. Diese kommunizieren vor allem die minimale, maximale und aktuellen Position des Sliders.</p>
</section>
<section>
<h3 id="housekeeping-mit-lifecycle-callbacks"><a class="header-anchor" href="#housekeeping-mit-lifecycle-callbacks">Housekeeping üßΩ mit Lifecycle-Callbacks</a></h3>
<p>Im einem vorherigen Abschnitt bin ich darauf eingegangen, dass die <a href="https://lit.dev/docs/components/events/#adding-event-listeners-in-the-element-template" target="_blank" rel="noopener noreferrer">@-Syntax</a> es erm√∂glicht, EventListener hinzuzuf√ºgen. EventListener werden √ºblicherweise entfernt, wenn eine Component aus dem DOM entfernt wird. Das gilt aber nur f√ºr solche Events, die direkt an ein Element gebunden sind, also beispielsweise ein Click-Event an einem Button. Globale EventListener, also solche, die die Tastatur oder Mauseingaben verarbeiten und auch au√üerhalb einer Component verf√ºgbar sein m√ºssen, sind davon ausgenommen.</p>
<p>Das ist an sich aber nicht weiter tragisch, denn Web Components unterst√ºtzen so genannte Lifecycles. Das sind Callbacks die zu unterschiedlichen Zeitpunkten ausgel√∂st werden so dass hier genau solche Arbeiten durchgef√ºhrt werden k√∂nnen. <code>connectedCallback</code> ist hierbei genau der richtige Zeitpunkt, denn die Component wurde zum DOM hinzugef√ºgt.</p>
<pre class="language-ts"><code class="language-ts"><span class="token comment">/**<br> * Component is added to the document's DOM,<br> * add EventListeners for variant 'slider'.<br> */</span><br>override <span class="token function">connectedCallback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{</span><br>  <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">connectedCallback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">addSliderEventListener</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br><span class="token comment">/**<br> * Slider EventListener are added when 'variant' is set to 'slider'<br> */</span><br><span class="token keyword">private</span> <span class="token function">addSliderEventListener</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{</span><br>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>variant <span class="token operator">===</span> <span class="token string">'slider'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token comment">// Moving the slider</span><br>    window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'mousemove'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>slideCompareHandler<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'touchmove'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>slideCompareHandler<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token comment">// Stop moving the slider</span><br>    window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'mouseup'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>slideEndHandler<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'touchend'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>slideEndHandler<span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre>
<p>√Ñquivalent dazu m√ºssen die EventListener dann sp√§testens entfernt werden, wenn die Component nicht mehr im DOM ist:</p>
<pre class="language-ts"><code class="language-ts"><span class="token comment">/**<br> * Clean up EventListeners<br> */</span><br>override <span class="token function">disconnectedCallback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{</span><br>  <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">disconnectedCallback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">removeSliderEventListener</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre>
<p>Da meine Component mehrere Varianten √ºber das dazu passende Attribut unterst√ºtzt, muss auch das bedacht werden:</p>
<pre class="language-ts"><code class="language-ts"><span class="token comment">/**<br> * Because slider EventListeners are only added when the<br> * 'variant' attribute is set to 'slider', you also have to react to its changes<br> */</span><br>override <span class="token function">attributeChangedCallback</span><span class="token punctuation">(</span><br>  name<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">=</span> <span class="token string">'variant'</span><span class="token punctuation">,</span><br>  oldVal<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">|</span> <span class="token keyword">null</span><span class="token punctuation">,</span><br>  newVal<span class="token operator">:</span> Variants<br><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">attributeChangedCallback</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> oldVal<span class="token punctuation">,</span> newVal<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token keyword">if</span> <span class="token punctuation">(</span>name <span class="token operator">===</span> <span class="token string">'variant'</span> <span class="token operator">&amp;&amp;</span> newVal <span class="token operator">!==</span> oldVal <span class="token operator">&amp;&amp;</span> newVal <span class="token operator">===</span> <span class="token string">'slider'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">addSliderEventListener</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><br>  <span class="token keyword">if</span> <span class="token punctuation">(</span>name <span class="token operator">===</span> <span class="token string">'variant'</span> <span class="token operator">&amp;&amp;</span> newVal <span class="token operator">!==</span> oldVal <span class="token operator">&amp;&amp;</span> newVal <span class="token operator">===</span> <span class="token string">'overlay'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">removeSliderEventListener</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre>
<p>Damit stelle ich sicher, dass EventListener nur dann hinzugef√ºgt bzw. entfernt werden, wenn es auch wirklich notwendig ist.</p>
</section>
</section>
<section>
<h2 id="overlay"><a class="header-anchor" href="#overlay">Overlay</a></h2>
<p>Die Overlay Variante ist deutlich kompakter und arbeitet im Grunde genommen aber auch hier wieder mit einem praktischen Trick, den ich mir durch das Stapeln des Grid-Layouts zu nutzen mache.</p>
<image-comparison variant="overlay" overlayPrompt="Tippen und gedr√ºckt halten, um zu vergleichen" id="kasimir-overlay" class="post-img">
  <label slot="label-before">Ohne Filter</label>
  <label slot="label-after">Graustufen</label>
  <img slot="image-before" src="/img/2023/image-comparison/kasimir--opt.jpg" width="440" alt="Tabby Katze" >
  <img slot="image-after" src="/img/2023/image-comparison/kasimir_filter--opt.jpg" width="440" alt="Tabby Katze in Graustufen" >
</image-comparison>
<p>Immer dann, wenn mit einem Eingabeger√§t auf das Bild gedr√ºckt und gehalten wird, √§ndere ich lediglich die Reihenfolge der Bilder im Stack und mehr nicht. Im CSS sieht das dann so aus:</p>
<pre class="language-css"><code class="language-css"><span class="token comment">/* Switch order of images */</span><br><span class="token selector">#image-container.pressed ::slotted([slot='image-after'])</span> <span class="token punctuation">{</span><br>  <span class="token property">order</span><span class="token punctuation">:</span> 1<span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre>
<p>ausgel√∂st wird das durch folgenden Code:</p>
<pre class="language-ts"><code class="language-ts"><span class="token decorator"><span class="token at operator">@</span><span class="token function">state</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><br><span class="token keyword">private</span> pressed <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span><br><br><span class="token keyword">const</span> overlayTemplate <span class="token operator">=</span> html<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string"><br>  &lt;div<br>    @keydown=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>keyboardOverlayHandler<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"><br>    @keyup=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setPressed</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"><br>    @mousedown=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setPressed</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"><br>    @mouseup=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setPressed</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"><br>    @mouseleave=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setPressed</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"><br>    tabindex="0"<br>    title=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>overlayPrompt<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"><br>    id="image-container"<br>    class="</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>pressed <span class="token operator">?</span> <span class="token string">'pressed'</span> <span class="token operator">:</span> <span class="token string">''</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">"<br>  ><br>    &lt;slot name="label-before">&lt;/slot><br>    &lt;slot name="label-after">&lt;/slot><br>    &lt;slot name="image-after">&lt;/slot><br>    &lt;slot name="image-before">&lt;/slot><br>  &lt;/div><br>  &lt;slot name="prompt">&lt;/slot><br></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span></code></pre>
<p>Also wird nur eine einzige interne Variable geflippt.</p>
</section>
<section>
<h2 id="split"><a class="header-anchor" href="#split">Split</a></h2>
<image-comparison variant="split" class="post-img">
  <label slot="label-before">Ohne Filter</label>
  <label slot="label-after">Graustufen</label>
  <img slot="image-before" src="/img/2023/image-comparison/kasimir--opt.jpg" width="212" alt="Tabby Katze" >
  <img slot="image-after" src="/img/2023/image-comparison/kasimir_filter--opt.jpg" width="212" alt="Tabby Katze in Graustufen" >
</image-comparison>
<p>Es wird immer weniger komplex je weiter dieser Artikel fortschreitet, denn die Split-Variante ist tats√§chlich ausschlie√ülich CSS. Nicht besonders spannend, es ist einfach ein umbrechendes zweispaltiges Layout:</p>
<pre class="language-css"><code class="language-css"><span class="token selector">:host([variant='split']) #image-container</span> <span class="token punctuation">{</span><br>  <span class="token property">gap</span><span class="token punctuation">:</span> <span class="token function">var</span><span class="token punctuation">(</span>--split-gap<span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token property">grid-template-columns</span><span class="token punctuation">:</span> <span class="token function">repeat</span><span class="token punctuation">(</span><br>    auto-fit<span class="token punctuation">,</span><br>    <span class="token function">minmax</span><span class="token punctuation">(</span><span class="token function">var</span><span class="token punctuation">(</span>--split-column-min-width<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">var</span><span class="token punctuation">(</span>--split-column-max-width<span class="token punctuation">)</span><span class="token punctuation">)</span><br>  <span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br><span class="token selector">:host([variant='split']) .container-split-column</span> <span class="token punctuation">{</span><br>  <span class="token property">display</span><span class="token punctuation">:</span> flex<span class="token punctuation">;</span><br>  <span class="token property">flex-direction</span><span class="token punctuation">:</span> column<span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br><span class="token selector">:host([variant='split']) ::slotted([slot^='label-'])</span> <span class="token punctuation">{</span><br>  <span class="token property">opacity</span><span class="token punctuation">:</span> 1<span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre>
</section>
<section>
<h2 id="custom-events"><a class="header-anchor" href="#custom-events">Custom Events</a></h2>
<p>Custom Events oder auch &quot;Synthetic Events&quot; sind wie der Name vermuten l√§sst eigens geschaffene Events. Da der Aufbau immer √§hnlich ist, gehe ich hier nur auf das Event des Sliders ein:</p>
<pre class="language-ts"><code class="language-ts"><span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">DragEvent</span> <span class="token keyword">extends</span> <span class="token class-name">Event</span> <span class="token punctuation">{</span><br>  <span class="token keyword">static</span> <span class="token keyword">readonly</span> eventName <span class="token operator">=</span> <span class="token string">'drag-event'</span> <span class="token keyword">as</span> <span class="token keyword">const</span><span class="token punctuation">;</span><br><br>  targetElement<span class="token operator">:</span> HTMLElement<span class="token punctuation">;</span><br><br>  <span class="token function">constructor</span><span class="token punctuation">(</span>targetElement<span class="token operator">:</span> HTMLElement<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">super</span><span class="token punctuation">(</span>DragEvent<span class="token punctuation">.</span>eventName<span class="token punctuation">,</span> <span class="token punctuation">{</span><br>      bubbles<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span><br>      cancelable<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span><br>      composed<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span><br>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    <span class="token keyword">this</span><span class="token punctuation">.</span>targetElement <span class="token operator">=</span> targetElement<span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre>
<p>Dieses l√∂se ich immer dann aus, wenn der Slider nicht mehr bewegt wird:</p>
<pre class="language-ts"><code class="language-ts"><span class="token keyword">private</span> slideEndHandler <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setSlidingState</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  window<span class="token punctuation">.</span><span class="token function">dispatchEvent</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">DragEvent</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre>
<p>Abfangen k√∂nnte man dieses Event wie √ºblich so:</p>
<pre class="language-js"><code class="language-js">window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'drag-event'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=></span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>In Class field <code>targetElement</code> steckt dann auch das bekannte <code>sliderPosition</code>-Attribut und dessen Wert.</p>
</section>
<section>
<h2 id="internationalisierung"><a class="header-anchor" href="#internationalisierung">Internationalisierung</a></h2>
<p>An manchen Stellen habe ich bereits angeschnitten, dass die Component auch Sprachen unterst√ºtzt, welche von rechts nach links gelesen werden. Meistens ist das auch kein Problem, denn Layouts wie <code>Grid</code> oder <code>Flex</code> unterst√ºtzen diese bereits von Haus aus so dass kein weiterer Code n√∂tig ist. Leider gibt es noch nicht in allen Browsern die CSS Pseudo Klasse <code>:dir()</code> so dass dann doch an einigen Stellen auf JavaScript zur√ºckgegriffen werden muss. In HTML bestimmt das <code>dir</code>-Attribut die Leserichtung eines Elements und wirkt sich auf alle Kind-Elemente aus.<br>
Normalerweise k√∂nnte man mit <code>closest()</code> ohne weiteres ausgehend von einem Element bis zum <code>Document</code> suchen bis man ein Element mit dem entsprechenden Attribut gefunden hat - im ShadowDOM ist das allerdings etwas komplizierter, da dieses in sich geschlossen ist. Der folgende Ansatz ist deswegen auch leider nicht perfekt, sollte aber in den meisten F√§llen ausreichend sein. Auf diese Einschr√§nkung gehe ich gleich noch etwas genauer ein. Grunds√§tzlich nutze ich aber einen <code>MutationObserver</code> und gebe diesem einen Selektor, welche entweder das n√§chste Element mit einem <code>dir</code>-Attribut oder das <code>Document</code> an sich ist. √Ñhnlich der EventListener werden auch Observer im <code>connectedCallback</code> aktiviert und im <code>disconnectedCallback</code> deaktiviert.</p>
<pre class="language-ts"><code class="language-ts"><span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">ImageComparison</span> <span class="token keyword">extends</span> <span class="token class-name">LitElement</span> <span class="token punctuation">{</span><br>  <span class="token decorator"><span class="token at operator">@</span><span class="token function">state</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>  <span class="token keyword">private</span> isRtl<span class="token operator">:</span> <span class="token builtin">boolean</span> <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span><br><br>  <span class="token keyword">private</span> readingDirectionObserver<span class="token operator">!</span><span class="token operator">:</span> MutationObserver<span class="token punctuation">;</span><br><br>  <span class="token comment">/**<br>   * Callback to handle any mutations made to the dir-attribute<br>   */</span><br>  <span class="token keyword">private</span> <span class="token function-variable function">readingDirectionHandler</span> <span class="token operator">=</span> <span class="token punctuation">(</span>mutations<span class="token operator">:</span> MutationRecord<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> mutation <span class="token keyword">of</span> mutations<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>      <span class="token keyword">if</span> <span class="token punctuation">(</span>mutation<span class="token punctuation">.</span>attributeName <span class="token operator">===</span> <span class="token string">'dir'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>        <span class="token keyword">const</span> <span class="token punctuation">{</span> dir <span class="token punctuation">}</span> <span class="token operator">=</span> mutation<span class="token punctuation">.</span>target <span class="token keyword">as</span> HTMLElement<span class="token punctuation">;</span><br>        <span class="token keyword">this</span><span class="token punctuation">.</span>isRtl <span class="token operator">=</span> dir <span class="token operator">===</span> <span class="token string">'rtl'</span><span class="token punctuation">;</span><br>      <span class="token punctuation">}</span><br>    <span class="token punctuation">}</span><br>  <span class="token punctuation">}</span><span class="token punctuation">;</span><br><br>  <span class="token comment">/**<br>   * Component is added to the document's DOM, setup readingDirectionObserver<br>   */</span><br>  override <span class="token function">connectedCallback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{</span><br>    <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">connectedCallback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    <span class="token keyword">this</span><span class="token punctuation">.</span>readingDirectionObserver <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MutationObserver</span><span class="token punctuation">(</span><br>      <span class="token keyword">this</span><span class="token punctuation">.</span>readingDirectionHandler<br>    <span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    <span class="token comment">// Find closest element with a dir attribute by traversing upwards</span><br>    <span class="token keyword">this</span><span class="token punctuation">.</span>textDirectionElement <span class="token operator">=</span><br>      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">closest</span><span class="token punctuation">(</span><span class="token string">'[dir]'</span><span class="token punctuation">)</span> <span class="token operator">??</span><br>      <span class="token keyword">this</span><span class="token punctuation">.</span>ownerDocument<span class="token operator">?.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'html'</span><span class="token punctuation">)</span><span class="token operator">!</span><span class="token punctuation">;</span><br><br>    <span class="token comment">// Found one? Is it 'rtl'?</span><br>    <span class="token keyword">this</span><span class="token punctuation">.</span>isRtl <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>textDirectionElement<span class="token punctuation">.</span>dir <span class="token operator">===</span> <span class="token string">'rtl'</span><span class="token punctuation">;</span><br><br>    <span class="token comment">// Start observing üîç</span><br>    <span class="token keyword">this</span><span class="token punctuation">.</span>readingDirectionObserver<span class="token punctuation">.</span><span class="token function">observe</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>textDirectionElement<span class="token punctuation">,</span> <span class="token punctuation">{</span><br>      attributes<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span><br>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><br>  <span class="token comment">/**<br>   * Stop observing the dir attribute<br>   */</span><br>  override <span class="token function">disconnectedCallback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{</span><br>    <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">disconnectedCallback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    <span class="token keyword">this</span><span class="token punctuation">.</span>readingDirectionObserver<span class="token punctuation">.</span><span class="token function">disconnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre>
<p>In den aller meisten F√§llen ist die folgende Integration ausreichend:</p>
<pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>rtl-container<span class="token punctuation">"</span></span> <span class="token attr-name">dir</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>rtl<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>image-comparison</span><span class="token punctuation">></span></span><br>    <span class="token comment">&lt;!-- Content --></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>image-comparison</span><span class="token punctuation">></span></span><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span></code></pre>
<p>Die Component w√ºrde korrekterweise in rtl gelesen und genutzt werden k√∂nnen. Was nicht funktionieren w√ºrde, ist das die Component selbst in einem <code>Slot</code> oder im ShadowDOM benutzt wird. Es ist auf jeden Fall eine Limitierung. Umgehen k√∂nnte man das eventuell noch in dem man ein weiteres Attribut f√ºr die Component selbst einf√ºhrt. Ich denke man kann damit aber leben. Die meisten Personen mit denen ich gesprochen habe, die ein rtl-Layout betreffen w√ºrde, w√§ren zum Beispiel gar nicht davon ausgegangen, dass sich die Bilder drehen m√ºssten. Das ist nat√ºrlich nur anekdotisch.</p>
</section>
<section>
<h2 id="drei-components-in-einer"><a class="header-anchor" href="#drei-components-in-einer">Drei Components in einer</a></h2>
<p>Sollte man wirklich drei Components in einer verwirklichen? Wahrscheinlich eher nicht, aber interessant war es trotzdem und in meinen Tests mit einem √§lteren Smartphone gab es auch nicht wirklich Performance Probleme. Um &quot;live&quot; zwischen den Varianten wechseln zu k√∂nnen, bin ich wie folgt vorgegangen.<br>
Einen Type f√ºr Varianten definieren:</p>
<pre class="language-typescript"><code class="language-typescript"><span class="token keyword">type</span> <span class="token class-name">Variants</span> <span class="token operator">=</span> <span class="token string">'overlay'</span> <span class="token operator">|</span> <span class="token string">'slider'</span> <span class="token operator">|</span> <span class="token string">'split'</span><span class="token punctuation">;</span></code></pre>
<p>Eine Property f√ºr die Component definieren:</p>
<pre class="language-typescript"><code class="language-typescript"><span class="token decorator"><span class="token at operator">@</span><span class="token function">property</span></span><span class="token punctuation">(</span><span class="token punctuation">{</span> type<span class="token operator">:</span> String <span class="token punctuation">}</span><span class="token punctuation">)</span><br><span class="token keyword">private</span> variant<span class="token operator">:</span> Variants <span class="token operator">=</span> <span class="token string">'slider'</span><span class="token punctuation">;</span></code></pre>
<p>Mit Hilfe dieses Decorators wird ein Attribut erstellt auf dessen √Ñnderungen automatisch reagiert werden kann und bei Bedarf neu gerendert wird.</p>
<p>Templates definieren und auf Property reagieren lassen:</p>
<pre class="language-typescript"><code class="language-typescript"><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token keyword">const</span> sliderTemplate <span class="token operator">=</span> html<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span><br>  <span class="token keyword">const</span> overlayTemplate <span class="token operator">=</span> html<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span><br>  <span class="token keyword">const</span> splitTemplate <span class="token operator">=</span> html<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span><br><br>  <span class="token keyword">return</span> html<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string"><br>    </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token generic-function"><span class="token function">choose</span><span class="token generic class-name"><span class="token operator">&lt;</span>Variants<span class="token punctuation">,</span> TemplateResult<span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>variant<span class="token punctuation">,</span> <span class="token punctuation">[</span><br>      <span class="token punctuation">[</span><span class="token string">'slider'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> sliderTemplate<span class="token punctuation">]</span><span class="token punctuation">,</span><br>      <span class="token punctuation">[</span><span class="token string">'overlay'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> overlayTemplate<span class="token punctuation">]</span><span class="token punctuation">,</span><br>      <span class="token punctuation">[</span><span class="token string">'split'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> splitTemplate<span class="token punctuation">]</span><span class="token punctuation">,</span><br>    <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"><br>  </span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre>
<p>Die zu Lit geh√∂rende <a href="https://lit.dev/docs/templates/directives/#choose" target="_blank" rel="noopener noreferrer"><code>choose</code></a>-Direktive kann nun auf diese Art typsicher eines von drei Templates rendern und dies allein durch das √§ndern des <code>variant</code>-Attributes:</p>
<pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>image-comparison</span> <span class="token attr-name">variant</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>slider<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>image-comparison</span><span class="token punctuation">></span></span><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>image-comparison</span> <span class="token attr-name">variant</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>overlay<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>image-comparison</span><span class="token punctuation">></span></span><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>image-comparison</span> <span class="token attr-name">variant</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>split<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>image-comparison</span><span class="token punctuation">></span></span></code></pre>
</section>
<section>
<h2 id="integration-auf-websites-und-in-frameworks"><a class="header-anchor" href="#integration-auf-websites-und-in-frameworks">Integration auf Websites und in Frameworks</a></h2>
<p>Um diese Component beispielsweise in WordPress zu integrieren, reicht es aus, folgendes Script-Tag zum gew√ºnschten Template hinzuzuf√ºgen und √ºber deren Slots zu konfigurieren.</p>
<pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><br>  <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>module<span class="token punctuation">"</span></span><br>  <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://unpkg.com/image-comparison-component/dist/src/image-comparison.js?module<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript"><br></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><br><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>image-comparison</span><br>  <span class="token attr-name">variant</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>slider<span class="token punctuation">"</span></span><br>  <span class="token attr-name">sliderPrompt</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Move the slider to compare<span class="token punctuation">"</span></span><br>  <span class="token attr-name">overlayPrompt</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Tap and hold to compare<span class="token punctuation">"</span></span><br><span class="token punctuation">></span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span> <span class="token attr-name">slot</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>label-before<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>Ohne Filter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">></span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span> <span class="token attr-name">slot</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>label-after<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>Graustufen<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">></span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">slot</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>image-before<span class="token punctuation">"</span></span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/img/2023/before.jpg<span class="token punctuation">"</span></span> <span class="token attr-name">alt</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Rote Zierquitte<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">slot</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>image-after<span class="token punctuation">"</span></span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/img/2023/after.jpg<span class="token punctuation">"</span></span> <span class="token attr-name">alt</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Rote Zierquitte (Graustufen)<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>image-comparison</span><span class="token punctuation">></span></span></code></pre>
<p>In anderen Umgebungen sieht das dann √§hnlich aus. Wenn man die Component √ºber NPM installiert hat und dessen Attribute √ºber Radio Buttons √§ndern m√∂chte k√∂nnte man so etwas machen:</p>
<pre class="language-typescript"><code class="language-typescript"><span class="token keyword">import</span> <span class="token string">'image-comparison-component/image-comparison.js'</span><span class="token punctuation">;</span><br><br><span class="token keyword">const</span> imageComparisonDemoComponent <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><br>  <span class="token string">'#image-comparison-demo'</span><span class="token punctuation">,</span><br><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br><span class="token keyword">const</span> radioButtonVariants <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelectorAll</span><span class="token punctuation">(</span><span class="token string">'input[name="variant"]'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>radioButtonVariants<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span>radioButton<span class="token punctuation">)</span> <span class="token operator">=></span><br>  radioButton<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'change'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>    <span class="token keyword">const</span> <span class="token punctuation">{</span> value <span class="token punctuation">}</span> <span class="token operator">=</span> e<span class="token punctuation">.</span>target<span class="token punctuation">;</span><br>    imageComparisonDemoComponent<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">'variant'</span><span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
</section>
<section>
<h2 id="fazit"><a class="header-anchor" href="#fazit">Fazit</a></h2>
<p>Die Arbeit an dieser Component hatte ich bereits vor einer Weile abgeschlossen und konnte jetzt durch das Schreiben des Posts noch einiges dazu lernen. Dazu z√§hlte auf jeden Fall das hinzuf√ºgen von Default-Styles, die Integration in einen statischen Seitengenerator und insbesondere das Handling des <code>rtl</code>-Attributs. Etwas sp√§ter in der Entwicklung habe ich dann auch noch eine Component Library entdeckt, welche ebenfalls in Lit geschrieben ist und auch eine solche Component enth√§lt. Wer also eine ausgewachsenere Variante nutzen m√∂chte, dem kann ich nur <a href="https://shoelace.style/components/image-comparer" target="_blank" rel="noopener noreferrer">Shoelace</a> empfehlen. Viel Spa√ü mit der Component :)</p>
</section>

      </main>

      
        <aside>
          <toc-observer observeParent>
            <div slot="toc">
              <nav class="toc">
                <ol>
                    
                    <li><a href="#slider">Slider</a>
            
                <ol>
                    
                    <li><a href="#html-and-css">HTML & CSS</a>
            		</li>

                    <li><a href="#entwicklung-der-slider-funktion">Entwicklung der Slider-Funktion</a>
            		</li>

                    <li><a href="#barrierefreiheit-des-sliders">Barrierefreiheit des Sliders</a>
            		</li>

                    <li><a href="#housekeeping-mit-lifecycle-callbacks">Housekeeping üßΩ mit Lifecycle-Callbacks</a>
            		</li>
                </ol>
            		</li>

                    <li><a href="#overlay">Overlay</a>
            		</li>

                    <li><a href="#split">Split</a>
            		</li>

                    <li><a href="#custom-events">Custom Events</a>
            		</li>

                    <li><a href="#internationalisierung">Internationalisierung</a>
            		</li>

                    <li><a href="#drei-components-in-einer">Drei Components in einer</a>
            		</li>

                    <li><a href="#integration-auf-websites-und-in-frameworks">Integration auf Websites und in Frameworks</a>
            		</li>

                    <li><a href="#fazit">Fazit</a>
            		</li>
                </ol>
            </nav>
            </div>
          </toc-observer>
        </aside>
      
    </div>

    
  
  <script>
    if ('serviceWorker' in navigator) {
      navigator
        .serviceWorker
        .register('/sw.js');
    }
  </script>


    <footer>
  <span id="copyright">
    ¬© Tony Spegel
    2023
  </span>
  <ul class="footer-links">
    
      <li>
        <a href="/impressum/">Impressum</a>
      </li>
    
      <li>
        <a href="/datenschutzerklaerung/">Datenschutzerkl√§rung</a>
      </li>
    
      <li>
        <a href="/barrierefreiheit/">Barrierefreiheit</a>
      </li>
    
  </ul>
</footer>

  </body>
</html>
